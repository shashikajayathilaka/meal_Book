$(function(){$canvas.offset();$("#show-bg").hide(),$("#canvas .txtcont span:empty").length&&$(".txtcont span:empty").text(paragraphtext),$("#canvas .listcont:empty").length&&$(".listcont:empty").each(function(){var e=$(this).parent().attr("data-color");$(this).html(list).find("li span").css({"background-color":e})}),imgs=$(".device-wrap span"),$("#canvas .wire").not(".grouped").has(".headlinetxt").addClass("hastext"),activepage.find(".wire").not(".groupmember").each(function(e,t){$(t).attr("id")||($(t).attr("id","w"+(new Date).getTime()),computeGuides($(t)))}),multipaged||computeGuides(activepage.find(" > .wire")),$(".textnew.ui-draggable").draggable("destroy"),$canvaswrap.center(),$("#canvas .locked").draggable("destroy").resizable("destroy"),multipaged?$(".page.active").not(activepage).removeClass("active"):(activepage=$("#canvas"),applyTemplate($canvaswrap.data("device"),$canvaswrap.data("orientation")))}),$("#canvas .wire").not("#canvas .wire:has(.wirejr)").css({"border-style":"solid"}),multipaged=!(multipaged||!$("#canvas .page").length)||multipaged||!1,$("#canvas").append($("<div>").addClass("guide").attr("id","guide-h")).append($("<div>").addClass("guide").attr("id","guide-v")).find("guide").hide();var multipaged,imgs,resizingInProgress,innerOffsetX,innerOffsetY,previewMode,$container=$(".container"),supercanvas=$(".supercanvas"),exporting=$(".exporting"),gridsize=0,wirePresent=!0,wirepanel=$("#wirepanel"),$canvaswrap=$("#canvas-wrap"),annotPresent=!0,offset_c=$("#canvas").offset(),cwidth=$("#canvas-wrap").width(),MIN_DISTANCE=7,guides=[],$showgrid=$("#show-grid"),$snaptogrid=$("#snap-to-grid"),$snaptoguides=$("#snap-to-guides"),$drawsnap=$("#draw-snap"),$transformsnap=$("#transform-snap"),$guideH=$("#guide-h"),$guideV=$("#guide-v"),$guidesHV=$("#guide-v , #guide-h"),$selectgridtype=$("select#grid-type"),$options=$(".options"),$statsCoord=$(".stats-coord"),$statsDim=$(".stats-dim"),offseta1=$("#canvas").offset(),clonewidth=0,cloneheight=0,$canvas=$("#canvas"),index_highest=0,sttngs=$(".settings span i"),sett=$(".settings"),$sitemapicon=$("#sitemap icon i"),$dim=$(".dim"),$body=$("body"),$edittxt=$("#edittxt"),appSettings=($container.hasClass("preview")&&(previewMode=!0),{fixedToolbar:!0,drawOnTop:!1,snapOnDraw:!0,snapTo:1,snapToGuides:!0,transformSnap:!0,drawSnap:!0,snapToGrid:!1,snapToCol:!1,gridSize:20,gridType:"graph",showGrid:!1,showCol:!1,iconPack:"md",defaultStyle:{fill:"#fff",stroke:"#444",width:1}}),paragraphArr=(applySettings(),["Lorem","ipsum","dolor","sit","amet","et","delectus","accommodare","his","consul","copiosae","legendos","at","vix","ad","putent","delectus","delicata","usu.","Vidit","dissentiet","eos","cu","eum","an","brute","copiosae","hendrerit.","Eos","erant","dolorum","an.","Per","facer","affert","ut.","Mei","iisque","mentitum","moderatius","cu.","Sit","munere","facilis","accusam","eu","dicat","falli","consulatu","at","vis.","Te","facilisis","mnesarchum","qui","posse","omnium","mediocritatem","est","cu.","Modus","argumentum","ne","qui","tation","efficiendi","in","eos.","Ei","mea","falli","legere","efficiantur","et","tollit","aliquip","debitis","mei.","No","deserunt","mediocritatem","mel.","Lorem","ipsum","dolor","sit","amet","et","delectus","accommodare","his","consul","copiosae","legendos","at","vix","ad","putent","delectus","delicata","usu.","Vidit","dissentiet","eos","cu","eum","an","brute","copiosae","hendrerit.","Eos","erant","dolorum","an.","Per","facer","affert","ut.","Mei","iisque","mentitum","moderatius","cu.","Sit","munere","facilis","accusam","eu","dicat","falli","consulatu","at","vis.","Te","facilisis","mnesarchum","qui","posse","omnium","mediocritatem","est","cu.","Modus","argumentum","ne","qui","tation","efficiendi","in","eos.","Ei","mea","falli","legere","efficiantur","et","tollit","aliquip","debitis","mei.","No","deserunt","mediocritatem","mel.","Lorem","ipsum","dolor","sit","amet","et","delectus","accommodare","his","consul","copiosae","legendos","at","vix","ad","putent","delectus","delicata","usu.","Vidit","dissentiet","eos","cu","eum","an","brute","copiosae","hendrerit.","Eos","erant","dolorum","an.","Per","facer","affert","ut.","Mei","iisque","mentitum","moderatius","cu.","Sit","munere","facilis","accusam","eu","dicat","falli","consulatu","at","vis.","Te","facilisis","mnesarchum","qui","posse","omnium","mediocritatem","est","cu.","Modus","argumentum","ne","qui","tation","efficiendi","in","eos.","Ei","mea","falli","legere","efficiantur","et","tollit","aliquip","debitis","mei.","No","deserunt","mediocritatem","mel.","Lorem","ipsum","dolor","sit","amet","et","delectus","accommodare","his","consul","copiosae","legendos","at","vix","ad","putent","delectus","delicata","usu.","Vidit","dissentiet","eos","cu","eum","an","brute","copiosae","hendrerit.","Eos","erant","dolorum","an.","Per","facer","affert","ut.","Mei","iisque","mentitum","moderatius","cu.","Sit","munere","facilis","accusam","eu","dicat","falli","consulatu","at","vis.","Te","facilisis","mnesarchum","qui","posse","omnium","mediocritatem","est","cu.","Modus","argumentum","ne","qui","tation","efficiendi","in","eos.","Ei","mea","falli","legere","efficiantur","et","tollit","aliquip","debitis","mei.","No","deserunt","mediocritatem","mel."]);const objectMap=(e,i)=>Object.fromEntries(Object.entries(e).map(([e,t],a)=>[e,i(t,e,a)]));function updateCanvasInput(e,t){e=e||parseInt($canvaswrap.width(),10),t=t||parseInt($canvaswrap.height(),10);$(".canvassize").html("<b>canvas</b>: "+e+"/"+t+"px"),$("#canvas_w_val").val(e),$("#canvas_h_val").val(t),computeGuides("#canvas")}function turnColOn(){$("#show-grid").removeAttr("checked"),$("#gridcol").show(),$canvaswrap.attr({"data-col":"true","data-grid-type":"false","data-grid-show":"false"}),$("#grid-div , #grid-dot").hide(),computeGuides("col")}function setgrid(){if(!$("#canvas #grid-div").length){$("#canvas").prepend($(".grids").show().contents().unwrap()),$("#show-grid").attr("checked",appSettings.showGrid);var e=appSettings.gridType||$canvaswrap.attr("data-grid-type")||$canvaswrap.attr("data-grid");switch("grid"==e&&(e="graph",saveSettings()),appSettings.showGrid?$("select#grid-type").val(appSettings.gridType):$("#grid-div , #grid-dot , #gridcol").hide(),e){case"graph":$("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$("select#grid-type").val("graph");break;case"dots":$("#grid-dot").show(),$("#gridcol , #grid-div").hide(),$("select#grid-type").val("dots");break;default:$("#grid-div , #grid-dot , #gridcol").hide(),$("#show-grid").attr("checked",!1)}!appSettings.showCol&&"true"!==$canvaswrap.attr("data-col")||($("#grid-div , #grid-dot").hide(),$("#gridcol").show(),$("#show-grid").attr("checked",!1),$("#show-columns").attr("checked",!0),computeGuides("col"))}0<(gridsize=appSettings.gridSize||$canvaswrap.attr("data-grid-size")||$canvaswrap.attr("snappy"))&&(appSettings.snapToGrid||"true"===$canvaswrap.attr("data-grid-snap"))?($canvaswrap.removeAttr("snappy"),$(".grid-size-val").text(appSettings.gridSize),$snaptogrid.attr("checked",!0),$("#show-columns").attr("checked",!1),$("#gridcol").hide(),appSettings.snapToGuides=!1,appSettings.snapToGrid=!0,appSettings.snapToCol=!1,$snaptoguides.attr("checked",!1),updategrid(appSettings.gridSize),$("#grid-slider").slider("value",appSettings.gridSize)):appSettings.showCol||"col"==gridsize&&$canvaswrap.data("col")||$canvaswrap.data("col")?($snaptogrid.attr("checked",!1),$snaptoguides.attr("checked",!0),$("#show-columns").attr("checked",!0),appSettings.snapToGuides=!0,appSettings.snapToGrid=!1,appSettings.snapToCol=!0,$selectgridtype.val("col"),gridsize=0,$("#gridcol").show()):(updategrid(e=appSettings.gridSize||20),$("#grid-slider").slider("value",e),$(".grid-size-val").text(e)),$canvaswrap.attr("data-grid-show");appSettings.showGrid||$("#grid-div").hide(),saveSettings()}function lock(e){var t=activepage.find(".g-selected").length?activepage.find(" > .g-selected"):activepage.find(".selected");t.hasClass("w-group-member")||t.length&&(t.addClass("locked").draggable("destroy").resizable("destroy").radiusable("destroy").radiusable("destroy"),saveState(t),stageElemForSaving(t,{action:"updated"},{getLock:!0,getCss:!1}),$("#selection-transformator").remove(),$("#wcc-toolbar-instance").hide(),render_edit_menu(),0==activepage.find(".g-selected").length)&&positionwirepanel()}function unlock(e,t){saveState(e,null,null,null,null,null,null,!0),e.removeClass("locked icon-").unbind("click").data("draggable",!1),stageElemForSaving(e,{action:"updated"},{getLock:!0,getCss:!1}),wirepanel.hide(),t?selectWire(e.find(" .wire")):(makeDrag(e),selectWire(e))}$(document).ready(function(){previewMode||setgrid(),updateCanvasInput(),positionAA();var e=$("#add-section-btn,#add-section-text").detach();$("#canvas-wrap").find("#add-section-btn,#add-section-text,#section-ghost").remove().end().prepend($(e)),$("#jump-sel-btn").on("click",function(e){e.stopPropagation(),$("#section-btn").click()})}),populateLoremText(),$("#show-grid").bind("change",function(){$(this).is(":checked")?($("#show-columns").removeAttr("checked"),$("#gridcol").hide(),removeGuides(".col"),$canvaswrap.attr({"data-col":"false","data-grid-show":"true"}),$("select#grid-type").val(appSettings.gridType),"graph"==appSettings.gridType?($("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$canvaswrap.attr("data-grid-type","graph")):"dots"==appSettings.gridType&&($("#grid-dot").show(),$("#gridcol , #grid-div").hide(),$canvaswrap.attr("data-grid-type","dots")),appSettings.showGrid=!0):($("#grid-div , #grid-dot").hide(),$canvaswrap.attr("data-grid-show","false"),appSettings.showGrid=!1);var e=$(this).is(":checked");(appSettings.showGrid=e)&&(appSettings.showCol=!appSettings.showGrid),saveSettings()}),$("#show-columns").bind("change",function(){$(this).is(":checked")?(turnColOn(),appSettings.showCol=!0,appSettings.showGrid=!1,appSettings.snapToGrid=!1):($("#gridcol").hide(),$canvaswrap.attr("data-col","false"),removeGuides(".col"),appSettings.showCol=!1),saveSettings()}),$("select#grid-type").change(function(){"graph"==$("select#grid-type").val()?($("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$("#show-grid").attr("checked","checked"),$canvaswrap.attr("data-grid-type","graph"),appSettings.snapToCol=!1,appSettings.gridType="graph",removeGuides(".col")):"dots"==$("select#grid-type").val()&&($("#grid-dot").show(),$("#gridcol, #grid-div").hide(),$("#show-grid").attr("checked","checked"),$canvaswrap.attr("data-grid-type","dots"),appSettings.snapToCol=!1,appSettings.gridType="dots",removeGuides(".col")),saveSettings()}),$("#show-annotation").click(function(){$("#canvas .aa , #canvas .publiccomment").show(),$("#hide-annotation").show(),$(this).hide()}),$("#hide-annotation").click(function(){$("#canvas .aa , #canvas .publiccomment").hide(),$("#show-annotation").show(),$(this).hide()}),$("#edit-wire").click(function(){$("#canvas .selected").dblclick()}),$("#lock").click(function(e){lock(e)});var $ajaxlogin=$("#ajaxlogin"),supports_pushState="pushState"in history;function showSaveButton(){$("#slogan").fadeOut("fast",function(){$(".controls").fadeIn(),$("#links").addClass("linksmin")})}function InstantShowSaveButton(){$("#slogan").hide(),$("#links").addClass("linksmin"),$("#demo").hide(),$(".controls").show()}$("#save").click(function(){$("#canvas-wrap").find(" > .ui-resizable-handle").remove(),deselectAll(),$(".selected").removeClass("selected"),wirepanel.hide(),activepage.add("#canvas > .master-on").find("[data-snap-mark-h] , [data-snap-mark-v]").removeAttr("data-snap-mark-h").removeAttr("data-snap-mark-v"),quill&&blurRTE(),$("#canvas .wire , #canvas .aa , #canvas .publiccomment, .ui-resizable, .ui-draggable").draggable("destroy").resizable("destroy").radiusable("destroy").removeClass("ui-re"),$("#canvas .master-on.ui-draggable").draggable("destroy");var t=$(".supercanvas").clone().find(".txtcont span").empty().end().find(".listcont").empty().end().find(".aa , .publiccomment, form , option , xmp , textarea , plaintext , grammarly-btn , grammarly-ghost, a, #plus-section-btn-wrap").remove().end().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot").remove().end().find(".text-lorem [data-lorem-count] .textme").empty().end().htmlClean().html(),a=encodeURIComponent(t),i="",s=($("#canvas .publiccomment , #canvas .aa").each(function(){$(this).attr("data-parent",$(this).parent().attr("id")),i+=$(this).outerHTML()}),encodeURIComponent(i));$.ajax({type:"POST",url:"../save",data:{note:a,name:filename,aa:s},success:function(e){"login"===e?(localStorage.setItem(filename,t),localStorage.setItem(filename+"aa",i),$ajaxlogin.find(".wrongpass").hide(),$ajaxlogin.show().submit(function(e){e.preventDefault(),$.ajax({type:"POST",url:"../ps/ajaxlogin.php",data:$ajaxlogin.serialize(),success:function(e){0==e?$ajaxlogin.find(".wrongpass").show():$.ajax({type:"POST",url:"../save",data:{note:a,name:filename,aa:s},success:function(){$(".saved").show().delay(600).fadeOut(),MakeCanvasDrag(),makeAADrag($("#canvas .publiccomment , #canvas .aa")),localStorage.removeItem(filename),localStorage.removeItem(filename+"aa"),$ajaxlogin.hide(),_paq.push(["trackGoal",3])}})}})}),_paq.push(["trackGoal",2])):($(".saved").show().delay(600).fadeOut(),MakeCanvasDrag(),makeAADrag($("#canvas .publiccomment , #canvas .aa")),removeEventListener("beforeunload",beforeUnloadListener,{capture:!0}),localStorage.removeItem(filename),localStorage.removeItem(filename+"aa"))},error:function(){localStorage.setItem(filename,t),localStorage.setItem(filename+"aa",i),MakeCanvasDrag(),$("#canvas .publiccomment , #canvas .aa").draggable().resizable({handles:"n,e,w,s"}),_paq.push(["trackGoal",1])}})}),$("#fork").click(function(){activepage.find(".selected").removeClass("selected"),activepage.add("#canvas > .master-on").find("[data-snap-mark-h] , [data-snap-mark-v]").removeAttr("data-snap-mark-h").removeAttr("data-snap-mark-v"),quill&&blurRTE(),$("#canvas .wire , #canvas .aa , #canvas .publiccomment").draggable("destroy").resizable("destroy").radiusable("destroy").removeClass("ui-re"),$canvaswrap.resizable("destroy");var e=$(".supercanvas").clone().find(".txtcont span").empty().end().find(".listcont").empty().end().find(".aa , .publiccomment , form , option , xmp , textarea , plaintext , grammarly-btn , grammarly-ghost, a").remove().end().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot").remove().end().find(".text-lorem [data-lorem-count] .textme").empty().end().htmlClean().html(),e=encodeURIComponent(e),t="",a=($("#canvas .publiccomment , #canvas .aa").each(function(){$(this).attr("data-parent",$(this).parent().attr("id")),t+=$(this).outerHTML()}),encodeURIComponent(t)),i=$.now();$.post("../fork",{note:e,name:filename,aa:a,timestamp:i},function(){$(".saved").show().delay(600).fadeOut(),MakeCanvasDrag(),makeAADrag($("#canvas .publiccomment , #canvas .aa"))})}),$("#savefree").click(function(){var e=!0,t=($canvas.find("[data-snap-mark-h] , [data-snap-mark-v]").removeAttr("data-snap-mark-h").removeAttr("data-snap-mark-v"),deselectAll(),quill&&blurRTE(),$("#canvas .wire , #canvas .aa ").draggable("destroy").resizable("destroy").radiusable("destroy").removeClass("ui-re"),$canvaswrap.resizable("destroy"),$(".supercanvas").clone().find(".txtcont span").empty().end().find(".listcont").empty().end().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot , form , option , xmp , textarea , plaintext , grammarly-btn , grammarly-ghost, a").remove().end().find(".text-lorem [data-lorem-count] .textme").empty().end().html()),t=encodeURIComponent(t);0===filename?filename=randomID(6):e=!1,supports_pushState?history.pushState({},"filename","/"+filename):location.hash="#"+filename,$.post("save.php",{note:t,name:filename},function(){MakeCanvasDrag(),e?($("body").addClass("show-save-modal"),$(".savedURL").text("https://wireframe.cc/"+filename)):$(".saved").fadeIn(160).delay(800).fadeOut(100),saveThumbAndData(filename),makeAADrag($("#canvas .aa"))})}),$("#canvas").on("click",".closeannot",function(e){$(this).parent().remove(),previewMode&&saveComment()}),previewMode?$("#canvas").on("click",".publiccomment .annotbox div",divClicked):$("#canvas").on("click",".annotbox div",divClicked);var quill,$rteToolbar=$("#wcc-toolbar");let Block=Quill.import("blots/block"),Inline=Quill.import("blots/inline");class WcclinkBlot extends Inline{static create(e){var t=super.create();return t.setAttribute("data-link",e),t}static formats(e){return $(".ql-wcclink").addClass("ql-active"),e.getAttribute("data-link")}}WcclinkBlot.blotName="wcclink",WcclinkBlot.className="wcc-link",WcclinkBlot.tagName="span",Quill.register(WcclinkBlot);class WebLinkBlot extends Inline{static create(e){var t=super.create();return t.setAttribute("data-weblink",e),t}static formats(e){return e.getAttribute("data-weblink")}}WebLinkBlot.blotName="weblink",WebLinkBlot.tagName="span",WebLinkBlot.className="wcc-weblink",Quill.register(WebLinkBlot);let textChangeTimeout;function edittext(t,e,p,a){var g,h,i,s,n,o,r,l;previewMode||(wirepanel.hide(),$guidesHV.hide(),supercanvas.addClass("rich-text-active"),t.stopPropagation(),removeMarkedElemBorder(),g=$(e),h=g.parents(".wire").not(".grouped"),h.attr("id"),p||h.removeClass("thelatest").not(".text21").find(".textme").each(function(e,t){updateTextTo21(t)}),p||h.find(".wirejr").removeClass("new").css({"border-width":"","border-color":"",background:""}),(e=getWpTextCoord(h)).l,e.tp,g.attr("id","sel-text").removeClass("ql-editor"),h.addClass("edited-text text21"),h.addClass("rich-text").removeAttr("contenteditable"),a||h.resizable("destroy").draggable("destroy").radiusable("destroy"),h.addClass("editingtext").find(".wirejr").css("height","auto"),$("#wcc-toolbar-instance").length||($("#wcc-toolbar").clone(!0,!0).attr("id","wcc-toolbar-instance").appendTo($container).css({display:function(){return p?"none":"flex"}}),positionwirepanel(h,!0)),e=Quill.import("attributors/class/color"),i=Quill.import("attributors/style/size"),Quill.register(e,!0),Quill.register(i,!0),i.whitelist=["12px","14px","16px","22px","28px","42px"],e.whitelist=["f","d","a","h7","h4","h1","t","b"],i=document.getElementById("sel-text"),e={debug:"false",bounds:"#container",formats:["bold","color","size","italic","underline","list","align","lh","ttu","smallcaps","customfontsize","wcclink","weblink"],scrollingContainer:".editingtext",modules:{clipboard:{matchVisual:!1},toolbar:{container:"#wcc-toolbar-instance",handlers:{bold:function(e){quillHandler(e,"bold")},italic:function(e){quillHandler(e,"italic")},underline:function(e){quillHandler(e,"underline")},color:function(e){quillHandler(e,"color")},align:function(e){quillHandler(e,"align")},ttu:function(e){quillHandler(e,"ttu")},smallcaps:function(e){quillHandler(e,"smallcaps")},customfontsize:function(e){quillHandler(e,"customfontsize")},list:function(e){quillHandler(e,"list")},clean:function(e){quillRemoveHandler(e)},wcclink:function(e){renderLinksPanel()},weblink:function(e){renderLinksPanel()}}},history:{delay:1e3,maxStack:50,userOnly:!1}},theme:"snow"},r=Quill.import("parchment"),s=["1",!1,"1.3","1.4","1.5","1.6","1.8","2","3","4"],l=new r.Attributor.Style("lh","line-height",{whitelist:s}),n=new r.Attributor.Style("customfontsize","font-size",{whitelist:["12px","14px","16px",!1,"22px","28px","42px"]}),o=new r.Attributor.Class("ttu","ql-ttu",{scope:r.Scope.INLINE}),r=new r.Attributor.Class("smallcaps","ql-sc",{scope:r.Scope.INLINE}),Quill.register({"formats/lh":l,"formats/ttu":o,"formats/smallcaps":r,"formats/customfontsize":n}),quill=new Quill(i,e),$("#wcc-toolbar-instance #font-size-ui-slider").show(),setFontSizeSlider(1),(l=h.find(".textme").data("text-format"))&&(quill.formatText(0,quill.getLength(),{bold:l.bold,align:l.align,customfontsize:l.size,color:l.color}),h.find(".textme").removeData("text-format")),activepage.find("#sel-text [contenteditable=true]").attr("spellcheck",!1),g.parents(".wirejr").data("lorem-count")&&g.bind("keydown",function(e){$(this).unbind("keydown").parents(".wirejr").removeAttr("data-lorem-count").parent().removeClass("text-lorem").css({height:g.height(),width:g.width()})}),p&&(t.preventDefault(),h.find(".ql-editor").css("width","auto").on("mousedown click mouseup",function(e){t.stopPropagation()}),1===quill.getLength()&&quill.formatText(0,quill.getLength(),{align:"center"}),setVertAlignBtn(h.find(".textme").css("vertical-align")),$("#wcc-toolbar-instance .ql-vertical-align").on("mouseup",".ql-picker-item",function(e){setVerticalAlignment(h,$(this).attr("data-value"))})),p&&!h.hasClass("empty-btn")&&"\n"==quill.getText()&&h.addClass("empty-btn"),quill.clipboard.addMatcher(Node.ELEMENT_NODE,function(e,t){e=e.innerText;return(new(Quill.import("delta"))).insert(e)}),quill.globalHistoryStackLength=historystate.length,quill.on("text-change",function(e,t,a){if(!quill)return!1;var i,s,n=e.ops[e.ops.length-1].attributes;if(e.ops[0].delete&&saveState(h,null,null,null,null,null,null,null,t),g.parents(".wirejr").data("lorem-count")&&g.parents(".wirejr").removeAttr("data-lorem-count").parent().removeClass("text-lorem").css({height:g.height(),width:g.width()}),p&&!i?(i=h.hasClass("empty-btn"),quill.getText()&&!$("body").hasClass("edit-btn")?($("body").addClass("edit-btn"),$("#wcc-toolbar-instance").show(),render_edit_menu(),positionwirepanel(h,null,1),positionTextWirepanel(),wirepanel.hide()):$("body").hasClass("edit-btn")||(render_edit_menu(),positionwirepanel(h,null,1)),i&&($("#wcc-toolbar-instance").show(),positionTextWirepanel(),wirepanel.hide()),c=g.width(),l=g.height(),o=(d=g.parents(".wire")).width(),r=d.height(),s=d[0].hasAttribute("data-can-grow-hor"),o<=c+(p?24:4)&&(o=s?28:6,d.add(g).css("width",c+o),d.radiusable("positionHandles")),r<l&&(d.add(g).css("height",l+6),d.radiusable("positionHandles")),(i&&quill.selection.lastRange&&0<quill.selection.lastRange.index||1<quill.history.stack.undo.length)&&h.removeClass("empty-btn")):quill.selection.lastRange&&0==quill.selection.lastRange.length&&(s=$("#sel-text"),$("#sel-text").parents(".inner-flex-container").length||s.parents(".wire").css({height:s.height(),width:s.width()})),$canvas.data("groupActive")){let e,t={};activepage.find(".group-active.has-section").length&&(e=getMultiElemArea(activepage.find(".group-active > .area-indicator")),t={position:{top:h[0].offsetTop,left:h[0].offsetLeft},size:{width:h.width(),height:h.height()}}),updateActiveGroupOutline(e,t)}quill.selection.lastRange&&quill.selection.lastRange.length&&setFontSizeSlider(quill.selection.lastRange.index),e.ops[0].attributes&&e.ops[0].attributes.color&&setCurrentTextColor();var o,r,l,d,c=activepage.find(".edited-text").siblings(".selected.hastext"),{}=(c.length&&(applyFormatToQuillSiblings(Object.keys(n)[0],Object.values(n)[0]),updateSelIndDim()),!quill.restoring&&1<=e.ops.length&&!e.ops[0].delete&&(o=[],o={quill:!0,id:h.add(c).map(function(){return $(this).attr("id")}).get(),stack:jQuery.extend(!0,{},quill.history.stack)},r=historystate.length&&historystate[0].quill&&checker(o.id,historystate[0].id),1==quill.history.stack.undo.length&&(o.oldDelta=t),r&&1<quill.history.stack.undo.length&&(o.oldDelta=historystate[0].oldDelta),r?historystate[0]=o:historystate.unshift(o),$("#undo").removeClass("inactive"),future=[],$("#redo").addClass("inactive")),quill.restoring=!1,g.parents(".wcc-section").length&&(l=g.parents(".section-content"),d=innerDimensions(l[0]),l.height()+2*d.paddingTop>l.parent().height()&&l.parent().css("height",l.height()+2*d.paddingTop),g.width()>l.parent().width())&&l.parent().css("width",g.width()),quill.getContents());stageElemForSaving(h,{action:"updated"},{getCss:!0,getText:!0})}),quill.on("selection-change",function(e,t,a){!h.hasClass("empty-btn")&&quill.selection.lastRange&&0<quill.selection.lastRange.index&&h.removeClass("empty-btn"),e&&(setFontSizeSlider(e.index),g.parents().hasClass("btn")&&($("body").addClass("edit-btn"),h.hasClass("empty-btn")||(wirepanel.hide(),$("#wcc-toolbar-instance").show())),setCurrentTextColor())}),a||setTimeout(function(){quill&&quill.setSelection(0,quill.getLength())},20),$("#sel-text").find("p,li").has(".ql-lh-1").addClass("lh-1").css("line-height","1"),setFontSizeSlider(1),$("#wcc-toolbar-instance #line-height-ui-slider").slider({min:0,max:s.length-1,value:1,start:function(e,t){$(this).find(".val-label").show()},slide:function(e,t){quill.format("lh",s[t.value]);t.value},stop:function(e,t){$(this).find(".val-label").hide()}}),$("#wcc-toolbar-instance #font-size-ui-slider").slider({min:0,max:6,value:3,start:function(e,t){e.preventDefault()},slide:function(e,t){quillHandler(["12px","14px","16px",!1,"22px","28px","42px"][t.value],"customfontsize")}}),$("#wcc-toolbar-instance #wcc-toolbar-more").bind("click",function(e){$("#wcc-toolbar-instance").removeAttr("data-tooltip-show").toggleClass("wcc-more-options").find(".ql-picker.ql-expanded").removeClass("ql-expanded")}),$("#wcc-toolbar-instance").bind("mouseenter",function(e){e.stopPropagation(),quill.getSelection()&&0<quill.getSelection().length&&(quill.preservedSel=quill.getSelection()),quill.stopChangeEvent=!0}),$("#wcc-toolbar-instance").bind("mouseleave",function(e){quill.preservedSel=null}),$("#wcc-toolbar-instance").on("mouseup",".ql-picker-item , .ql-picker , button, .ui-slider-handle",function(e){$(this).is(".ql-picker")&&$("#wcc-toolbar-instance").removeAttr("data-tooltip-show").removeClass("wcc-more-options").find(".ql-picker.ql-expanded").not(this).removeClass("ql-expanded"),quill.stopChangeEvent=!1}).on("click",".ql-vertical-align",function(e){$(this).addClass("ql-expanded")}))}function focustext(){}var activepage,mousedownHappened=!1,editorHistory={};function getWpTextCoord(e){var t=$canvaswrap.position(),a=Math.round(e.position().left+e.width()/2+t.left),i=e.position().top+t.top-64;return i<60&&(i=e.position().top+t.top+e.height()>-$canvas.offset().top?e.position().top+t.top+e.height()+10:60),e.position().top>$container.height()-$canvas.offset().top&&(i=$container.height()-$canvas.offset().top-60),(a=a+222+$canvas.offset().left>$(window).width()?$(window).width()-256-$canvas.offset().left:a)+330+$canvas.offset().left>$(window).width()&&$container.addClass("ql-edge-case-e"),{l:a,tp:i}}let checker=(t,e)=>e.every(e=>t.includes(e));function blurRTE(e,t){if(!quill)return!1;selectedHovered=!1,$("#wcc-toolbar-instance").remove(),$("#sel-text").unbind("keydown");var a,i=$("#sel-text"),s=activepage.find("#sel-text").eq(0).parents(".wire").not(".grouped"),n=(s.data("text-event-bound",!1),a=!!s.hasClass("btn"),s.attr("id"),activepage.find("#sel-text").height()),o=(supercanvas.removeClass("rich-text-active"),$container.removeClass("ql-edge-case-e ql-edge-case-n"),quill.getText());"\n"!=o||a||s.remove(),quill=null,"Lorem"!==o.split(" ")[0]&&i.parents(".wirejr").data("lorem-count")&&i.parents(".wirejr").removeAttr("data-lorem-count").parent().removeClass("text-lorem").css({height:i.height(),width:i.width()});$("#sel-text .ql-editor").html(),new RegExp("(?![^<]+>) ","gi");s.find(".ql-editor").attr("contenteditable","false"),s.find(".textme").removeAttr("contenteditable"),$("*",s.find(".ql-editor")).each(function(){$(this).html(function(e,t){return t.replace(/^ */,function(e){return Array(e.length+1).join("&nbsp;")})})}),i=s.find(".ql-editor").html(),a||$("#sel-text").parents(".inner-flex-container").length||s.css({height:n}),s.removeClass("edited-text editingtext"),s.css({"z-index":"auto"}).find(".textme").removeClass("thelatest ql-container ql-snow").addClass("ql-editor").removeAttr("id").html(i).end(),a&&($("body").removeClass("edit-btn").removeClass("min-btn"),"\n"==o&&s.removeClass("text21 rich-text").addClass("empty-btn btn").find(".textme").removeClass("ql-editor").empty(),positionwirepanel(),s.find(".textme").off().end().find(".wirejr").off(),s.draggable("enable")),e||computeGuides(s)}function unselectAll(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}function modernizeWire(){}function textblur(){previewMode||useboxer();var e=$canvas.find(".editingtext"),t=(e.css("height"),e.parent().parent().parent().css("z-index","auto"),e.val().replace(/\n/gi,"<br>")),a=$("<div>");a.html(t=""===t?"...":t).addClass("textme"),e.replaceWith(a),a.closest(".wire").css({height:a.height(),position:"absolute"}),a.closest(".wirejr").draggable("destroy"),$("textarea.editingtext").remove()}function divClicked(e){supercanvas.boxer("destroy"),$(this).parent().addClass("latest");var t=$(this).html().replace(/<br>/gi,"\n"),a=$("<textarea class='editingtext'/>");a.val($("<div />").html(t).text()).addClass("textareanow"),$(this).replaceWith(a),a.focus(),a.blur(editableTextBlurred),$(".latest .ok").show(),$("textarea").autoResize(),$(".annotbox").addClass("textareainside"),$(".ok").click(editableTextBlurred)}function editableTextBlurred(){previewMode||useboxer(),($t=$(".textareanow")).parent().removeClass("latest");var e=$t.val().replace(/\n/gi,"<br>"),t=$("<div>");t.html(e=""===e?"...":e).insertBefore($t).click(divClicked),$t.remove(),$(".ok").hide(),previewMode&&(saveComment(),t.parent().parent().draggable({cancel:".annotbox , .closeannot",cursor:"move"}).resizable({handles:"n,e,w,s"}))}function selectColliders(e){}function findColliders(){var t={},e=activepage.find(".brandnew"),a=(t.top=e.offset().top/zoomfactor,t.left=e.offset().left/zoomfactor,t.right=Number(e.offset().left/zoomfactor)+Number(e.width()),t.bottom=Number(e.offset().top/zoomfactor)+Number(e.height()),$());activepage.find(".wire").not(".brandnew, .locked, .groupmember").each(function(){var e={};e.top=$(this).offset().top/zoomfactor,e.left=$(this).offset().left/zoomfactor,e.right=Number($(this).offset().left/zoomfactor)+Number($(this).width()),e.bottom=Number($(this).offset().top/zoomfactor)+Number($(this).height()),e.right<=t.right&&t.left<=e.left&&t.top<=e.top&&e.bottom<=t.bottom&&($(this).addClass("selected"),a=a.add($(this)))})}function useboxer(){supercanvas.boxer({cursor:"pointer",stop:function(e,t){var a,i,s,n;draggingInProgress=!1,snap={h:!1,v:!1},$canvaswrap.removeClass("dragging-in-progress"),$(".brandnew").hasClass("selecting")?$("#canvas .brandnew").remove():(n=t.box.height(),s=t.box.width(),10<t.box.width()&&10<t.box.height()?($("#main-btns").show().siblings().hide(),$("#library-wrapper").show(),$("#textinput").removeClass("lasticon"),a=(i=t.box.position()).top,i=i.left,$("#canvas-wrap").position().top,$("body").addClass("__before-insert"),populatePredictions(predictor.predict(s,n,i,a))):($(e.target).parents(".master-on").length?selectMaster(e.target):!$(e.target).hasClass("wirejr")&&!$(e.target).hasClass("textme")||selectingInProgress||$(e.target).parents(".wcc-section").length?$(e.target).hasClass("wire")&&selectWire($(e.target),e.shiftKey||e.metaKey||e.ctrlKey):(activepage.find(".group-active-prev").length&&!$(e.target).parents(".group-active").length&&(s=$(e.target).parents(".group-active-prev").first(),removeGuides(activepage.find(".group-active > div")),computeGuides(s.find(" > div")),s.find(".group-active-prev").removeClass("group-active-prev"),activepage.find(".group-active").removeClass("group-active"),s.addClass("group-active").removeClass("group-active-prev")),$(e.target).parents(".locked").length&&deselectAll(),selectWire($(e.target).parents(".wire"),e.shiftKey||e.metaKey||e.ctrlKey,null,e,$canvas.data("groupActive")||activepage.find(".group-active").length,$(e.target).parent().parent().hasClass("group-active"))),($(e.target).is("#grid")||$(e.target).is(".ui-boxer-helper")||$(e.target).is(".col"))&&(n=supercanvas.data("originalEventTarget"))&&(n.hasClass("wirejr")||n.hasClass("wire"))&&selectElem(n),t.box.remove()))}})}function prepareWire(e,t,a,i){var s=$(".brandnew"),n=(0===s.length&&(s=$("<div>").addClass("brandnew, blank").css({width:activepage.width(),height:"16px",top:bottommostPos+(0<bottommostPos?48:0),left:0}),activepage.append(s)),s.height()),o=s.width(),r="white"==appSettings.defaultStyle.fill?"":appSettings.defaultStyle.fill,l=1==appSettings.defaultStyle.width?"":appSettings.defaultStyle.width,d="#444"==appSettings.defaultStyle.stroke?"":appSettings.defaultStyle.stroke,o=o-2*appSettings.defaultStyle.width+(0<(gridsize&&appSettings.snapToGrid)?1:0),c=n-2*appSettings.defaultStyle.width+(0<(gridsize&&appSettings.snapToGrid)?1:0);"w-icon"==e&&(r=l=d="",(o=c<o?c:o)<c)&&(c=o),s.draggable("destroy").resizable("destroy").removeAttr("class").addClass("wirejr brandnew blank latestwire").empty().css({background:r,width:o,height:c,"border-width":l,"border-color":d}),"headlinetxt"!==e&&s.css({color:d}),s.addClass(e),"w-icon"==e&&s.append('<svg><use xlink:href="#'+t+'"></use></svg>'),"annotate"==e&&makeAADrag($(".brandnew.annotate").removeClass("wire").addClass("aa").append(annotationhtml)),"slider2"!=e&&"line_hor"!=e||s.addClass("resizeX"),"slider"==e&&(s.removeClass("slider").addClass("slider2").append("<span>"),i)&&s.css("height","16px"),"line_hor"==e&&s.css({"border-width":l}),"paragraph"==e&&s.append(paragraph).find("span").css("background",appSettings.defaultStyle.stroke),"textinput"==e&&s.removeClass("textinput").addClass("textinput2").append("<span>|</span>"),"combobox"==e&&(s.removeClass("combobox").addClass("combobox2").append("<span>&#9660;</span>"),i)&&s.css("height","32px"),"scrollh"==e&&s.removeClass("scrollh").addClass("scrollh2").append("<span class='arrL'>&#9664;</span>").append("<span >&#9654;</span>"),"progressbar"==e&&(s.removeClass("progressbar").addClass("progressbar2").append("<span></span>"),i)&&s.css("height","16px"),"list"==e&&s.append(list).find("span").css("background",appSettings.defaultStyle.stroke),"headlinetxt"==e&&s.addClass("textnew text21 text-arimo ").css("height",function(){return n<21?21:21*Math.floor(n/21)}).append('<div class="textme">').find(".textme").append(paragraphtext),"wcc-button"===e&&s.css({height:r=c<32?32:c,width:d=o<64?64:o}).append('<div class="wcc-button-text">').find(".wcc-button-text").text("Text").css({height:r,width:d}),s.hasClass("headline")&&$(".brandnew.headline").html(headtxt).find(".headtext span").css("background",appSettings.defaultStyle.stroke),s.hasClass("image"),insertWire(e,t,a)}function insertWire(e,t,c){if($(".brandnew").length){$body.removeClass("elem-lib-visible");var a=$(".brandnew"),i=a.closest(".wire"),s="line_vert"==e?appSettings.defaultStyle.width:a.width()+2*appSettings.defaultStyle.width,p="line_hor"==e?appSettings.defaultStyle.width:a.height()+2*appSettings.defaultStyle.width,n=a.position(),g=n.top,h=n.left;parseInt(a.css("zIndex"),10);if("section"==e){let o=$(".brandnew"),r=uuidv4(),l=parseInt(a.css("zIndex"),10);s>.7*activepage.width()&&(s=activepage.width(),h=0);let d;d=setTimeout(function(){$(".latestwire").addClass("section-pending")},600),fetch(ASSETES_URL+"/sections.html").then(e=>e.text()).then(e=>{var e=$(e).find("[section-type="+c+"]").clone().removeAttr("id").attr("id",r),t=(clearTimeout(d),o.removeClass("section-pending"),$(".preview-section-container")),t=(t.length?(t.css({height:e.outerHeight()}),t.empty().append(e)):o.replaceWith(e),$("#"+r)),e=(t.attr("data-optimal-width")?t.attr("data-optimal-width"):parseInt(t.css("min-width")),t.attr("data-optimal-height")?t.attr("data-optimal-height"):parseInt(t.css("min-height"))),a="none"==t.css("max-height")?1e4:parseInt(t.css("max-height"));"none"!=t.css("max-width")&&parseInt(t.css("max-width"));let i=p<=parseInt(e)?e:a<p?a:p;var s=activepage.width();i<t.find(".section-content").outerHeight()&&(i=t.find(".section-content").outerHeight());let n=[];t.find(".wire").each(function(e,t){var a=uuidv4();$(t).attr("id",a).find(".wirejr").css("z-index",l),n.push(a)}).end().show(),t.css({top:g,left:0,width:s,"min-width":t.css("min-width"),"min-height":e,"max-height":a,height:i});s=activepage.height();setBottomMostPos(t),bottommostPos>s&&changePageSize(null,s+(bottommostPos-s)),$("body").removeClass("__before-insert"),i;explodeSection(r),predictor.addExistingSection(c.split("-").slice(1,-1).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join("-"),g),n.length&&saveState("",n,null,null,null,!0),hideMagicToolbar()}).catch(e=>{})}"annotate"!==e&&"section"!==e?($body.removeClass("elem-lib-visible"),(a=$(".brandnew")).wrap("<div class='wire'></div>"),i=a.closest(".wire"),s="line_vert"==e?appSettings.defaultStyle.width:a.width()+2*appSettings.defaultStyle.width,p="line_hor"==e?appSettings.defaultStyle.width:a.height()+2*appSettings.defaultStyle.width,g=(n=a.position()).top,h=n.left,parseInt(a.css("zIndex"),10),saveState("",[n="w"+(new Date).getTime()]),i.css({top:g,left:h,width:s,height:p}).attr("id",n),a.css({top:"",left:"",width:"",height:""}),"wcc-button"===e&&(i.addClass("btn text21 rich-text").attr("preserve-h","").css({"--postop":"19px",height:Math.min(i.height(),64)+"px",position:"absolute"}),a.addClass("box").css({background:"rgb(68, 68, 68)","z-index":"2",position:"absolute","border-color":"transparent",color:"rgb(119, 119, 119)",height:"auto","border-radius":"6px"}).find(".wcc-button-text").removeClass("wcc-button-text").addClass("textme ql-editor").css({width:i.width()+"px",height:Math.min(i.height(),64)+"px"}).html('<p class="ql-align-center" style="font-size: 16px;"><span class="ql-color-f">Button</span></p>')),"image"===e&&i.attr("data-placeholder",!0).addClass("image-v2").find(".wirejr").css({background:"","border-color":""}),a.is(".aa")&&a.css("z-index","5000").removeClass("wirejr")):$(".brandnew").removeClass("wirejr").css("z-index",5e3),"headlinetxt"==e&&(a.css({height:p,width:s}).parent().addClass("hastext selected text21 text-lorem"),h=a.find(".textme").getShowingText(),a.find(".textme").html(h.text).parents(".wirejr").removeClass("lastheadline thelatest"),!1===detectIE()&&a.attr("data-lorem-count",h.count),mousedownHappened=!1,a.find(".textme").trigger("editThisText")),"annotate"==e&&($(".thelatest").click(),wirepanel.hide(),hideWirelib()),computeGuides(i),$(".brandnew").removeClass("blank brandnew"),"annotate"!==e&&(wirepanel.hide(),hideWirelib())}$("body").removeClass("__before-insert"),hideMagicToolbar(),$body.removeClass("elem-lib-visible"),setBottomMostPos(a)}function handleClone(e){quill&&blurRTE();var t=activepage.find(".selected");parseInt(activepage.find(".wire").highestZIndex().find(".wirejr").css("zIndex"),10);let r=[],l=$(),s;s=(1<e.length?$("#selection-transformator"):e.first()).data("initialPositions");let a={};e=t.filter(":not(.w-group-member)");let n=document.createDocumentFragment();return t.filter(".w-group-member").each(function(){var e=$(this).closest(".w-group:not(.w-group-member)").attr("id");a[e]||(a[e]=$()),a[e]=a[e].add(this)}),Object.entries(a).forEach(([e])=>{var e=$("#"+e),t=function s(e,n){var t="g-"+Math.floor(1e13+9e13*Math.random()),a=document.createDocumentFragment();let o=$('<div class="w-group"></div>').attr("id",t).data("originalId",e.attr("id"));a.appendChild(o[0]);t=e.children(".area-indicator").first().clone(),a=e.attr("id");return n&&n[a+"-indicator"]&&t.css({top:n[a+"-indicator"].top,left:n[a+"-indicator"].left}),o.append(t),e.children(".w-group-member").each(function(e){var t,a=$(this);let i;a.hasClass("w-group")?(i=s(a,n)).addClass("w-group-member"):(i=a.clone(),t="w"+Math.floor(1e13+9e13*Math.random()),r.push(t),i.draggable("destroy").resizable("destroy").radiusable("destroy").removeClass("selected").removeClass("edited-text").attr("id",t).data("originalId",a.attr("id")).find("#sel-text").removeAttr("id").end(),n&&n[a.attr("id")]&&i.css({top:n[a.attr("id")].top,left:n[a.attr("id")].left})),o.append(i)}),l=l.add(o),o}(e,s);e.before(t)}),e.each(function(e){var t=$(this),a=t.clone(),i="w"+Math.floor(1e13+9e13*Math.random());r.push(i),a.draggable("destroy").resizable("destroy").radiusable("destroy").removeClass("selected").removeClass("edited-text").attr("id",i).data("originalId",t.attr("id")).find("#sel-text").removeAttr("id").end(),s&&s[t.attr("id")]&&a.css({top:s[t.attr("id")].top,left:s[t.attr("id")].left}),n.appendChild(a[0]),l=l.add(a)}),0<e.length&&e.first().before(n),l}function makeDrag(e,t){t||!(e.find(".roundbox").length||e.find(".box").length||e.find(".wcc-button")||e.find(".combobox2").length||e.find(".btn").length)||e.hasClass("locked")||e.hasClass("w-group")||e.hasClass("wcc-section")||e.radiusable();function c(e){var t=parseInt(e.find("> .wirejr").css("z-index"))||0;let a={id:e.attr("id"),element:e,zIndex:t,children:[]};return e.hasClass("w-group")&&e.find("> .w-group-member").each(function(){a.children.push(c($(this)))}),a}e.not(".groupmember , .wirejr , .locked, .w-group, .aa").draggable({distance:2,cancel:".wcc-ui-draggable-disabled",alsoDrag:function(e){var t,a;return activepage.find("#selection-transformator").length||activepage.find(".selected.grouped").length?".selected, .g-selected .area-indicator, .section-selected":!appSettings.drawOnTop&&!(!e||!$(e.target).parent().hasClass("w-group-member")||(a=(t=$(e.target).parent()).parentsUntil("#"+app.activepage.id).last()).hasClass("group-active")&&!t.parents(".w-group.w-group-member").length)&&(a.hasClass("group-active")&&t.parents(".w-group.w-group-member").length?"#"+t.parent(".w-group.w-group-member").attr("id")+" .wire:not(#"+t.attr("id")+"), #"+t.parent(".w-group.w-group-member").attr("id")+" .area-indicator":"#"+a.attr("id")+" .wire:not(#"+t.attr("id")+"), #"+a.attr("id")+" .area-indicator, #selection-transformator")},start:function(e,t){var i=$(this),s=(autoSaveTimeout&&clearTimeout(autoSaveTimeout),i.data("cloned",null),activepage.find(".selected, .g-selected")),n={};let a={};s.each(function(){var e,t;e=$(this),a[e.attr("id")]={top:e.position().top,left:e.position().left},e.hasClass("w-group")&&(t=e.find("> .area-indicator"),a[e.attr("id")+"-indicator"]={top:t.position().top,left:t.position().left})}),i.data("initialPositions",a),i.data("originalPositions",n),i.data("wasAltPressed",!1),i.data("selectedElements",s);let o=[];if(s.each(function(){o.push({id:$(this).attr("id"),zIndex:parseInt($(this).find(".wirejr").css("z-index"))||0})}),i.data("originalZIndexes",o),e.altKey){n=handleClone(i);i.data("clones",n),i.data("wasAltPressed",!0);let t=Math.max(...activepage.find(".wire .wirejr").map(function(){return parseInt($(this).css("z-index"))||0}).get()),a=[];function r(e,t){t=function t(e,a){for(var i of e){if(i.id===a)return i;if(i.children){let e=t(i.children,a);if(e)return e}}return null}(t,e.attr("id"));return t&&parseInt(t.zIndex)||0}s.each(function(){a.push(c($(this)))}),i.data("selectedHierarchy",a),s.each(function(){$(this).hasClass("w-group")||$(this).find(".wirejr").css("z-index",t+1)}),s.each(function(){$(this).hasClass("w-group")?function e(t,a,i){t.find("> .wirejr").each(function(){var e=r($(this).parent(),a);$(this).css("z-index",i+e)}),t.find("> .w-group-member").each(function(){let t=$(this);t.find("> .wirejr").each(function(){var e=r(t,a);$(this).css("z-index",i+e)}),t.hasClass("w-group")&&e(t,a,i)})}($(this),a,t):$(this).find(".wirejr").each(function(){var e=r($(this).parent(),a);$(this).css("z-index",t+e)})})}selection.cancel(),quill&&blurRTE(),draggingInProgress=!0,appSettings.drawOnTop||e.stopPropagation(),appSettings.snapToGuides&&!e.altKey&&(draggingInProgress={id:i.attr("id")}),$canvaswrap.addClass("dragging-in-progress"),$guideH.hide(),$guideV.hide(),snap={h:!1,v:!1},$canvaswrap.find(".brandnew").remove(),e.altKey||saveState(),$canvas.data("groupActive")&&activepage.find(".w-group.w-group-member .selected").length&&removeGuides(activepage.find(".selected").parents(".w-group.w-group-member")),h=parseInt($(this).css("borderLeftWidth"),10),$(".selected.locked").removeClass("selected"),t.helper.data("draggableXY.originalPosition",{top:t.helper[0].offsetTop,left:t.helper[0].offsetLeft}),t.helper.data("draggableXY.newDrag",!0),activepage.find(".selected:not(.locked)"),showWireDim(i),(i.hasClass("hastext")?$("#wcc-toolbar-instance"):wirepanel).hide(),posTopArray=[],posLeftArray=[],parseInt(t.helper.css("margin-top"),10),parseInt(t.helper.css("margin-left"),10),innerOffsetX=e.pageX-this.offsetLeft,innerOffsetY=e.pageY-this.offsetTop;var l,d=[];$(e.target).parents(".wire.selected").length?activepage.find(" > .wire.selected").each(function(){d.push($(this).attr("id"))}):d.push($(e.target).parents(".wire.selected").attr("id")),d.push(i.attr("id")),i.is(".grouped")&&(l=[],i.find("  .groupmember").each(function(){l.push($(this).attr("id"))}),i.data("groupIds",l)),0<gridsize&&appSettings.snapToGrid&&!e.altKey&&(n={top:i.position().top-Math.round(i.position().top/gridsize)*gridsize,left:i.position().left-Math.round(i.position().left/gridsize)*gridsize},$(this).draggable("option","grid",[gridsize,gridsize]),$.extend(i.data("draggable"),{gridDelta:n})),$.extend(i.data("draggable"),{originalPosition:{top:$(this).position().top,left:$(this).position().left}}),$(this).get(0).style.removeProperty("--postop"),$(this).get(0).style.removeProperty("--posleft"),$canvas.data("groupActive")&&$(this).data("ui-draggable-area-ind",!!activepage.find(".group-active.has-section").length&&getMultiElemArea(activepage.find(".group-active > .area-indicator")))},drag:function(a,i){var e=$(this),s=e.data("wasAltPressed");if(appSettings.snapToGuides&&!a.altKey&&$.extend(draggingInProgress,{heightcenter:i.position.top+i.helper[0].clientHeight/2,widthcenter:i.position.left+i.helper[0].clientWidth/2,left:i.position.left,top:i.position.top,right:i.position.left+i.helper[0].clientWidth,bottom:i.position.top+i.helper[0].clientHeight}),a.altKey&&($guideH.hide(),$guideV.hide(),snap={h:!1,v:!1},activepage.add("#canvas > .master-on").find("[data-snap-mark-h]").removeAttr("data-snap-mark-h"),activepage.add("#canvas > .master-on").find("[data-snap-mark-v]").removeAttr("data-snap-mark-v")),a.altKey!==s){if(a.altKey){var s=e.data("initialPositions"),n=e.data("selectedElements");if(!s||!n)return;e.data("clones")||(s=handleClone(n),e.data("clones",s));let t=Math.max(...activepage.find(".wire .wirejr").map(function(){return parseInt($(this).css("z-index"))||0}).get()),a=[];function o(e,t){t=function t(e,a){for(var i of e){if(i.id===a)return i;if(i.children){let e=t(i.children,a);if(e)return e}}return null}(t,e.attr("id"));return t&&parseInt(t.zIndex)||0}n.each(function(){a.push(c($(this)))}),e.data("selectedHierarchy",a),e.data("clones")||(s=handleClone(n),e.data("clones",s)),n.each(function(){$(this).hasClass("w-group")||$(this).find(".wirejr").css("z-index",t+1)}),n.each(function(){$(this).hasClass("w-group")?function e(t,a,i){t.find("> .wirejr").each(function(){var e=o($(this).parent(),a);$(this).css("z-index",i+e)}),t.find("> .w-group-member").each(function(){let t=$(this);t.find("> .wirejr").each(function(){var e=o(t,a);$(this).css("z-index",i+e)}),t.hasClass("w-group")&&e(t,a,i)})}($(this),a,t):$(this).find(".wirejr").each(function(){var e=o($(this).parent(),a);$(this).css("z-index",t+e)})})}else e.data("clones")&&(e.data("clones").remove(),e.data("clones",null));e.data("wasAltPressed",a.altKey)}a.shiftKey&&(s=i.helper.data("draggableXY.originalPosition"),n=Math.abs(s.left-i.position.left),s=Math.abs(s.top-i.position.top),r=i.helper.data("draggableXY.newDrag"),i.helper.data("draggableXY.newDrag",!1),r=r?Math.max(n,s)===n:i.helper.data("draggableXY.xMax"),i.helper.data("draggableXY.xMax",r),i.position,r&&$(this).draggable("option","axis","x"),r||$(this).draggable("option","axis","y"));s=snap.h,n=snap.v;if(appSettings.snapToGuides&&!a.altKey){wireDistV=1e3;if(s){let e=$("#"+snappedIdH);if(0==(e=e.hasClass("w-group")?e.find(" > .area-indicator"):e).length)return;var r=e.width(),a=e.position().left,l={x:!(draggingInProgress.left<a&&draggingInProgress.right<a)&&(draggingInProgress.left>a+r||draggingInProgress.left-a<a+r-draggingInProgress.right)?draggingInProgress.left:draggingInProgress.right};n&&(l.x==draggingInProgress.right&&"right"!==n.snappedEdge?l.x=n.x+i.helper.width()/("widthcenter"==n.snappedEdge?2:1):l.x==draggingInProgress.left&&"left"!==n.snappedEdge?l.x=n.x-i.helper.width()/("widthcenter"==n.snappedEdge?2:1):l.x=n.x);let t=l.x<a?a-l.x:a+r<l.x?l.x-a-r:l.x<a+r/2?l.x-a:a+r-l.x;1==t&&(t=0),$guideH.addClass("visible").show().css({top:s.y+"px",left:l.x<a?l.x:a+r<l.x?a+r:l.x<a+r/2?a:l.x,width:t,display:0<t?"flex":"none"}).attr("data-dist",l.x<a?Math.round(a-l.x):a+r<l.x?Math.round(l.x-(a+r)):Math.round(t)),activepage.add("#canvas > .master-on").find("[data-snap-mark-h]").removeAttr("data-snap-mark-h"),markAadjacentElement(s,snappedIdH);l=0;"bottom"==s.snappedEdge&&(l=i.helper.height()-1),"heightcenter"==s.snappedEdge&&(l=Math.round((i.helper.height()-1)/2)),i.position.top=s.y-l}else $guideH.hide();if(n){let e=$("#"+snappedIdV);if(0==(e=e.hasClass("w-group")?e.find(" > .area-indicator"):e).length)return;a=e.height(),r=e.position().top,l={y:!(draggingInProgress.top<r&&draggingInProgress.bottom<r)&&(draggingInProgress.top>r+a||draggingInProgress.top-r<r+a-draggingInProgress.bottom)?draggingInProgress.top:draggingInProgress.bottom};s&&(l.y==draggingInProgress.bottom&&"bottom"!==s.snappedEdge?l.y=s.y+i.helper.height()/("heightcenter"==s.snappedEdge?2:1):l.y==draggingInProgress.top&&"top"!==s.snappedEdge?l.y=s.y-i.helper.height()/("heightcenter"==s.snappedEdge?2:1):l.y=s.y);let t=l.y<r?r-l.y:r+a<l.y?l.y-r-a:l.y<r+a/2?l.y-r:r+a-l.y;1==t&&(t=0),$guideV.addClass("visible").show().css({left:n.x+"px",top:l.y<r?l.y:r+a<l.y?r+a:l.y<r+a/2?r:l.y,height:t,display:0<t?"flex":"none"}).attr("data-dist",l.y<r?Math.round(r-l.y):r+a<l.y?Math.round(l.y-(r+a)):Math.round(t)),activepage.add("#canvas > .master-on").find("[data-snap-mark-v]").removeAttr("data-snap-mark-v"),markAadjacentElement(n,snappedIdV);s=0;"right"==n.snappedEdge&&(s=i.helper.width()-1),"widthcenter"==n.snappedEdge&&(s=Math.round((i.helper.width()-1)/2)),i.position.left=n.x-s}else $guideV.hide()}0<gridsize&&appSettings.snapToGrid&&e.data("draggable").originalPosition&&(i.position.top=i.position.top-e.data("draggable").gridDelta.top,i.position.left=i.position.left-e.data("draggable").gridDelta.left,$.extend(e.data("draggable").position,{top:i.position.top,left:i.position.left})),showWireDim({x:parseInt(i.position.left,10),y:parseInt(i.position.top,10),w:i.helper[0].offsetWidth,h:i.helper[0].offsetHeight}),i.position.top=Math.round(i.position.top),i.position.left=Math.round(i.position.left),e.css({top:i.position.top,left:i.position.left}),$canvas.data("groupActive")},stop:function(e,t){appSettings.drawOnTop||e.stopPropagation();var a=$(this),n=a.data("clones");if(e.altKey&&n){var l=a.data("selectedElements");let i=a.data("initialPositions"),s=a.data("originalZIndexes"),o=Math.max(...activepage.find(".wire .wirejr").map(function(){return parseInt($(this).css("z-index"))||0}).get()),r={};var d=l.filter(".w-group");function c(e,t){let s=e.data("originalId");var a=r[s];if(a){e.css({top:a.top,left:a.left});let i=null;if(t)for(var n of t)if(function e(t){if(t.id===s)return i=t,1;if(t.children)for(var a of t.children)if(e(a))return 1}(n))break;i&&(a=function(e){let t=0,a=e;for(;a.length&&!a.is(activepage);)t+=parseInt(a.find("> .wirejr").css("z-index"))||0,a=a.parent().closest(".w-group-member");return t}(i.element),e.find("> .wirejr").css("z-index",o+a)),e.hasClass("w-group")&&((a=r[s+"-indicator"])&&e.find("> .area-indicator").css({top:a.top,left:a.left}),e.find("> .w-group-member").each(function(){c($(this),t)}))}}l.not(".w-group").each(function(){var e=$(this);r[e.attr("id")]={top:e.position().top,left:e.position().left}}),d.each(function(){!function t(e){var a=e.attr("id"),i=(r[a]={top:e.position().top,left:e.position().left},e.find("> .area-indicator"));r[a+"-indicator"]={top:i.position().top,left:i.position().left},e.find("> .w-group-member").each(function(){var e=$(this);r[e.attr("id")]={top:e.position().top,left:e.position().left},e.hasClass("w-group")&&t(e)})}($(this))}),l.each(function(){!function e(t){var a=i[t.attr("id")];a&&(t.css({top:a.top,left:a.left}),t.hasClass("w-group"))&&((a=i[t.attr("id")+"-indicator"])&&t.find("> .area-indicator").css({top:a.top,left:a.left}),t.find("> .w-group-member").each(function(){e($(this))}))}($(this))}),l.each(function(){!function e(t){let a=t.attr("id");var i=s.findIndex(e=>e.id===a);-1!==i&&(t.find("> .wirejr").css("z-index",s[i].zIndex),t.hasClass("w-group"))&&t.find("> .w-group-member").each(function(){e($(this))})}($(this))});let e=a.data("selectedHierarchy");n.each(function(){c($(this),e)}),deselectAll();d=n.add(n.filter(".w-group").find(".w-group-member"));1<d.length?selectWire(d,!1,d):selectWire(d),a.data("clones",null),saveState("",function e(t){let a=[];return t.each(function(){a.push($(this).attr("id")),$(this).hasClass("w-group")&&$(this).find(".w-group-member").each(function(){a=a.concat(e($(this)))})}),a}(n),!1,!1,null,"pasted")}else!e.altKey&&n&&n.remove();a.removeData("initialPositions"),a.removeData("wasAltPressed"),a.removeData("selectedElements"),t.position.top+a.height()>bottommostPos&&(bottommostPos=t.position.top+a.height(),$body.get(0).style.setProperty("--bottom-most-pos",bottommostPos+"px"));snap.h,snap.v;if($("#guide-v, #guide-h").hide(),removeMarkedElemBorder(),draggingInProgress=!1,$canvaswrap.removeClass("dragging-in-progress"),snap={h:!1,v:!1},activepage.find(".selected").length===activepage.find(".selected.hastext").length?selectWire(activepage.find(".selected.hastext")):positionwirepanel(),a.data("altdrag",!1),this.matches("#selection-transformator")||computeGuides($(this)),$canvas.data("groupActive"))computeGuides(activepage.find(".group-active > .wire , .group-active > .w-group"));else{if(appSettings.drawOnTop)return;appSettings.drawOnTop||$(".group-active .selected").length||(deselectAll(),selectWire($(this)))}$(this).draggable("option","axis","none"),removeMarkedElemBorder(),positionSecBtn()}});var h=2;e.not(".groupmember , .wirejr , .locked, .w-group").resizable({autoHide:!1,grid:[1,1],destroy:function(e,t){$(this).find(".ui-border-radius-handle").remove()},start:function(e,t){selection.cancel(),autoSaveTimeout&&clearTimeout(autoSaveTimeout),quill&&blurRTE(!0),multipaged?$("#canvas .page:visible .selected"):$("#canvas .selected");var a=$(this);draggingInProgress=!0,appSettings.snapToGuides&&!e.altKey&&(draggingInProgress={id:a.attr("id")}),$canvaswrap.addClass("dragging-in-progress"),resizingInProgress=!0,$canvas.data({guideH:!1,guideV:!1}),a.data({resizing:!0}),$guidesHV.hide(),removeMarkedElemBorder(),a.data("resizable").handle=a.data("resizable").axis,$("#guide-v , #guide-h").hide(),handle=$(this).data("resizable").axis,saveState(),h=parseInt($(this).find(".wirejr").css("borderLeftWidth"),10),wirepanel.hide(),!$(this).hasClass("wcc-section")&&$(this).find(".wirejr").hasClass("w-icon")&&(a.resizable("option","aspectRatio",!0).data("resizable")._aspectRatio=!0),$(this).hasClass("wcc-section")&&((e=a.find(".section-content > .inner-flex-container:not(.flexible) > div").last()[0]).offsetTop,e.offsetHeight,a.css({minHeight:"",minWidth:""})),$canvas.data("groupActive")&&$(this).data("ui-resizable-area-ind",!!activepage.find(".group-active.has-section").length&&getMultiElemArea(activepage.find(".group-active > .area-indicator")))},resize:function(e,a){var i=!$(this).hasClass("wcc-section")&&$(this).find(".wirejr.w-icon").length,s=this.matches("#selection-transformator")&&1<activepage.find(".selected .textme").length,n=$(this),o=n.data("resizable").handle;h=1,appSettings.snapToGuides&&!e.altKey&&("n"!==o&&"ne"!==o&&"nw"!==o||$.extend(draggingInProgress,{top:a.position.top}),"s"!==o&&"se"!==o&&"sw"!==o||$.extend(draggingInProgress,{bottom:a.position.top+a.size.height}),"w"!==o&&"sw"!==o&&"nw"!==o||$.extend(draggingInProgress,{left:a.position.left}),"e"!==o&&"se"!==o&&"ne"!==o||$.extend(draggingInProgress,{right:a.position.left+a.size.width}),$.extend(draggingInProgress,{isIcon:i}),r=snap.h,l=snap.v);var r,l,d=a.size.width,c=a.size.height;if(r){var p,g=Math.round(r.y);"top"==r.snappedEdge&&(p=g-a.position.top,a.position.top=parseInt(g),a.size.height-=p,n.css("top",g),s||n.height(function(e,t){return a.size.height})),"bottom"==r.snappedEdge&&(a.size.height=g-a.position.top+1,n.height(function(e,t){return a.size.height})),i&&(l||"nw"!==o&&"sw"!==o||(p=a.size.height-d,n.css("left",a.position.left-p)),n.width(function(){return a.size.height}));let e=$("#"+snappedIdH);var s=(e=e.hasClass("w-group")?e.find(" > .area-indicator"):e).width(),g=e.position().left,d={x:!(a.position.left<g&&a.position.left+a.size.width<g)&&(a.position.left>g+s||a.position.left-g<g+s-a.position.left+a.size.width)?a.position.left:a.position.left+a.size.width};l&&(d.x==a.position.left+a.size.width&&"right"!==l.snappedEdge?d.x=l.x+a.helper.width()/("widthcenter"==l.snappedEdge?2:1):d.x==a.position.left&&"left"!==l.snappedEdge?d.x=l.x-a.helper.width()/("widthcenter"==l.snappedEdge?2:1):d.x=l.x);let t=d.x<g?g-d.x:g+s<d.x?d.x-g-s:d.x<g+s/2?d.x-g:g+s-d.x;1==t&&(t=0),$guideH.addClass("visible").show().css({top:r.y+"px",left:d.x<g?d.x:g+s<d.x?g+s:d.x<g+s/2?g:d.x,width:t,display:0<t?"flex":"none"}).attr("data-dist",d.x<g?Math.round(g-d.x):g+s<d.x?Math.round(d.x-(g+s)):Math.round(t)),"hm"==r.type&&"c"==r.pos?e.get(0).style.setProperty("--postop",r.y-e.position().top+"px"):e.get(0).style.removeProperty("--postop"),activepage.add("#canvas > .master-on").find("[data-snap-mark-h]").removeAttr("data-snap-mark-h"),markAadjacentElement(r,snappedIdH)}else $guideH.hide();if(l){"left"==l.snappedEdge&&(deltaW=Math.round(l.x)-a.position.left,a.position.left=Math.round(l.x),a.size.width-=deltaW,n.css("left",Math.round(l.x)),n.width(function(e,t){return a.size.width})),"right"==l.snappedEdge&&(a.size.width=Math.round(l.x)-a.position.left+1,n.width(function(e,t){return a.size.width})),i&&(r||"ne"!==o&&"nw"!==o||(p=a.size.width-c,n.css("top",a.position.top-p)),n.height(function(){return a.size.width}));let e=$("#"+snappedIdV);d=(e=e.hasClass("w-group")?e.find(" > .area-indicator"):e).height(),g=e.position().top,s={y:!(a.position.top<g&&a.position.top+a.size.height<g)&&(a.position.top>g+d||a.position.top-g<g+d-a.position.top+a.size.height)?a.position.top:a.position.top+a.size.height};r&&(s.y==a.position.top+a.size.height&&"bottom"!==r.snappedEdge?s.y=r.y+a.helper.height()/("heightcenter"==r.snappedEdge?2:1):s.y==a.position.top&&"top"!==r.snappedEdge?s.y=r.y-a.helper.height()/("heightcenter"==r.snappedEdge?2:1):s.y=r.y);let t=s.y<g?g-s.y:g+d<s.y?s.y-g-d:s.y<g+d/2?s.y-g:g+d-s.y;1==t&&(t=0),$guideV.addClass("visible").show().css({left:l.x+"px",top:s.y<g?s.y:g+d<s.y?g+d:s.y<g+d/2?g:s.y,height:t,display:0<t?"flex":"none"}).attr("data-dist",s.y<g?Math.round(g-s.y):g+d<s.y?Math.round(s.y-(g+d)):Math.round(t)),"vm"==l.type&&"c"==l.pos?e.get(0).style.setProperty("--posleft",l.x-e.position().left+"px"):e.get(0).style.removeProperty("--posleft"),activepage.add("#canvas > .master-on").find("[data-snap-mark-v]").removeAttr("data-snap-mark-v"),markAadjacentElement(l,snappedIdV)}else $guideV.hide();0<gridsize&&appSettings.snapToGrid&&!e.altKey&&(i=a.position.left,c=a.position.top,p=a.size.width,r=a.size.height,s=a.position.left+p,g=a.position.top+r,snappedleft=Math.round(i/gridsize)*gridsize,snappedright=Math.round(s/gridsize)*gridsize,snappedtop=Math.round(c/gridsize)*gridsize,snappedbottom=Math.round(g/gridsize)*gridsize,Math.abs(snappedleft-a.position.left),Math.abs(snappedright-a.position.left-p),Math.abs(snappedtop-a.position.top),Math.abs(snappedbottom-a.position.top-r),"se"==o&&(a.size.width=snappedright-i+1,a.size.height=snappedbottom-c+1),"e"==o&&(a.size.width=snappedright-i+1),"s"==o&&(a.size.height=snappedbottom-c+1),"w"==o&&(a.size.width=s-snappedleft,a.position.left=snappedleft),"n"==o&&(a.size.height=g-snappedtop,a.position.top=snappedtop),"nw"==o&&(a.size.height=g-snappedtop,a.position.top=snappedtop,a.size.width=s-snappedleft,a.position.left=snappedleft),"ne"==o&&(a.size.height=g-snappedtop,a.position.top=snappedtop,a.size.width=snappedright-i+1),"sw"==o)&&(a.size.width=s-snappedleft,a.position.left=snappedleft,a.size.height=snappedbottom-c+1),showWireDim({w:parseInt(a.size.width+2*h-1,10),h:parseInt(a.size.height+2*h-1,10),x:parseInt(a.position.left,10),y:parseInt(a.position.top,10)}),n.hasClass("wire")&&$(this).has(".textnew").length&&$(this).height($(this).find(".textme").height()-2),$(this).hasClass("btn")&&$(this).find(".textme").css({width:a.size.width-2*h,height:a.size.height-2*h}),$(this).hasClass("svginside")&&(d=a.size.width,$(".ui-resizable-resizing svg ").css("width",d),l=a.size.height,$(".ui-resizable-resizing svg ").css("height",l)),activepage.find(".selected .hasSVG").each(function(e,t){var a,i,t=$(t);t.find(".cross-v2").length||(a=t.width(),i=t.height(),parseInt(t.find(".line2").attr("stroke-width")),t.find(".line1").attr("x2",a),t.find(".line1").attr("y1",i),t.find(".line2").attr("x2",a),t.find(".line2").attr("y2",i),t.find("svg").attr("height",i),t.find("svg").attr("width",a))}),$(this).parents(".group-active").length&&updateActiveGroupOutline($(this).data("ui-resizable-area-ind"),a)},stop:function(e,t){var a=snap.h,i=snap.v,s=(a&&t.position.top!==$(this).position().top&&$(this).css("top",t.position.top),$guidesHV.hide(),removeMarkedElemBorder(),activepage.find(".selected"));let n;1<s.length?n=["w","h","l","t"]:(n=[],t.originalSize.width!==t.size.width&&n.push("w"),t.originalSize.height!==t.size.height&&n.push("h"),t.originalPosition.top!==t.position.top&&n.push("t"),t.originalPosition.left!==t.position.left&&n.push("l")),stageElemForSaving(s,{action:"updated"},{getCss:n});var o=s.filter(".hastext").length==s.length;o?selectElem(s):positionwirepanel(s,o,null,!0),$(this).hasClass("wcc-section")||!$(this).find(".wirejr").hasClass("w-icon")||i||a||($(this).width(Math.round(t.size.width)),$(this).height(Math.round(t.size.height))),$(this).data("resizing",!1),draggingInProgress=resizingInProgress=selectedHovered=!1,$canvaswrap.removeClass("dragging-in-progress"),$("#guide-v , #guide-h").hide(),snap={h:!1,v:!1},this.matches("#selection-transformator")||computeGuides($(this)),$canvas.data("groupActive")&&computeGuides(activepage.find(".group-active > .wire , .group-active > .w-group")),$(this).data("resizing",!1),$(".ui-resizable-resizing").hasClass("svginside")&&(s=t.size.width,$(".ui-resizable-resizing svg ").css("width",s),o=t.size.height,$(".ui-resizable-resizing svg ").css("height",o)),$(this).radiusable("positionHandles"),removeMarkedElemBorder(),positionSecBtn()},snap:" .col ",handles:"all",alsoResize:!(!activepage.find("#selection-transformator").length&&!activepage.find(".selected.grouped"))&&".selected, .g-selected .area-indicator, .section-selected"}),e.each(function(){$(this).hasClass("wire")&&$(this).has(".textnew").length&&$(this).find(".ui-resizable-ne, .ui-resizable-nw, .ui-resizable-sw, .ui-resizable-se, .ui-resizable-n, .ui-resizable-s").remove()})}$canvas.find(".textme").removeAttr("contenteditable"),modernizeWire(),$(".ok").click(editableTextBlurred),$canvas.on("editThisText",".textme","editThisText",function(e,t){$(this).parents(".masterpage.master-on").length||edittext(e,this,$(this).parents(".wire").hasClass("btn"),t)}),$canvas.on("click",".selected.hastext .ql-editor",function(e){e.stopPropagation(),$(this).attr("contenteditable",!0),$(this).parents(".wire").removeClass("selected").draggable("destroy").resizable("destroy"),quill.setSelection(0,quill.getLength())}),$.widget("ui.boxer",$.extend({},$.ui.mouse,{_init:function(){this.element.addClass("ui-boxer"),this.dragged=!1,this._mouseInit(),this.helper=$(document.createElement("div")).css({background:"rgba(58, 66, 74, .4)"}).addClass("ui-boxer-helper")},destroy:function(){return this.element.removeClass("ui-boxer ui-boxer-disabled").removeData("boxer").unbind(".boxer"),this._mouseDestroy(),this},_mouseStart:function(e){var t,a,i,s,n=$(e.target),o=$canvas.data("groupActive")&&(n.hasClass("area-indicator")||n.hasClass("wirejr"));quill&&(n.hasClass("textme")&&$body.hasClass("edit-btn")&&(t=!0),blurRTE(),t?(render_edit_menu(),positionwirepanel(n.parents(".wire"))):(wirepanel.hide(),hideMagicToolbar(),$("body").removeClass("__before-insert"))),($(e.target).hasClass("overlay")||$("body").hasClass("slide-right")||$("body").hasClass("slide-down")||$("body").hasClass("slide-left")||$("body").hasClass("show-device-skin-popup")||$("body").hasClass("top-dd-active")||$("body").hasClass("show-icon-picker")||$("body").hasClass("show-links-panel")||$("body").hasClass("__before-insert")||$("body").hasClass("elem-lib-visible"))&&feuxOverlayClicked(),app&&app.activepage.masterpageSelected&&deselectMaster(),o||(draggingInProgress=!0),!appSettings.snapToGuides||e.altKey||o||(draggingInProgress={}),$(e.target).hasClass("unlock_inner_btn")||(e.ctrlKey||e.shiftKey||e.metaKey||t||(deselectAll(n.hasClass("wirejr"),n.parents(".group-active").length||n.parents(".group-active-prev").length),controlIconsHide(),activepage.find(".section-selected").length&&selectSection(activepage.find(".section-selected"),{makeDraggable:!0})),$(e.target).hasClass("wire")||$(e.target).hasClass("wirejr")||showWireDim(!1),$("#canvas .latestwire").removeClass("latestwire"),$(".blank, .section-pending").remove(),(o=this).opos=(t=e,n=snap.v,s=snap.h,n?(a=roundHalf(n.x+$canvas.offset().left),o.origSnapX=n.x,snap.v=!1):a=t.pageX,s?(i=roundHalf(s.y+$canvas.offset().top),o.origSnapY=s.y,snap.h=!1):i=t.pageY,appSettings.snapToGrid&&0<gridsize&&!t.altKey&&(a=$canvas.offset().left+Math.round((a-$canvas.offset().left)/gridsize)*gridsize,i=$canvas.offset().top+Math.round((i-$canvas.offset().top)/gridsize)*gridsize),{x:a,y:i}),this.options.disabled)||(n=this.options,this.prevMouseX=e.clientX,this.prevMouseY=e.clientY,this.prevTime=performance.now(),this._trigger("start",e),$(n.appendTo).append(this.helper),this.helper.css({"z-index":99,position:"absolute",left:this.opos.x,top:this.opos.y,width:0,height:0}))},_mouseDrag:function(e){if(selectingInProgress)return!1;if(!$(e.target).parents(".group-active").length){$canvas.data("drawing-in-progress",!0),$canvaswrap.addClass("dragging-in-progress"),draggingInProgress={};this.options;var t,a,i,s,n,o,r,l,d,c=this.opos.x,p=this.opos.y;this.selecting||!appSettings.snapToGuides||e.altKey||(t=$canvas.offset(),t={x:parseInt(e.pageX-t.left),y:parseInt(e.pageY-t.top)},this.x2corr||this.y2corr||$.extend(draggingInProgress,{right:t.x,bottom:t.y}),this.x2corr&&!this.y2corr&&(delete draggingInProgress.right,$.extend(draggingInProgress,{left:t.x,bottom:t.y})),!this.x2corr&&this.y2corr&&(delete draggingInProgress.bottom,$.extend(draggingInProgress,{top:t.y,right:t.x})));if(this.dragged=!0,!this.options.disabled)return a=snap.h,i=snap.v,y2=a&&!this.selecting?parseInt(a.y+$canvas.offset().top):e.pageY,x2=i&&!this.selecting?parseInt(i.x+$canvas.offset().left):e.pageX,appSettings.snapToGrid&&0<gridsize&&!this.selecting&&!e.altKey&&(x2=$canvas.offset().left+Math.round((x2-$canvas.offset().left)/gridsize)*gridsize,y2=$canvas.offset().top+Math.round((y2-$canvas.offset().top)/gridsize)*gridsize),0<c-x2&&0<p-y2?(this.helper.addClass("selecting"),$guidesHV.hide(),removeMarkedElemBorder(),snap={h:!1,v:!1},this.selecting||(draggingInProgress=!1,selection.trigger(e,!0)),this.selecting=!0):(this.seleting&&selection.cancel(),this.selecting=!1),this.lastx1=c,this.lastx2=x2,this.lasty1=p,this.lasty2=y2,c>x2?(n=x2,x2=c,c=n,this.x2corr=!0):this.x2corr=!1,p>y2?(n=y2,y2=p,p=n,this.y2corr=!0):this.y2corr=!1,this.x1=c,this.y1=p,n=i&&!this.x2corr||this.origSnapX?roundHalf(x2-c)+zoomfactor:roundHalf(x2-c),s=e.shiftKey?n:a&&!this.y2corr||this.origSnapY?roundHalf(y2-p)+zoomfactor:roundHalf(y2-p),o=performance.now(),r=e.clientX-this.prevMouseX,l=e.clientY-this.prevMouseY,l=Math.sqrt(r**2+l**2),d=o-this.prevTime,(this.expanded||5<l/d&&n>$canvas.width()/2)&&(this.expanded=-4<=r),this.prevMouseX=e.clientX,this.prevMouseY=e.clientY,this.prevTime=o,this.helper.css({left:this.expanded?$canvaswrap.offset().left:c,top:p,width:this.expanded?$canvas.width():n,height:s}),showWireDim({x:c,y:p,w:n,h:s},!0),a&&!this.selecting?drawGuideH(e,t,c,x2):$guideH.hide(),i&&!this.selecting?drawGuideV(e,t,p,y2):$guideV.hide(),this._trigger("drag",e),!1}},_mouseStop:function(e){this.prevMouseX=null,this.prevMouseY=null,this.prevTime=null,$canvas.data("drawing-in-progress",!1),$canvaswrap.removeClass("dragging-in-progress");var t=snap.h,a=snap.v,i=(this.lastx1>this.lastx2&&(s=this.lastx2,(i=this.origSnapX)||this.opos.x,this.x2=this.x1,this.x1=s,a&&(this.origSnapX=a.x,a=!1),i)&&(a.x=i,this.origSnapX=s/zoomfactor-$canvas.offset().left/zoomfactor),this.lasty1>this.lasty2&&(s=this.lasty2,(i=this.origSnapY)||this.opos.y,this.y2=this.y1,this.y1=s,t&&(this.origSnapY=t.y,t=!1),i)&&(t.y=i,this.origSnapY=s/zoomfactor-$canvas.offset().top/zoomfactor),this.dragged=!1,this.selecting=!1,this.options,this.x1),s=this.y1,n=$canvaswrap.offset(),i=(activepage.find(".wirejr, .grouped").not(".groupmember").length?activepage.find(".wirejr, .grouped").not(".groupmember").each(function(){var e=parseInt($(this).css("zIndex"),10);index_highest<e&&(index_highest=e)}):index_highest=1,i-n.left),s=s-n.top,n=(clonewidth=this.helper.width(),cloneheight=this.helper.height(),cwidth<clonewidth&&(clonewidth=cwidth),{left:this.origSnapX?Math.round(this.origSnapX):i,top:this.origSnapY?Math.round(this.origSnapY):s}),i=(a&&a.parent,this.helper.clone().css({left:this.expanded?0:n.left,top:n.top,width:a?parseInt(a.x-n.left+1):parseInt(clonewidth/zoomfactor),height:t?parseInt(t.y-n.top+1):parseInt(cloneheight/zoomfactor),"z-index":index_highest+1}).removeClass("ui-boxer-helper").appendTo(activepage).addClass("brandnew blank").draggable().resizable({handles:"all"}));return this.expanded=!1,this.origSnapX=!1,t=a=this.origSnapY=!1,this._trigger("stop",e,{box:i}),this.helper.removeClass("selecting").remove(),removeMarkedElemBorder(),$canvas.removeAttr("data-snap-mark"),!1}})),$.extend($.ui.boxer,{defaults:$.extend({},$.ui.mouse.defaults,{appendTo:"body",distance:0})}),activepage=$(".page").length?$(".page.active:not(.master-on)").length?$(".page.active:not(.master-on)").last():$(".page:visible").length?$(".page:visible"):$(".page").first():$("#canvas"),previewMode||useboxer(),$body.on("click","[elementtype]",function(){var e,t=$(this);"w-icon"==(type=t.attr("elementtype"))?($body.removeClass("elem-lib-visible"),hideMagicToolbar(),renderIconPicker()):(e=t.attr("data-section-type"),t.closest("#predicted-buttons").length?prepareWire(type,null,e):prepareWire(type,null,e,!0))}),$canvas.on("mouseenter",".wire",function(){var t,e,a;appSettings.drawOnTop||(e=(t=$(this)).parent(),t.is(":data(draggable)")||t.is(".multidrag")||t.is(".editingtext")||previewMode||e.hasClass("master-on")||makeDrag(t),hideGuidesAndMarkers(),t.is(":data(draggable)")&&(a=!(isover=!0),$(document).bind("keydown",function(e){a||(a=!0,(e.shiftKey||e.metaKey)&&1==isover&&t.draggable("disable"))})))}).on("mouseleave",".wire",function(e){var t;appSettings.drawOnTop||(isover=!1,$(document).unbind("keydown"),(t=$(this)).hasClass("ui-draggable-disabled")&&!t.hasClass("btn")&&t.draggable("enable"))}),$canvas.on("mousedown",".wire.ui-draggable.x",function(e){var i,s;e.altKey&&(activepage.data("altdrag",!""),1==(i=activepage.find(".selected")).length&&(s=i.draggable("option","helper"),i.removeClass("selected").addClass("altdrag").addClass("ui-draggable-disabled")),$canvas.droppable({drop:function(e,t){var t=$(t.helper).clone().removeClass("ui-draggable-dragging, ui-resizable"),a=(t.appendTo(activepage).addClass("selected").removeClass("altdrag").find(".ui-resizable-handle, .ui-border-radius-handle").remove(),[]);t.each(function(e){var t="w"+(new Date).getTime()+e;$(this).draggable("destroy").resizable("destroy").radiusable("destroy").attr("id",t),a[e]=t}),historystate.shift(),saveState("",a),computeGuides(t),makeDrag(t),$canvas.droppable("destroy"),i.draggable("option","helper",s),activepage.data("altdrag",!1)}}))});var copied,isover=!1;function MakeCanvasDrag(){$("#canvas-wrap").resizable("destroy").draggable("destroy"),previewMode||$("#canvas-wrap").resizable({minWidth:320,minHeight:320,start:function(e,t){wirepanel.hide(),supercanvas.width("20000px");$("#canvas").height();$(this).data("pos-l",$(this).css("left")),$("#canvas").css("width","100%"),$("#canvas").css("height","100%")},resize:function(e,t){e.stopPropagation(),cwidth=t.size.width,$(".canvassize").html("<b>canvas</b>: "+parseInt(t.size.width,10)+"/"+parseInt(t.size.height,10)+"px"),$body.get(0).style.setProperty("--page-height",t.size.height+"px")},stop:function(e,t){var a;draggingInProgress=resizingInProgress=!1,cwidth=t.size.width,$canvaswrap.hasClass("mobile-landscape")&&(cwidth=480),activepage.attr({"data-page-width":t.size.width,"data-page-height":t.size.height}),multipaged&&$.observable(app[app.activepage.type][app.activepage.id]).setProperty({"page-width":t.size.width,"page-height":t.size.height}),a=t.size.width+100<$(window).width()?$container[0].clientWidth:t.size.width+450,supercanvas.css({width:a+"px",height:t.size.height+750+"px"}),t.size.height+750<$container.height()&&$container.scrollTop(t.size.height+750-$container.height()),t.size.height+450<$container.height()&&$container.scrollLeft(t.size.width+450-$container.width()),predictor&&predictor.setScreenSize(t.size.width,t.size.height),$(this).center(),updateCanvasInput()},handles:"s , e"}).draggable({handle:"#browser",cursor:"move",containment:".supercanvas",start:function(){$body.removeClass("slide-right slide-down slide-left show-settings-colorpicker")},stop:function(e){parseInt($(this).css("top"),10)<32&&$(this).transition({top:"33px"}),offset_c=$("#canvas").offset(),$body.get(0).style.setProperty("--canvas-pos",$canvaswrap.position().top+"px")}})}function delnow(){var e=$canvas.data("groupActive")?activepage.find(".group-active .selected, .group-active .g-selected, , .group-active .g-selected .w-group"):activepage.find(" > .selected, .wcc-section .selected, > .g-selected, > .g-selected .w-group, .wcc-section.section-selected:not(:has(.selected))").not(".locked");saveState(e),removeGuides(e),$canvas.data("groupActive")||e.parents(".w-group").remove(),stageElemForSaving(e,{action:"deleted"}),e.remove(),showWireDim(!1),selectedHovered=!1,$canvas.data("groupActive")?(updateGroupAreaInd(activepage.find(".group-active").not(".has-section")),updateSelIndDim()):$("#selection-transformator").remove(),wirepanel.hide(),$("#wcc-toolbar-instance").remove(),selectSection(activepage.find(".section-selected"),{makeDraggable:!0}),positionSecBtn()}function positionwirepanel(e,t,a,i,s){$guideV.hide(),$guideH.hide();var n=t?$("#wcc-toolbar-instance"):wirepanel,o=(s||n.removeAttr("data-tooltip-show"),e=e||activepage.find(".selected, .edited-text, .g-selected.locked > .area-indicator   "),$("#selection-transformator").length&&activepage.find(".selected").length&&(e=$("#selection-transformator")),$canvaswrap.offset(),e.height()),r=e.width(),l={top:!1,left:!1};let d=!1,c=!1;var p,g,h,u,f=e.position(),m=supercanvas.offset(),v=$canvaswrap.position();f&&(p=isScrolledIntoView(e[0]),g=e.offset().top-57-m.top,n.show(),h=n[0].getBoundingClientRect().width,u=$(window).width(),(e=e.offset().left+r/2-m.left)+m.left-h/2<=0&&(l.left=!0,e=10+h/2),e+ +m.left+20>u&&(l.left=!0,e=$(window).width()-20-h/2),g+m.top-104<=0&&(d=!0),(g=g+m.top-72<=0?!l.left&&48<f.top+o+v.top+m.top?f.top+o+v.top+20:(l.top=!0,68):g)+m.top+82>=$(window).height()&&(l.top=!0,g=$(window).height()-82,d=!1),e<200&&(c=!0),d?n.attr("data-tooltip-bottom",!0):n.removeAttr("data-tooltip-bottom"),c?n.attr("data-tooltip-shift-left",!0):n.removeAttr("data-tooltip-shift-left"),l.top&&!l.left&&(e+=m.left),l.left&&!l.top&&(g+=m.top),e=Math.round(e),g===parseInt(n.css("top"))&&e===parseInt(n.css("left"))&&(l.top||l.left)==("fixed"===n.css("position"))&&p!==("true"===n.attr("data-hidden"))||(n.css({top:g,left:Math.round(e),position:l.top||l.left?"fixed":"absolute",display:p||l.top||l.left?"flex":"none"}),n.attr("data-hidden",!p),s)||t||(wirepanel.get(0).style.removeProperty("--selected-fill-color"),wirepanel.get(0).style.removeProperty("--selected-fill-color-2"),wirepanel.get(0).style.removeProperty("--selected-border-color"),wirepanel.get(0).style.removeProperty("--selected-border-color-2"),r=app.selected?app.selected.bgColor[0]:"#fff",u=app.selected?app.selected.borColor[0]:"#444",app.selected&&1<app.selected.bgColor.length&&wirepanel.get(0).style.setProperty("--selected-fill-color-2",app.selected.bgColor[app.selected.bgColor.length-1]),app.selected&&1<app.selected.borColor.length&&wirepanel.get(0).style.setProperty("--selected-border-color-2",app.selected.borColor[app.selected.borColor.length-1]),wirepanel.get(0).style.setProperty("--selected-fill-color",r),wirepanel.get(0).style.setProperty("--selected-border-color",u),markSelectedFillColor(r),markSelectedBorderColor(u)))}function markSelectedFillColor(e){$("#fill-color-picker").find(".wp-selected").removeClass("wp-selected"),$("#fill-color-picker > div").filter(function(){return $(this).css("background-color")==e}).addClass("wp-selected"),"transparent"!==e&&"rgba(0, 0, 0, 0)"!==e||$("#fill-color-picker .nocolor").addClass("wp-selected")}function markSelectedBorderColor(e){$("#border-color-picker").find(".wp-selected").removeClass("wp-selected"),$("#border-color-picker > div").filter(function(){return $(this).css("background-color")==e}).addClass("wp-selected"),"transparent"!==e&&"rgba(0, 0, 0, 0)"!==e||$("#border-color-picker .nocolor").addClass("wp-selected")}function editme(e,t,a,i,s){var n;t&&($(t.target).hasClass("ql-editor")||$(t.target).parents(".ql-editor").length)||(e=e,multipaged&&e.parents(".page").attr("id")!==app.activepage.id)||(void 0!==t&&($(t.target).hasClass("wirejr")&&$(t.target).parents(".empty-btn").length||$(t.target).parents(".ql-editor").length&&$(t.target).parents(".btn").length||i)?(t.stopPropagation(),(n=i?e.find(".wirejr"):$(t.target)).parent().hasClass("editingtext")||(i&&n.parents(".wire").addClass("selected"),n.parents(".wire").find(".textme"),render_edit_menu(),positionwirepanel())):!e.is(".selected.hastext")||e.is(".edited-text")||activepage.find("#sel-text").length||e.is(".locked")||e.parents(".master-on").length||$canvas.hasClass("preview")||previewMode?e.is(".locked")||e.is(".edited-text")||e.length&&!e.is(".grouped")&&(render_edit_menu(),positionwirepanel()):(t&&t.stopPropagation(),e.addClass("selected"),render_edit_menu(!0),(n=e.find(".textme")).trigger("editThisText",[!0])))}function copynow(){(e=(multipaged?activepage:$canvas).find(" > .selected, > .g-selected").not(".locked")).addClass("copying").resizable("destroy").draggable("destroy").radiusable("destroy");var e,o="",r=0,l=0,d=1e8,c=1e8,t=(e.each(function(e,t){var a=$(this),i=(a=a.hasClass("g-selected")?a.find(" > .area-indicator"):a).position().top+a.height(),s=a.position().top,n=a.position().left+a.width(),a=a.position().left;r<i&&(r=i),l<n&&(l=n),a<c&&(c=a),s<d&&(d=s),o+=$(t).outerHTML()}),{data:o,filename:filename,parent:activepage.attr("id"),outerWidth:Math.round(l-c),outerHeight:Math.round(r-d),outerTop:Math.round(d),outerLeft:Math.round(c)});localStorage.setItem("clipboard",JSON.stringify(t)),e.removeClass("copying"),pasteIndex=1}function cutnow(){var e;e=(multipaged?activepage:$canvas).find(" > .selected, > .g-selected").not(".locked"),copynow(),saveState(),e.remove()}MakeCanvasDrag(),$("#edit").click(function(){$("#icons").show().siblings().hide(),$('.icon[elementtype="headlinetxt"]').hide(),positionwirepanel()}),posTopArray=[],posLeftArray=[],$("#copy").click(function(){copynow()}),$("#cut").click(function(){cutnow()}),key("ctrl+c, command+c",function(){copynow()}),key("ctrl+x, command+x",function(){cutnow()}),key("backspace,del",function(e){var t,a,i,s,n,o,r;if(!quill||quill.hasFocus()||(e.preventDefault(),delnow(),!activepage.find(".section-selected").length))if(app.activepage.masterpageSelected)app.removeMasterFromPage(app.activepage.masterpageSelected);else if(!activepage.find("[contenteditable=true]").length)return!$(e.target).is("input")&&(t=$(document.activeElement).hasClass("editingtext"),a=$(document.activeElement).hasClass("editor-form-element"),a=$(document.activeElement).hasClass("editor-form-element"),i=$(document.activeElement).hasClass("input"),s=$("body").hasClass("show-links-panel"),n=$ajaxlogin.is(":visible"),o=$canvas.find(".selected, .section-selected").length,r=$(".blank").length,!!(t||a||i||s||o))&&void(!o||t||i||a||s||n||r||(e.preventDefault(),delnow()))}),$("#paste").click(function(){paste()}),key("ctrl+v, command+v",function(){quill&&quill.hasFocus()||paste()}),key("ctrl+shift+v, command+shift+v",function(){activepage.find("[contenteditable=true]").length||paste(!0)});var pasteIndex=1;function paste(o){if(quill&&quill.hasFocus())return!1;var e=JSON.parse(localStorage.getItem("clipboard"));if(!e)return!1;var t=$("<div/>").html(e.data).contents(),r=[],l=1,d=(activepage.find(".wirejr").not(".aa, .groupmember, .grouped").each(function(){var e=parseInt($(this).css("zIndex"),10);l<e&&(l=e)}),t.sort(function(e,t){return(e=parseInt($(e).find(".wirejr").not(".groupmember").css("zIndex"),10))-(t=parseInt($(t).find(".wirejr").not(".groupmember").css("zIndex"),10))}),activepage.attr("id")==e.parent&&filename==e.filename),a=e.outerTop||100,i=e.outerLeft||100,i=$(window).width()/2-$canvaswrap.offset().left-i-e.outerWidth/2,c={top:$(window).height()/2-$canvaswrap.offset().top-a-e.outerHeight/2,left:i},a=t.filter(":not(.grouped)").find(".wire, .area-indicator, .w-group-member"),e=(a.filter(":not(.area-indicator)").sort(function(e,t){return e=parseInt($(e).find(".wirejr").not(".groupmember").css("zIndex"),10),(t=parseInt($(t).find(".wirejr").not(".groupmember").css("zIndex"),10))-e}),t.not(".grouped").not(".groupmember").add(a));t.filter(".grouped").each(function(e,t){var t=$(t),a=Math.round(parseInt(t.css("top"),10)+(o?0:c.top)),i=Math.round(parseInt(t.css("left"),10)+(o?0:c.left));t.css({"z-index":l+pasteIndex+e,top:a+"px",left:i+"px"}),$.each(t.find(".wire.groupmember"),function(e){var t="w"+Math.floor(1e13+9e13*Math.random());$(this).attr("id",t)})});let p=activepage.find(".section-selected").length,s=(e.each(function(e){var t=($(this).hasClass("w-group")||$(this).hasClass("grouped")?"g-":"w")+Math.floor(1e13+9e13*Math.random()),a=$(this);a.hasClass("wcc-section-member")&&a.removeClass("wcc-section-member"),a.find("#sel-text").length&&a.find("#sel-text").removeAttr("id");let i={top:0,left:0};a.hasClass("groupmember")?(s=a.parents(".grouped").not(".groupmember"),i={top:Math.round(parseInt(s.css("top"),10))+Math.round(parseInt(s.find(" > div").css("top"),10))+(o?0:c.top),left:Math.round(parseInt(s.css("left"),10))+Math.round(parseInt(s.find(" > div").css("left"),10))+(o?0:c.left)}):r[e]=t;var s=Math.round(parseInt(a.css("top"),10)+(o?0:c.top))+i.top,n=Math.round(parseInt(a.css("left"),10)+(o?0:c.left))+i.left;a.hasClass("area-indicator")||a.attr("id",t).removeClass("copying"),a.is(".grouped")?a.css({"z-index":l+pasteIndex+e}):a.is(".w-group-member")?a.find(".wirejr").not(".groupmember .wirejr").css({"z-index":parseInt(a.find(".wirejr").css("zIndex"))+l+pasteIndex}):a.find(".wirejr").not(".groupmember .wirejr, .w-group-member .wirejr").css({"z-index":l+pasteIndex+e}),a.css({top:s+"px",left:n+"px"}),d&&!o&&(0<gridsize&&appSettings.snapToGrid?a.css({top:Math.round((s+gridsize*pasteIndex)/gridsize)*gridsize+"px",left:Math.round((n+gridsize*pasteIndex)/gridsize)*gridsize+"px"}):a.css({top:s+10*pasteIndex+"px",left:n+10*pasteIndex+"px"})),p&&a.css({top:"",left:""}).addClass("wcc-section-member")}),p?activepage.find(".section-selected").find(".wire.selected").length?t.insertAfter(activepage.find(".section-selected").find(".wire.selected")):activepage.find(".section-selected").find(".inner-flex-container").last().append(t):(t.filter(".wcc-section-member").removeClass("wcc-section-member"),activepage.append(t)),t.filter(".grouped").each(function(e,t){t=updateGroup($(t));r.push(t)}),setBottomMostPos(t),deselectAll(),t.not(".w-group").add(t.filter(".w-group").find(" > .wire")));selectWire((s=s.add($("#"+r.join(",#")))).not(".grouped"),null,s.length),stageElemForSaving(t,{action:"pasted",nested:s},{getCss:!0,getText:!0,getType:!0,getIcon:s.find(".w-icon").length}),computeGuides(s.not(".grouped")),r.length&&saveState("",r,null,null,null,!0),pasteIndex+=1}function changeBorderWidth(n){quill&&blurRTE(),saveState(),($(".selected").has(".wirejr").length?activepage.find(".selected").not(".locked").find(".wirejr"):$canvas.find(".selected").not(".locked")).each(function(e,t){let i=$(t);i.css("box-sizing","content-box");var t=parseInt(i.css("borderLeftWidth"),10),s=n,a=i.width()-2*parseInt(s,10)+2*t,t=i.height()-2*parseInt(s,10)+2*t;i.css({width:a+"px",height:t+"px","border-width":n}),i.css({width:a+"px",height:t+"px","border-width":s+"px"}),(i.hasClass("svginside")||i.find(".cross-v2").length)&&i.css("stroke-width",s),i.hasClass("hasSVG")&&!i.find(".cross-v2").length&&($(".selected svg line").attr("stroke-width",s),$(".selected svg .line1").attr({y1:t,x2:a}),$(".selected svg .line2").attr({y2:t,x2:a}),$(".selected svg").attr({height:t,width:a})),i.parent().hasClass("btn")&&i.find(".textme").css({height:i.outerHeight()-2*n+"px",width:i.outerWidth()-2*n+"px"}),(i.hasClass("line_hor")||i.hasClass("line_vert"))&&i.each(function(e,t){var a=i.hasClass("line_hor")?"height":"width";$(t).parent().css(a,s)}),stageElemForSaving(activepage.find(".selected"),{action:"updated"},{getCss:["bw"]}),showWireDim({w:i.outerWidth()-1,h:i.outerWidth()-1}),i.parent().removeClass("selected"),setTimeout(function(){i.parent().addClass("selected")},800)})}function changeBackgroundColor(e,t){quill&&blurRTE(),saveState();var a=e;(activepage.find(".selected").has(".wirejr").length?activepage.find(".selected").not(".locked").find(".wirejr"):$canvas.find(".selected").not(".locked")).each(function(e,t){t=$(t);t.hasClass("w-icon")?t.css("color",a):t.css("background-color",a),t.hasClass("headline")&&t.find("span").css("background-color",a),t.hasClass("paragraph")&&t.find("span").css("background-color",a),t.hasClass("list")&&(t.find("span").css({"background-color":a,color:a}),t.attr("data-color",a)),t.hasClass("svginside")&&$(".selected .image *").css("background-color",a),stageElemForSaving(activepage.find(".selected"),{action:"updated"},{getCss:["b"]})}),activepage.find(".selected.hastext").length&&t&&applyFormatToQuillSiblings("color",t),wirepanel.get(0).style.setProperty("--selected-fill-color",e),wirepanel.get(0).style.removeProperty("--selected-fill-color-2"),markSelectedFillColor(e)}function changeBorderColor(e){var t;quill&&blurRTE(),saveState(),t=$(".selected").has(".wirejr").length?activepage.find(".selected").not(".locked").find(".wirejr"):$canvas.find(".selected").not(".locked"),current_brcolor=e,t.css("border-color",current_brcolor),t.hasClass("svginside")&&$(".selected svg *").css("stroke",current_brcolor),t.hasClass("hasSVG")&&$(".selected svg line").attr("stroke",current_brcolor),t.find(".cross-v2").length&&t.css("stroke",current_brcolor),(t.hasClass("combobox2")||t.hasClass("scrollh2")||t.hasClass("scrollv"))&&t.css("color",current_brcolor),stageElemForSaving(activepage.find(".selected"),{action:"updated"},{getCss:["bc"]}),t.parent().removeClass("selected"),markSelectedBorderColor(e),wirepanel.get(0).style.setProperty("--selected-border-color",e),wirepanel.get(0).style.removeProperty("--selected-border-color-2"),setTimeout(function(){t.parent().addClass("selected")},800)}function bring_to_front(){var e=activepage.find(".selected, .section-selected").not(".locked");saveState(e),activepage.find(".wirejr , .grouped").each(function(){var e=parseInt($(this).css("zIndex"),10);index_highest<e&&(index_highest=e)}),e.each(function(){($(this).is(".grouped")?$(this).find(" > div"):($(this).is(".wcc-section"),$(this).find(".wirejr"))).css("z-index",index_highest+1)}),stageElemForSaving(e)}function send_to_back(){var e=activepage.find(".selected, .section-selected").not(".locked");saveState(e),activepage.find(".wirejr , .grouped").each(function(){var e=parseInt($(this).css("zIndex"),10);$(this).css("z-index",e+1)}),e.each(function(){($(this).is(".grouped")?$(this).find(" > div"):($(this).is(".wcc-section"),$(this).find(".wirejr"))).css("z-index",1)}),stageElemForSaving(e)}function send_backward(){var e=activepage.find(".selected, .section-selected").not(".locked");saveState(e),e.each(function(){e=$(this).is(".grouped")?$(this).find(" > div"):($(this).is(".wcc-section"),$(this).find(".wirejr"));var e,t=parseInt(e.css("zIndex"),10);e.css("z-index",(t=t<=0?1:t)-1)}),stageElemForSaving(e)}function bring_forward(){var e=activepage.find(".selected, .section-selected").not(".locked");saveState(e),e.each(function(){e=$(this).is(".grouped")?$(this).find(" > div"):($(this).is(".wcc-section"),$(this).find(".wirejr"));var e,t=parseInt(e.css("zIndex"),10);e.css("z-index",t+1)}),stageElemForSaving(e)}function computeGuidesForElement(e){var t,a,e=$(e);return e.is(".col")?(t=e.position(),ww=$("#canvas").width(),t.left+=.01*ww):t=e.position(),e=e.is(".col")?(a=e.width(),e.height()-1):(a=e.outerWidth()-1,e.outerHeight()-1),[{type:"h",x:Math.round(t.left),y:Math.round(t.top)},{type:"h",x:Math.round(t.left),y:Math.round(t.top)+e},{type:"v",x:Math.round(t.left),y:Math.round(t.top)},{type:"v",x:Math.round(t.left)+a,y:Math.round(t.top)}]}function computeColForElement(e){var e=$(e),t=e.position(),e=(ww=$canvas.width(),t.left+=.01*ww,e.width());return[Math.round(t.left+1),Math.round(t.left+e)]}function aspect_ratio(e){e=e.width()/e.height();.3<=e&&e<=4&&($(".icon.rect").show(),$(".icon:not(.rect)").hide()),e<.3&&($(".icon.vertical").show(),$(".icon:not(.vertical)").hide()),4<e&&($(".icon.horizontal").show(),$(".icon:not(.horizontal)").hide()),$("#annotate").hide(),$("#textinput").addClass("lasticon")}$(".strokeweight").click(function(){changeBorderWidth($(this).attr("stroke"))}),$.fn.getId=function(){var e;return $(this).attr("id")?$(this).attr("id"):!$(this).hasClass("area-indicator")&&(e="w"+(new Date).getTime(),$(this).attr("id",e),e)},$("#fill-color-picker").on("click","div",function(){var e=$(this).css("backgroundColor");changeBackgroundColor(e=$(this).hasClass("nocolor")?"transparent":e,$(this).attr("data-quill-color")),wirepanel.removeAttr("data-tooltip-show")}),$("#border-color-picker").on("click","div",function(){let e=$(this).css("backgroundColor");changeBorderColor(e=$(this).hasClass("nocolor")?"transparent":e),wirepanel.removeAttr("data-tooltip-show")}),$("#front").click(function(){bring_to_front()}),$("#back").click(function(){send_to_back()}),$("#backward").click(function(){send_backward()}),$("#forward").click(function(){bring_forward()});var $strokeWidthWrap=$("#stroke-width-wrap"),$showborderbg=$("#fill-color-wrap , #border-color-wrap"),$fillColorWrap=$("#wirepanel #fill-color-wrap"),$borderColorWrap=$("#wirepanel #border-color-wrap"),$edittxt=$("#wirepanel #edittxt"),$textalsz=$("#wirepanel #line-align-wrap , #wirepanel #textsize");const typesClassArr=["box","roundbox","elipse","image","paragraph","list","line_hor","line_vert","slider2","progressbar2","combobox2","scrollh2","scrollv","headline","headlinetxt","textinput2","annotate","w-icon"];function getWireClass(e){e=$(e).find(".wirejr");return!!e.length&&(e.data("type")?e.data("type"):e.attr("class").split(" ").filter(e=>-1!==typesClassArr.indexOf(e)).join())}function render_edit_menu(e){e||wirepanel.removeClass("rich-text rich-text-active"),wirepanel.find(" > div").hide(),$("#linklist").hide();var a,e=activepage.find(".selected, .g-selected.locked");if(a=e.has(".wirejr").length?e.find(".wirejr"):e,$("#wp-icon-picker").hide(),$(".control-icons").hide(),e.hasClass("locked"))$("#unlock_inner_btn").show(),$(".wp-more").show();else{var i=$("#style-format-wrap");i.addClass("children-hidden").show().find(" > div").hide();const n=["line_hor","line_vert","line_hor_ver_2","line_vert_ver_2","headlinetxt"],o=["paragraph","list","headline","w-icon","headlinetxt"],r=["paragraph","list","headline"],l=["image"];var s=$("#image-placeholder-type-wrap");e.toArray().every(e=>l.includes(getWireClass($(e))))&&(s.show(),i.removeClass("children-hidden")),e.toArray().every(e=>!n.includes(getWireClass($(e))))&&($fillColorWrap.show(),i.removeClass("children-hidden")),e.toArray().every(e=>!o.includes(getWireClass($(e))))&&($borderColorWrap.show(),$strokeWidthWrap.show(),i.removeClass("children-hidden")),e.toArray().every(e=>r.includes(getWireClass($(e))))&&($textalsz.show(),i.removeClass("children-hidden"),e.find(".list").length)&&$("#line-align-wrap").hide(),1==a.length&&a.hasClass("w-icon")&&$("#wp-icon-picker").show().find("use").attr("xlink:href",a.find("use").attr("xlink:href")),(a.hasClass("paragraph")||a.hasClass("list")||a.hasClass("headline"))&&(s=a.hasClass("headline")?$.inArray(e.find('span:not(:has("*"))').css("fontSize"),["14px","16px","22px","28px","42px"]):a.hasClass("paragraph")?$.inArray(e.find(".txtcont").css("fontSize"),["7px","10px","18px"]):$.inArray(e.find('span:not(:has("*"))').css("fontSize"),["7px","10px","18px"]),$("#feux-font-size-slider").slider("option","value",s)),$(".wp-more").show();let t=!1;e.length&&(t=e.filter("[data-weblink]").length==e.length||e.filter("[data-link]").length==e.length,e.parents(".w-group").length)&&!e.filter(".selected").not(".w-group-member").length&&!$canvas.data("groupActive")&&e.parents(".w-group").filter("[data-weblink],[data-link]").length&&(t=!0),$("[data-action=make-link]").removeClass("btn-active").show().addClass(function(e){return!!t&&"btn-active"}),1<e.length&&controlIconsShow()}}function setFeuxFonsSize(e){if(saveState(),sizes={0:[{fontsize:"7px",lineheight:"13px"},{fontsize:"14px",lineheight:"14px",marginbottom:"2px"}],1:[{fontsize:"10px",lineheight:"20px"},{fontsize:"22px",lineheight:"22px",marginbottom:"6px"}],2:[{fontsize:"18px",lineheight:"36px"},{fontsize:"28px",lineheight:"28px",marginbottom:"8px"}]},void 0===e)return!1;activepage.find(".selected.paragraph span , .selected .paragraph span").css({"font-size":sizes[e][0].fontsize,"line-height":sizes[e][0].lineheight}),activepage.find(".selected.list span ul li,  .selected .list span ul li ").css({"font-size":sizes[e][0].fontsize,"line-height":sizes[e][0].lineheight}),activepage.find(".selected .headline").find(".headtext span ").css({"font-size":sizes[e][1].fontsize,"line-height":sizes[e][1].lineheight,"margin-bottom":sizes[e][1].marginbottom})}$("#alignleft").click(function(){saveState(),activepage.find(".selected .headline span , .selected .paragraph span").css("text-align","left")}),$("#aligncenter").click(function(){saveState(),activepage.find(".selected .headline span , .selected .paragraph span").css("text-align","center")}),$("#alignright").click(function(){saveState(),activepage.find(".selected .headline span , .selected .paragraph span").css("text-align","right")}),$("#alignjustify").click(function(){saveState(),activepage.find(".selected .headline span , .selected .paragraph span").css("text-align","justify")}),$("#font-m").click(function(){saveState(),activepage.find(".selected .paragraph span").css({"font-size":"10px","line-height":"20px"}),activepage.find(".selected .list span ul li span").css({"font-size":"10px","line-height":"20px"}),activepage.find(".selected .headline").find(".headtext span").css({"font-size":"22px","line-height":"22px","margin-bottom":"6px"})}),$("#font-l").click(function(){var e;saveState(),activepage.find(".selected .paragraph span").css({"font-size":"18px","line-height":"36px"}),activepage.find(".selected .list span ul li span").css({"font-size":"18px","line-height":"36px"}),activepage.find(".selected.headlinetxt .editable .content-wrapper").css({"font-size":"28px","line-height":"28px"}),activepage.find("[contenteditable=true]").length&&((e=activepage.find("[contenteditable=true]")).css({"font-size":"28px"}),e.parent().css("height",e.height()),e.focus()),activepage.find(" .selected .headline").find(".headtext span ").css({"font-size":"28px","line-height":"28px","margin-bottom":"8px"})}),jQuery.fn.center=function(e){e=this.parent(),e=Math.round(($(e).width()-this.outerWidth())/2);return this.css({left:(e=e<0?10:e)+"px","margin-left":"0"}),this};var annotationhtml="<span class=annotbox><div class='editme thelatest'></div><button class=ok><i class=icon-ok></i> ok</button></span><div class=closeannot></div>",texthtml="<span class='text'><div class='textme'></div></span>",paragraph="<span class=txtcont><span>Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iise mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel.</span></span>",paragraphtext="Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel.",list="<span class='listcont'><ul><li><span>Lorem ipsum dolorsit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor neque.</span></li></ul></span>",listhtml="<ul><li><span>Lorem ipsum dolorsit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor neque.</span></li></ul>",headtxt="<span class='headtext'><span>Lorem</span> <span>ipsum</span> <span>dolor</span> <span>sitammet</span> <span>quam</span> <span>Lorem</span> <span>ipsumdolor</span> <span>sitammet</span> <span>quam</span></span>",img="<svg id='imgwire' version='1.1' baseProfile='tiny'  xmlns='http://www.w3.org/2000/svg'  width='200px' height='100px' viewBox='0 0 200 100' preserveAspectRatio='none'><line vector-effect='non-scaling-stroke' fill='none' stroke='#444444' stroke-width='2' x1='0' y1='100' x2='200' y2='0'/><line vector-effect='non-scaling-stroke' fill='none' stroke='#444444' stroke-width='2' x1='0' y1='0' x2='200' y2='100'/></svg>";function getRandomNumber(e){return Math.floor(Math.random()*e)}function getRandomChar(){return"0123456789abcdefghijklmnopqurstuvwxyzABCDEFGHIJKLMNOPQURSTUVWXYZ".substr(getRandomNumber(62),1)}function randomID(e){for(var t="",a=0;a<e;a++)t+=getRandomChar();return t}function demo0(){$("#canvas").append("<div id='demo'><div class='demoinfo'>Click & drag to draw</div><div id='demobox' ></div><div id='democursor'><i class='icon-cursor'></i></div><div id='demopanel'><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div><div id='demoeditpanel'><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>"),$("#demobox").css({width:"0",height:"0"}).removeAttr("class"),$(".demoinfo").text("Click & drag to draw"),$("#demo").fadeIn("slow",demo1)}function demo1(){$("#democursor").animate({top:"40px",left:"20px"},1500,demo1a)}function demo1a(){$("#democursor").addClass("drag"),demo2()}function demo2(){$("#demobox").delay(500).animate({width:"240px",height:"160px"},3500),$("#democursor").delay(500).animate({top:"200px",left:"260px"},3500,demo3)}function demo3(){$("#democursor").removeClass("drag"),$("#demopanel").delay(500).show(0,demo4)}function demo4(){$(".demoinfo").text("Select stencil"),$("#democursor").delay(800).animate({top:"125px",left:"55px"},1500,demo5)}function demo4a(){demo5()}function demo5(){$("#demobox").addClass("demobox"),$("#democursor").delay(800).animate({top:"125px",left:"80px"},500,demo5a)}function demo5a(){$("#demobox").addClass("round"),$("#democursor").delay(800).animate({top:"125px",left:"105px"},500,demo5b)}function demo5b(){$("#demobox").addClass("demoround"),$("#democursor").delay(800).animate({top:"125px",left:"105px"},500,demo5c)}function demo5c(){$("#democursor").addClass("drag"),demo5d()}function demo5d(){$("#demopanel").delay(300).hide(0,demo5e)}function demo5e(){$("#democursor").removeClass("drag"),demo6()}function demo6(){$("#demopanel").delay(1500).hide(0,demo6a)}function demo6a(){$(".demoinfo").text("Doubleclick to edit"),$("#democursor").addClass("drag"),$("#demopanel").delay(200).hide(0,demo6b)}function demo6b(){$("#democursor").removeClass("drag"),demo6c()}function demo6c(){$("#demopanel").delay(200).hide(0,demo6d)}function demo6d(){$("#democursor").addClass("drag"),$("#demopanel").delay(200).hide(0,demo6e)}function demo6e(){$("#democursor").removeClass("drag"),$("#demoeditpanel").delay(400).show(0,demo7)}function demo7(){$("#democursor").delay(800).animate({top:"125px",left:"178px"},500,demo7a)}function demo7a(){$("#demopanel").delay(500).hide(0,demo7b)}function demo7b(){$("#democursor").addClass("drag"),$("#demobox").addClass("grey"),demo7c()}function demo7c(){$("#demoeditpanel").delay(300).hide(0,demo7d)}function demo7d(){$("#democursor").removeClass("drag"),demo8()}function demo8(){$("#demo").delay(1600).hide("slow")}$("#watch-demo").click(function(){$(".panel").is(":visible")||demo0()}),$canvas.find(".aa").length&&$("#hide-annotation").show(),$canvas.find(".aa:hidden").length&&($("#hide-annotation").hide(),$("#show-annotation").show());var delay=function(){var a=0;return function(e,t){clearTimeout(a),a=setTimeout(e,t)}}();function updategrid(e){$("#gridcol").hide();for(var t=0;t<5;t++){var a="#grid-pattern .lineV:eq("+[t]+")";$("#grid-pattern .lineH:eq("+[t]+")").attr({y1:[t+1]*e,y2:[t+1]*e,x2:5*e}),$(a).attr({x1:[t+1]*e,x2:[t+1]*e,y2:5*e}),$(".svgdot").attr({cx:e-.5,cy:e-.5})}$("#grid-pattern").attr({width:5*e,height:5*e}),$("#dot-pattern").attr({width:e,height:e})}function turngridon(){$("#snap-to-grid").attr("checked")&&("graph"==appSettings.gridType?(gridsize=appSettings.gridSize,$canvaswrap.attr({"data-grid-size":gridsize,"data-grid-show":"true"})):"dots"==$("select#grid-type").val()&&(gridsize=$("#grid-slider").slider("value"),$canvaswrap.attr({"data-grid-size":gridsize,"data-grid-show":"true"})))}$(window).resize(function(e){e.target==window&&(delay(function(){$canvaswrap.center()},500),$(".context-menu-list").length)&&$(".context-menu-list").contextMenu("hide")}),$("#grid-slider").slider({min:10,max:50,value:20,slide:function(e,t){$(".grid-size-val").text(t.value)},stop:function(e,t){appSettings.gridSize=t.value,saveSettings(),updategrid(t.value),turngridon()}}),$("#snap-to-grid").change(function(){turngridon(),this.checked?($snaptoguides.attr("checked",!1),appSettings.snapToGuides=!1,appSettings.snapToGrid=!0,$canvaswrap.attr({"data-grid-snap":"true"}),gridsize=$("#grid-slider").slider("value")):(gridsize=0,appSettings.snapToGrid=!1,$canvaswrap.attr({"data-grid-snap":"false"})),saveSettings()}),$canvaswrap.data("savedState",[]),$canvaswrap.data("savedUndo",[]);var historystate=$canvaswrap.data("savedState"),future=$canvaswrap.data("savedUndo");function getDeletedGroupData(e){var a=[];return $.each(e,function(e){var t=$(this);a[e]={html:t.find("div").first().outerHTML(),css:{top:t.css("top"),left:t.css("left"),width:t.css("width"),height:t.css("height")},id:t.attr("id"),orgclass:t.attr("class"),parent:t.parent().attr("id")}}),a}let beforeUnloadListener=e=>(e.preventDefault(),e.returnValue="Are you sure you want to exit?");function saveState(e,t,a,i,s,n,o,r,l){beforeUnloadListener&&addEventListener("beforeunload",beforeUnloadListener,{capture:!0});var d,c=[];if(void 0===e&&(e=$canvas.find(".selected")),o?c={deleteid:e.attr("id"),parent:e.parent().attr("id"),pasted:"pasted",groupmembers:e.find(" > div ").not(".area-indicator").removeClass("w-group-member g-selected")}:t?c={deleteid:t,parent:$("#"+t[0]).parent().attr("id"),pasted:n}:$.each(e,function(e){var t=$(this),a=t.getId();c[e]={html:t.clone().find(".ui-border-radius-handle, .ui-resizable-handle").remove().end().filter(".empty-btn").find(".textme").remove().end().end().html(),css:{top:t.css("top"),left:t.css("left"),width:t.css("width"),height:t.css("height"),"z-index":t.css("zIndex")},id:a,orgclass:t.attr("class").replace("multidrag","").replace("g-selected","").replace("selected",""),parent:t.parent().attr("id"),unlock:t.hasClass("locked"),groupmember:t.parents(".group-active").length,pasted:n,relock:r,oldDelta:l}}),s)for(var p in s)c[p]=s[p];a?(d=future,$("#redo").removeClass("inactive")):(d=historystate,i||(future=[],$("#redo").addClass("inactive"))),d.unshift(c),10<d.length&&d.pop(),$("#undo").hasClass("inactive")&&$("#undo").removeClass("inactive")}function handleUndo(){restoreState(!0)}function handleRedo(){restoreState(!1)}function loadHistoryStack(e,t){var a=Quill.import("delta");if(0<e.undo.length)for(var i=0;i<e.undo.length;i++)(s={}).redo=new a(e.undo[i].redo.ops),s.undo=new a(e.undo[i].undo.ops),t.history.stack.undo.push(s);if(0<e.redo.length)for(var s,i=0;i<e.redo.length;i++)(s={}).redo=new a(e.redo[i].redo.ops),s.undo=new a(e.redo[i].undo.ops),t.history.stack.redo.push(s)}function swap(e,t,a){[e[t],e[a]]=[e[a],e[t]]}function restoreState(e){var i=e?historystate:future,t=activepage.find(".selected,.editingtext");if(0<i.length){var a=activepage.find(".selected").map(function(){return $(this).attr("id")}).get();if(i[0].quill){var a=quill&&checker(a,i[0].id)&&$(quill.container).parents(".wire").attr("id")==i[0].id,s=(quill&&!a&&blurRTE(),e?future:historystate),n=e?"undo":"redo",o=document.getElementById(i[0].id[0]).querySelector(".textme");if(a||($(o).attr("id","sel-text").removeClass("ql-editor"),quill=new Quill(o)),(!a||quill&&0===quill.history.stack[n].length)&&loadHistoryStack(i[0].stack,quill),quill.restoring=i,quill.history[n](),!a&&1<i[0].id.length){var o=i[0].stack[n].length-1;if(0<=o){let a=i[0].stack[n][o][n].ops[0].attributes;$.each(Object.keys(a),function(e,t){applyFormatToQuillSiblings(t,Object.values(a)[e],"#"+i[0].id.slice(1).join(",#"))})}}i[0].stack=quill.history.stack,s.length&&s[0].id==i[0].id?(future[0].stack=quill.history.stack,historystate[0].stack=quill.history.stack):(o={id:i[0].id,quill:!0,stack:quill.history.stack},s.unshift(o)),future.length&&historystate.length&&checker(i[0].id,s[0].id)?(future[0].stack=quill.history.stack,historystate[0].stack=quill.history.stack):(fullObj={id:i[0].id,quill:!0,stack:quill.history.stack},(e?future:historystate).unshift(fullObj)),0==quill.history.stack[n].length&&i.shift(),toggleUndoRedoBtns(e,i),a||(blurRTE(),editme(t.first()))}else{var r=i[0];if(!("parent"in r&&r.parent)||r.parent.startsWith("g-")||r.parent===app.activepage.id){var l=$();if(r.deleteid&&!r.groupmembers&&deletePastedOrUngroup(r,e,r.pasted,$("#"+r.parent).hasClass("w-group")),r.deleteid&&r.groupmembers&&group_elements(r.groupmembers,r.deleteid,e),r.hasOwnProperty("0")){delete r.deleteid;let a;$.each(r,function(e){r[e]&&(l=l.add($("#"+r[e].id)))}),$("#"+r[0].id).length&&saveState(l,!1,e,!0);var d=!1,c=[];$.each(r,function(e){var t;"pasted"!==e&&"groupmembers"!==e&&(r[e]&&r[e].relock?(lock($("#"+r[e].id)),wirepanel.hide(),i.shift()):r[e]&&r[e].unlock?(unlock($("#"+r[e].id)),wirepanel.hide(),i.shift()):(t=$("#"+r[e].id),a=t.hasClass("selected"),t.length?(t.addClass(r[e].orgclass).resizable("destroy").draggable("destroy").radiusable("destroy").css(r[e].css),r[e].html&&t.html(r[e].html),r[e].groupmember||t.is(".w-group-member")?t.parents(".w-group").each(function(e,t){var a=getMultiElemArea($(t).find(".wire"));$(t).find(" > .area-indicator").css({top:a.top,left:a.left,width:a.right-a.left,height:a.bottom-a.top})}):(computeGuides(t),showWireDim(t)),updateSelIndDim()):($("<div/>").appendTo($("#"+r[e].parent)).addClass(r[e].orgclass).removeClass("ui-draggable ui-resizable ui-resizable-autohide").html(r[e].html).attr("id",r[e].id).css(r[e].css),t=$("#"+r[e].id),r[e].orgclass.includes("wcc-section-member")&&r[e].orgclass.includes("hastext")&&t.css("width",t.width()+1),l=l.add($("#"+r[e].id)),c[e]=r[e].id,r[e].groupmember&&updateGroupAreaInd($("#"+r[e].parent)),computeGuides(t),showWireDim(t),d=!0)))}),a&&positionwirepanel(null,(o=activepage.find(".selected")).filter(".hastext").length==o.length),d&&saveState("",c,e,!0,null,r[0].pasted)}i.shift(),toggleUndoRedoBtns(e,i)}}}}function toggleUndoRedoBtns(e,t){historystate.length?$("#undo").removeClass("inactive"):$("#undo").addClass("inactive"),future.length?$("#redo").removeClass("inactive"):$("#redo").addClass("inactive")}function deletePastedOrUngroup(e,t,a,i,s){var n=$();let o=!1;$.each(e.deleteid,function(e){!$("#"+this).is(".grouped")&&!$("#"+this).hasClass("w-group")||a?saveState(n=n.add($("#"+this)),!1,t,s,null,a):(ungroup_elements($("#"+this),i,!0),o=!0)}),o||stageElemForSaving(n,{action:"deleted"},{getCss:!1,getType:!0}),removeGuides(n),showWireDim(!1),n.remove(),deselectAll()}function makeDragNow(){historystate.shift(),activepage=multipaged?$(".page:visible"):$("#canvas")}function handleKeys(e){if(!$ajaxlogin.is(":visible")){var t;if($canvas.find(".locked.selected").removeClass("selected"),!(t=activepage.find(".selected").length?activepage.find(".selected").add("#selection-transformator, .g-selected .area-indicator"):$canvas.find(".master-on.ui-draggable")).length)return;var a=1;switch(e.shiftKey&&(e.preventDefault(),a=10),0<gridsize&&(appSettings.snapToGrid||"true"===$canvaswrap.attr("data-grid-snap"))&&!e.altKey&&(a=parseInt(gridsize,10)),pTopArray=[],pLeftArray=[],37!=e.keyCode&&38!=e.keyCode&&39!=e.keyCode&&40!=e.keyCode||e.ctrlKey||(app.activepage.masterpageSelected||saveState(),t.each(function(e){thiscsstop=$(this).css("top"),thiscssleft=$(this).css("left"),pTopArray[e]=parseInt(thiscsstop,10),pLeftArray[e]=parseInt(thiscssleft,10)})),e.preventDefault(),e.keyCode){case 37:t.each(function(e){$(this).css("left",pLeftArray[e]-a)}),stageElemForSaving(t.filter(".wire"));break;case 38:t.each(function(e){$(this).css("top",pTopArray[e]-a)}),stageElemForSaving(t.filter(".wire"));break;case 39:t.each(function(e){$(this).css("left",pLeftArray[e]+a)}),stageElemForSaving(t.filter(".wire"));break;case 40:t.each(function(e){$(this).css("top",pTopArray[e]+a)}),stageElemForSaving(t.filter(".wire"));break;default:return!0}}positionwirepanel(null,quill),$canvas.data("groupActive")&&updateActiveGroupOutline(),computeGuides(t),showWireDim(t.first())}function group_ungroup(){var e=activepage.find(" > .selected, > .g-selected, .group-active > .selected , .group-active > .g-selected").not(".locked");1===e.length&&e.is(".grouped")||(1===e.length&&e.hasClass("w-group")?ungroup_elements:group_elements)(e)}function group_elements(e,t,a,i){var s=t||"g-"+(new Date).getTime();if(!t&&(e.length<=1||!$canvas.data("groupActive")&&e.filter(".w-group-member").length||$canvas.data("groupActive")&&e.filter(".w-group-member").length>=activepage.find(".group-active").children().length-1))return!1;e.addClass("w-group-member").removeClass("g-selected");var n=e.wrapAll("<div class=w-group>").parent().addClass("g-selected"),o=($canvas.data("groupActive")&&n.addClass("w-group-member"),getMultiElemArea(e.not(".w-group").add(e.find(".wire")))),o=i?$("<div class=area-indicator>").css(i):$("<div class=area-indicator>").css({top:o.top,left:o.left,width:o.right-o.left,height:o.bottom-o.top});n.attr("id",s).prepend(o),i&&n.addClass("has-section"),n.parent().hasClass("w-group")&&n.addClass("w-group-member"),e.find(".w-group-member");removeGuides(e),stageElemForSaving(n,{action:"grouped"},{getGroup:!0,getType:!0}),t?saveState("",[n.attr("id")],a):(computeGuides(n),saveState("",[n.attr("id")])),$("[data-action=group]").hide(),$("[data-action=un-group-btn]").show()}function group_elements_old(e){var i,s,n,o,t;1<e.length&&(s=i=1e5,o=n=-1,removeGuides(e),e.each(function(){var e=$(this).position(),t=$(this).width(),a=$(this).height();i=i<e.top?i:e.top,s=s<e.left?s:e.left,n=n>e.left+t?n:e.left+t,o=o>e.top+a?o:e.top+a}),activepage.find("> .wire > .wirejr , .grouped").each(function(){var e=parseInt($(this).css("zIndex"),10)||0;(index_highest|=1)<e&&(index_highest=e)}),t=Math.floor(99999*Math.random()),e.draggable("destroy").resizable("destroy").radiusable("destroy").css({position:"absolute"}).removeClass("selected").addClass("groupmember"),e.wrapAll('<div  style="position:relative; top:-'+i+"px; left:-"+s+"px;z-index:"+(index_highest+1)+'"/>'),e.parent().wrap('<div class="grouped wire" id='+t+' style="position:absolute;top:'+i+"px; left:"+s+"px;width:"+(n-s)+"px;height:"+(o-i)+'px;"/>'),e.parent().parent().addClass("selected"),computeGuides(activepage.find(".selected")),makeDrag(e=$("#"+t)),e.resizable("destroy").radiusable("destroy"),saveState("",[t]),$("[data-action=group]").addClass("pressed"))}function ungroup_elements(e,t,a){removeGuides(e),stageElemForSaving(e,{action:"ungrouped"}),e.find(" > .area-indicator").remove();t=t||e.parents(".group-active").length,saveState(e,null,a,null,null,null,!0),a=e.find(" > div");t?a.addClass("w-group-member"):a.removeClass("w-group-member"),computeGuides(a),a.first().unwrap(),selectWire(a.add(a.find(".wire")).not(".w-group"),null,null,null,t),selectedHovered=!1,$("[data-action=group]").removeClass("pressed")}function ungroup_elements_old(e){removeGuides(e),e.draggable("destroy").resizable("destroy").radiusable("destroy");var r=[],t=getDeletedGroupData(e);e.each(function(e){var t=$(this),a=(a=t.find("> div > .wire").clone()).sort(function(e,t){return($(e).is(".grouped")?parseInt($(e).css("zIndex")):parseInt($(e).find(".wirejr").css("zIndex")))-($(t).is(".grouped")?parseInt($(t).css("zIndex")):parseInt($(t).find(".wirejr").css("zIndex")))}),i=t.position(),s=parseInt(t.css("zIndex")),n=t.find("> div").position(),o=[];a.each(function(e){var t=$(this);(t.is(".grouped")?t:t.find(".wirejr")).css("z-index",s),o[e]=t.attr("id"),abspos={top:parseInt(t.css("top")),left:parseInt(t.css("left"))},t.css({top:i.top+(abspos.top+n.top),left:i.left+(abspos.left+n.left)})}),r=r.concat(o),a.removeClass("groupmember").appendTo(activepage),computeGuides(a),$("[data-action=group]").removeClass("pressed").addClass("inactive"),t.remove()}),saveState("",r,null,null,t)}function alignTo(i){var e=activepage.find(".selected,.editingtext, .g-selected > .area-indicator").not(".locked");let s=!(!activepage.find(" > .g-selected").length||activepage.find(" > .g-selected").siblings(".selected").length);var t=activepage.find(".group-active").length;saveState();let n="top"==i||"bottom"==i?"top":"left";var o,a="bottom"==i?$("#selection-transformator").height():"right"==i?$("#selection-transformator").width():0;let r="bottom"==i?$("#canvas").height():"right"==i?$("#canvas").width():0;1<e.length&&!s&&!t&&0==activepage.find(".g-selected").length&&(r=$("#selection-transformator").position()[n]+a),o=s&&activepage.find(".g-selected").length?activepage.find(".g-selected").find(" > .area-indicator").position()[n]:0,e.each(function(){var e=(s?$(this).parentsUntil("#"+app.activepage.id):$(this).parents(".w-group")).not(".group-active").not(".group-active-prev"),t="top"==n?"height":"width",a="bottom"==i||"right"==i?(e.length?e.last().find(" > .area-indicator"):$(this))[t]():0,t=a?$(this)[t]():0,e=e.length?o+a:$(this).position()[n]+t;$(this).css(n,$(this).position()[n]+(r-e))}),computeGuides(e),updateSelIndDim(),positionwirepanel(e,quill),quill&&quill.focus()}function alignCenter(e){var t=activepage.find(".selected, .g-selected > .area-indicator").not(".locked");let a=!(!activepage.find(" > .g-selected").length||activepage.find(" > .g-selected").siblings(".selected").length),i=(saveState(),"v"==e?"height":"width"),s="v"==e?"top":"left",n=Math.round($("#canvas")[i]()/2);var o,e=activepage.find(".group-active").length;o=a&&activepage.find(".g-selected").length?activepage.find(".g-selected").find(" > .area-indicator").position()[s]:0,1<t.length&&!a&&!e&&(n=$("#selection-transformator")[i]()/2+$("#selection-transformator").position()[s]),t.each(function(){var e=a?$(this).parentsUntil("#"+app.activepage.id).not(".group-active").not(".group-active-prev").last():$(this).parents(".w-group"),e=e.length?o+e.last().find(" > .area-indicator")[i]()/2:$(this).position()[s]+$(this)[i]()/2;$(this).css(s,$(this).position()[s]+(n-e))}),computeGuides(t),updateSelIndDim()}function distElements(e){$sl=($canvas.data("groupActive")?activepage.find(".group-active > .selected, .group-active > .g-selected"):activepage.find(" > .selected, > .g-selected")).not(".locked"),saveState();let i=$sl.length-1,s="v"===e?"top":"left",n="v"===e?"height":"width";var e=sortdivs($sl,s),t=$(e[0].div).hasClass("w-group")?$(e[0].div).find(" > .area-indicator"):$(e[0].div),a=$(e[i].div).hasClass("w-group")?$(e[i].div).find(" > .area-indicator"):$(e[i].div);let o=t.position()[s]+t[n]()/2,r=a.position()[s]+a[n]()/2;$.each(e,function(e,t){e=o+(r-o)/i*e;let a=$(this.div).hasClass("w-group")?e-($(this.div).find(" > .area-indicator").position()[s]+$(this.div).find(" > .area-indicator")[n]()/2):e-($(this.div).position()[s]+$(this.div)[n]()/2);$(this.div).hasClass("w-group")?$(this.div).find(".wire, .area-indicator").each(function(e,t){$(t).css(s,$(t).position()[s]+Math.round(a)+"px")}):$(this.div).css(s,$(this.div).position()[s]+Math.round(a)+"px")}),updateGroupAreaInd(activepage.find(".group-active, .g-selected")),updateSelIndDim(),computeGuides($sl)}function sortdivs(e,t){for(var a=new Array,i=0;i<e.length;i++){var s=e[i].classList.contains("w-group")?$(e[i]).find(" > .area-indicator"):e[i];pos=$(s).position(),"top"==t?a.push({div:e.eq(i),val:pos.top}):a.push({div:e.eq(i),val:pos.left})}return a.sort(function(e,t){return e.val<t.val?-1:e.val>t.val?1:0})}function renderContextMenu(){$.contextMenu({selector:".supercanvas, .wire,  .groupmember, #selection-transformator",position:function(e,t,a){t+e.$menu.width()>$(window).width()&&(t=$(window).width()-e.$menu.width()-40),e.$menu.attr("data-pos-right",t+e.$menu.width()>$(window).width()-180),a+e.$menu.height()>$(window).height()&&(a=$(window).height()-e.$menu.height()-30),e.$menu.css({top:a,left:t})},reposition:!1,events:{},build:function(a,i){return{className:multipaged?"":"single-paged",events:{show:function(e){selectedHovered=!1;var t=$(this);if(t.parents(".master-on").length||t.hasClass("master-on")||app.activepage.masterpageSelected)return!1;t.is("#selection-transformator")||activepage.find(".g-selected.locked").length||t.parents(".wcc-section").length||(t.hasClass("selected")||t.hasClass("editingtext")||deselectAll(null,$canvas.data("groupActive")&&a.hasClass("w-group-member")),!t.is(".wire"))||t.hasClass("selected")||t.hasClass("editingtext")||selectWire(t,null,null,i,$canvas.data("groupActive"))}},items:{Copy:{name:"Copy",callback:function(){copynow()},disabled:function(e){return!($(this).is(".wire")||activepage.find(".selected").length||$("#selection-transformator").length)},shortMac:" C",shortcut:"Ctrl + C"},Cut:{name:"Cut",callback:function(){cutnow()},disabled:function(){return!($(this).is(".wire")||activepage.find(".selected").length||$("#selection-transformator").length)},shortMac:" X",shortcut:"Ctrl + X"},Paste:{name:"Paste",callback:function(){paste()},disabled:function(){return!(null!==localStorage.getItem("clipboard")&&!app.activepage.masterpageSelected)},shortMac:" V",shortcut:"Ctrl + V"},"Paste in place":{name:"Paste in place",callback:function(){paste(!0)},disabled:function(){return!(null!==localStorage.getItem("clipboard")&&!app.activepage.masterpageSelected)},shortMac:"V",shortcut:"Ctrl + Shift+ V"},Delete:{name:"Delete",callback:function(){delnow()},disabled:function(){return!($(this).is(".wire")||activepage.find(".selected").length||$("#selection-transformator").length)},shortMac:"Del",shortcut:"Del"},sep0:"---------",arrange:{name:"Arrange",disabled:function(){return!($(this).is(".wire")||activepage.find(".selected").length||$("#selection-transformator").length)},items:{"Bring to front":{name:"Bring to front",callback:function(){bring_to_front()},disabled:function(){return!($(this).is(".wire")||activepage.find(".selected").length||$("#selection-transformator").length)},shortMac:"",shortcut:"Ctrl + Shift + "},"Bring forward":{name:"Bring forward",callback:function(){bring_forward()},disabled:function(){return!($(this).is(".wire")||activepage.find(".selected").length||$("#selection-transformator").length)},shortMac:"",shortcut:"Ctrl + "},"Send to back":{name:"Send to back",callback:function(){send_to_back()},disabled:function(){return!($(this).is(".wire")||activepage.find(".selected").length||$("#selection-transformator").length)},shortMac:"",shortcut:"Ctrl + Shift + "},"Send backward":{name:"Send backward",callback:function(){send_backward()},disabled:function(){return!($(this).is(".wire")||activepage.find(".selected").length||$("#selection-transformator").length)},shortMac:"",shortcut:"Ctrl + "}}},sep1:"---------",align:{name:"Align",disabled:function(){return!($(this).is(".wire")||activepage.find(".selected").length||$("#selection-transformator").length)},items:{1:{name:"Top edges",callback:function(){alignTo("top")}},2:{name:"Bottom edges",callback:function(){alignTo("bottom")}},3:{name:"Left edges",callback:function(){alignTo("left")}},4:{name:"Right edges",callback:function(){alignTo("right")}},5:{name:"Horizontal centers",callback:function(){alignHorCenter()}},6:{name:"Vertical centers",callback:function(){alignVerCenter()}},7:{name:"Distribute vertically",callback:function(){distElements("v")}},8:{name:"Distribute horizontally",callback:function(){distElements("h")}}}},"Lock / Unlock":{name:function(){return a.hasClass("locked")||a.parents(".g-selected.locked").length||activepage.find(".g-selected.locked").length?"Unlock":"Lock"},callback:function(){(a.hasClass("locked")||a.parents(".g-selected.locked").length||activepage.find(".g-selected.locked").length?unblockBtnClicked:lock)()},disabled:function(){return!($(this).is(".wire")||activepage.find(".selected").length||$("#selection-transformator").length||0!=a.parents(".g-selected.locked").length||0!=activepage.find(".g-selected.locked").length)},shortMac:"L",shortcut:"Ctrl + Shift + L"},"Group / Ungroup":{name:function(){return activepage.find(".w-group.g-selected").length&&0==activepage.find(".selected").not(".w-group-member").length||a.is(".w-group-member")?"Ungroup":"Group"},callback:function(){group_ungroup()},disabled:function(){return!(1<activepage.find(".selected").length||activepage.find(".w-group.g-selected").length)},shortMac:" G",shortcut:"Ctrl + G"},sep2:"---------",Link:{name:"Link to page",isHtmlName:!0,className:function(){return multipaged?"dd-has-icon dd-no-fill dd-stroke-15":"contextmenu-item-hidden"},callback:function(){renderLinksPanel()},disabled:function(){return!($(this).is(".wire")||activepage.find(".selected").length||!$("#selection-transformator").length)},shortMac:" K",shortcut:"Ctrl + K"}}}}})}key("ctrl+z, command+z",function(e){quill||(e.preventDefault(),restoreState(!0))}),$("#undo").click(function(){handleUndo()}),key("ctrl+y, command+y, command+shift+z",function(e){quill||(e.preventDefault(),restoreState(!1))}),$("#redo").click(function(){handleRedo()}),sett.bind("click",function(e){wirepanel.hide(),$("body").hasClass("slide-down")?($("body").removeClass("show-device-skin-popup slide-left show-settings-colorpicker slide-right slide-down top-dd-active").toggleClass("slide-left"),sharebar.hide(),sett.toggleClass("pressed"),exportbtn.removeClass("pressed")):($("body").removeClass("show-device-skin-popup show-settings-colorpicker slide-right slide-down top-dd-active"),sharebar.hide(),exportbtn.removeClass("pressed"),$("body").removeClass("slide-right , slide-down"),$("body").toggleClass("slide-left"),$(this).toggleClass("pressed "))}),$("#canvas_w_val").change(function(){changePageSize(parseInt($(this).val(),10),!1),$canvaswrap.center()}),$("#canvas_h_val").change(function(){changePageSize(!1,parseInt($(this).val(),10))}),key("down, alt+down, shift+down, up, alt+up, shift+up, left, alt+left, shift+left, right, alt+right, shift+right",function(e){quill&&quill.hasFocus()||handleKeys(e)}),$("[data-action=group]").click(function(){group_ungroup()}),$("[data-action=un-group-btn]").on("click",function(){ungroup_elements(activepage.find(" > .selected, > .g-selected, .group-active > .selected , .group-active > .g-selected").not(".locked"))}),key("ctrl+g, command+g",function(e){e.preventDefault(),group_elements(activepage.find(" > .selected, > .g-selected, .group-active > .selected , .group-active > .g-selected").not(".locked"))}),key("ctrl+shift+g, command+shift+g",function(e){e.preventDefault(),ungroup_elements(activepage.find(" > .w-group.g-selected, .group-active > .g-selected"))}),$(".wirepanel .align_btn, .wcc-toolbar .align_btn").on("click",function(e){alignTo($(this).attr("data-align-to"))}),$("[data-action=align-center]").on("click",function(e){alignCenter("v")}),$("[data-action=align-middle]").on("click",function(e){alignCenter("h")}),$("[data-action=dist-v]").click(function(){distElements("v")}),$("[data-action=dist-h]").click(function(e){distElements("h")}),$("#arrange").click(function(){$body.addClass("top-dd-active").removeClass("show-device-skin-popup show-settings-colorpicker slide-left slide-down"),sett.removeClass("pressed"),exportbtn.removeClass("pressed"),$("#arrange-icons").toggleClass("visible"),$(".align-icons").hasClass("visible"),$(this).hasClass("pressed")&&$body.removeClass("top-dd-active"),$(this).toggleClass("pressed"),$(".align-icons").hasClass("visible")&&($(".align-icons").removeClass("visible"),$("#align").removeClass("pressed"))}),$(".inner-btn  , #arrange , .pagename-wrap , .appriseInner").click(function(e){e.stopPropagation()}),key("b",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(prepareWire(type="box"),insertWire(type))}),key("x",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),renderIconPicker())}),key("e",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(prepareWire(type="elipse"),insertWire(type))}),key("i",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(prepareWire(type="image"),insertWire(type))}),key("p",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(prepareWire(type="paragraph"),insertWire(type))}),key("l",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(prepareWire(type="list"),insertWire(type))}),key("h",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(prepareWire(type="headline"),insertWire(type))}),key("t",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),prepareWire(type="headlinetxt"),insertWire(type))}),key("a",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),prepareWire(type="annotate"),insertWire(type))}),key("g",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),prepareWire(type="line_hor"),insertWire(type))}),key("v",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),prepareWire(type="line_vert"),insertWire(type))}),key("s",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),$("#section-btn").click())}),key("u",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),prepareWire(type="progressbar"),insertWire(type))}),key("c",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),prepareWire(type="combobox"),insertWire(type))}),key("q",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),prepareWire(type="scrollh"),insertWire(type))}),key("y",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),prepareWire(type="scrollv"),insertWire(type))}),key("n",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),prepareWire(type="textinput"),insertWire(type))}),key("6",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(prepareWire(type="box"),insertWire(type),activepage.find(".latestwire").css({background:"#111","border-color":"#111"})),activepage.find(".selected").length&&changeBackgroundColor("#111"))}),key("5",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(prepareWire(type="box"),insertWire(type),activepage.find(".latestwire").css({background:"#444","border-color":"#444"})),activepage.find(".selected").length&&changeBackgroundColor("#444"))}),key("4",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(prepareWire(type="box"),insertWire(type),activepage.find(".latestwire").css({background:"#777","border-color":"#777"})),activepage.find(".selected").length&&changeBackgroundColor("#777"))}),key("3",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(prepareWire(type="box"),insertWire(type),activepage.find(".latestwire").css({background:"#aaa","border-color":"#aaa"})),activepage.find(".selected").length&&changeBackgroundColor("#aaa"))}),key("2",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(prepareWire(type="box"),insertWire(type),activepage.find(".latestwire").css({background:"#ddd","border-color":"#ddd"})),activepage.find(".selected").length&&changeBackgroundColor("#ddd"))}),key("1",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(prepareWire(type="box"),insertWire(type),activepage.find(".latestwire").css({background:"#fff","border-color":"#fff"})),activepage.find(".selected").length&&changeBackgroundColor("#fff"))}),key("7",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(prepareWire(type="box"),insertWire(type),activepage.find(".latestwire").css({background:"tomato","border-color":"tomato"})),activepage.find(".selected").length&&changeBackgroundColor("tomato"))}),key("0",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(prepareWire(type="box"),insertWire(type),activepage.find(".latestwire").css({background:"transparent","border-color":"#444"})),activepage.find(".selected").length&&changeBackgroundColor("transparent"))}),key("alt+7",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("tomato")}),key("alt+1",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("white")}),key("alt+2",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("#ddd")}),key("alt+3",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("#aaa")}),key("alt+4",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("#777")}),key("alt+5",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("#444")}),key("alt+6",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("#111")}),key("alt+0",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("transparent")}),key("ctrl+1",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderWidth("1")}),key("ctrl+2",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderWidth("2")}),key("ctrl+3",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderWidth("4")}),key("ctrl+a, command+a",function(e){activepage.find("[contenteditable=true]").length||(e.preventDefault(),selectWire(($canvas.data("groupActive")?activepage.find(".group-active"):activepage).find(".wire, .wcc-section").not(".locked , .groupmember, [data-slot]")))}),key("esc",function(e){if(e.preventDefault(),$("input").is(":focus").length&&$("input").is(":focus").blur(),app.activepage.editable&&$.observable(app.activepage).removeProperty("editable"),quill){var e=$(".edited-text"),t=$("body").hasClass("edit-btn");if(blurRTE(),t)return void($canvas.data("groupActive")||(selectWire(e),editme(e)))}wirepanel.hide(),hideWirelib(),$canvas.data("groupActive")?(t=activepage.find(".group-active"),deselectAll(!1,activepage.find(".group-active-prev").length),activepage.find(".group-active-prev").length?(activepage.find(".group-active-prev").last().addClass("group-active").removeClass("group-active-prev"),t.removeClass("group-active"),selectWire(t.find(" > .wire").first(),null,null,null,!0)):selectWire(t.find(".wire").first())):(deselectAll(),feuxOverlayClicked(),$("#canvas .blank").remove())}),key("enter",function(){var e;!quill&&activepage.find(".g-selected").length&&0==activepage.find(".wire.selected").not(".w-group-member").length&&(enterGroup(e=activepage.find(".selected").first()),selectWire(e))}),$container.hasClass("preview")||renderContextMenu(),key("ctrl+up, command+up",function(e){e.preventDefault(),bring_forward()}),key("ctrl+shift+up, command+shift+up",function(e){e.preventDefault(),bring_to_front()}),key("ctrl+shift+down, command+shift+down",function(e){e.preventDefault(),send_to_back()}),key("ctrl+down, command+down",function(e){e.preventDefault(),send_backward()}),key("ctrl+l, command+l",function(e){activepage.find(".selected").length&&e.preventDefault(),lock()}),key("ctrl+k, command+k",function(e){e.preventDefault(),renderLinksPanel()});var pagelist=$(".sitemap > ol");function preview(){(previewMode=!previewMode)&&(deselectAll(),$("#top").addClass("topup"),$body.removeClass("slide-left , slide-right , slide-down"),exportbtn.removeClass("pressed"),$(".bottomright, #wirepanel").hide(),$("#canvas .page .wire").draggable("destroy").resizable("destroy").radiusable("destroy").removeClass("ui-resizable-autohide"),$("#canvas").addClass("preview"),$(".ui-boxer").boxer("destroy"),$("#canvas").bind("click",highlightclickable),$("#canvas").on("click",".wire[data-link], .wire [data-link], [data-link] .wire",gotopage),activateWebLinks(),selection.disable())}$(".pagename-wrap").find(".pagename-top, .sitemap-icon").click(function(){$guidesHV.hide(),removeMarkedElemBorder(),wirepanel.hide(),blurRTE(),deselectMaster(),$(".blank").remove(),$(".context-menu-list").length&&$(".context-menu-list").contextMenu("hide"),$("#sitemap-wrap").attr("data-pagetype",app.activepage.type),$("body").hasClass("slide-down")?($("body").removeClass("slide-down"),sharebar.hide(),$sitemapicon.toggleClass("icon-sitemap icon-arrow-left"),exportbtn.removeClass("pressed"),$("body").toggleClass("slide-right")):($("body").removeClass("slide-left show-settings-colorpicker , slide-down , show-device-skin-popup, show-links-panel"),sett.removeClass("pressed"),sttngs.removeClass("icon-arrow-right").addClass("icon-cog"),sharebar.hide(),$("body").toggleClass("slide-right"),$sitemapicon.toggleClass("icon-sitemap icon-arrow-left"),$("#sitemap-wrap").find("input[type=text]").remove())}),$canvas.find(".wire").each(function(e){1<$('[id="'+this.id+'"]').length&&$('[id="'+this.id+'"]').not($(this)).each(function(e){this.id+=e})}),$("[data-action=make-link]").click(function(){renderLinksPanel()}),$("#preview").click(function(){quill&&blurRTE(),preview()}),$("#re-edit").click(function(){previewMode=!1,makeEditable(),sttngs.removeClass("icon-arrow-right").addClass("icon-cog"),sett.removeClass("pressed"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap")});var gotopage=function(e){e.stopPropagation();e=$(this).attr("data-link")||$(this).parents("[data-link]").attr("data-link");0!=e&&make_page_active(e)};function highlightclickable(){var e=activepage.find("[data-link], [data-weblink]");e.addClass("hilite"),setTimeout(function(){e.removeClass("hilite")},600)}function makeEditable(){$("#top").removeClass("topup"),$(".bottomright").show(),$("#canvas").removeClass("preview"),$("#canvas").off("click",".wire[data-link], .wire [data-link]",gotopage),$("#canvas").unbind("click",highlightclickable),deactivateWebLinks(),selection.enable(),useboxer()}$("#export-btn").click(function(){quill&&blurRTE();let t=Date.now();$canvas.find(".wire,.aa").draggable("destroy").resizable("destroy");var e,a=$("#include-frame").is(":checked"),i=$("#export-scale").val(),s=($canvaswrap.resizable("destroy"),Boolean(parseInt($("#export-all-pages").val()))?(s=($("#include-hidden").is(":checked")?$canvaswrap.clone().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot"):$canvaswrap.clone().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot , .page[data-hidden=true]")).remove().end(),e=JSON.stringify(getPagesOrder($("#include-hidden").is(":checked"))),0==$canvas.find(".page").not(".masterpage").length&&$canvas.find(".masterpage").length&&(s=s.find(".masterpage").removeClass("masterpage").end())):(activepage.attr("data-applied-master")||activepage.attr("data-applied-master","false"),s=$canvaswrap.clone().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot, .page").not("#"+app.activepage.id+", #"+activepage.attr("data-applied-master").replace(/,/g,", #")).remove().end().end(),activepage.hasClass("masterpage")&&(s=s.find(".masterpage").removeClass("masterpage").end()),e=JSON.stringify([activepage.attr("id")])),s.outerHTML()),s=encodeURIComponent(s);exporting.show(),$.post("../export_png_pdf.php",{data:s,id:filename,timeout:12e4,extension:$("#export-format input[type='radio']:checked").val(),name:$("title").text().replace(/ /g,"-").replace(/[^A-Za-z0-9 ]/g,"-")+t,frame:a,resolution:i,order:e}).done(function(e){$("iframe").attr("src","../download-png-pdf.php?f="+e),MakeCanvasDrag(),exporting.hide()}).fail(function(e){setTimeout(()=>{let e=$("#export-format input[type='radio']:checked").val();"png"===e&&(e="zip"),$("iframe").attr("src","../download-png-pdf.php?f=/temp/"+$("title").text().replace(/ /g,"-").replace(/[^A-Za-z0-9 ]/g,"-")+t+"."+e),MakeCanvasDrag(),exporting.hide()},"200000")})});var sharebar=$(".sharebar"),exportbtn=$(".export"),$savecomment=(exportbtn.click(function(){exportbtn.toggleClass("pressed"),$("body").removeClass("show-device-skin-popup top-dd-active"),window.scrollTo(0,0),$("body").hasClass("slide-left")||$("body").hasClass("slide-right")?($("body").removeClass("slide-left , slide-right").toggleClass("slide-down"),sharebar.show(),sett.removeClass("pressed"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"),sttngs.removeClass("icon-arrow-right").addClass("icon-cog")):(sharebar.show(),$("body").toggleClass("slide-down"))}),previewMode&&$(".ui-boxer").boxer("destroy"),$(".addComment").click(function(){$("#canvas .page:not(.masterpage):visible").append($("<div class='publiccomment'/>").css({width:"160px",height:"120px",top:"40px",left:"60px","z-index":5e3,position:"absolute"}).append(annotationhtml)),$(".editme").click(divClicked),$("#canvas .thelatest").click()}),$(".saveComment"));function saveComment(){$savecomment.show(),$savecomment.bind("click",function(){$("#canvas .page .publiccomment ,#canvas .page .aa").resizable("destroy").draggable("destroy");var e="",t=($("#canvas .page .publiccomment , #canvas .page .aa").each(function(){$(this).attr("data-parent",$(this).parent().attr("id")),e+=$(this).outerHTML()}),encodeURIComponent(e));$.post("../savecomment",{pblcaa:t,preview:previewid},function(){$(".saved").show().delay(600).fadeOut(),$("#canvas .page .publiccomment").draggable({stop:function(){saveComment()}}).resizable({handles:"n,e,w,s",stop:function(){saveComment()}}),$savecomment.unbind("click"),$savecomment.hide()})})}function positionAA(){!function(n){"use strict";n.fn.removeDuplicates=function(){var t=n([]);return this.each(function(e,a){var i,s=n(a);t.each(function(e,t){a.isEqualNode(t)&&(i=!0,s.remove())}),i||(t=t.add(s))}),t}}(jQuery),$(".publiccomment , .aa").removeClass("latestwire").removeDuplicates(),$(".publiccomment , .aa").each(function(){$(this).appendTo($("#"+$(this).attr("data-parent")))})}function getMaxDim(){var e=$canvas.find(".page"),t=e.map(function(){return $(this).attr("data-page-width")}).get(),e=e.map(function(){return $(this).attr("data-page-height")}).get();return{width:Math.max.apply(Math,t),height:Math.max.apply(Math,e)}}function escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}supercanvas.delegate(".aa","mouseenter",function(){makeAADrag($(this))}),supercanvas.delegate(".publiccomment","mouseenter",function(){$(this).draggable({stop:function(){saveComment()}}).resizable({handles:"n,e,w,s",stop:function(){saveComment()}})}),jQuery.fn.outerHTML=function(e){return e?this.before(e).remove():jQuery("<p>").append(this.eq(0).clone()).html()},window._link_was_clicked=!1,jQuery(document).delegate("a","click",function(e){window._link_was_clicked=!0}),$.fn.hasAttr=function(e){return void 0!==this.attr(e)},jQuery.fn.htmlClean=function(){return this.contents().filter(function(){if(!$(this).hasClass("page")&&!$(this).hasClass("ui-resizable-handle"))return 3==this.nodeType?(this.textContent=$.trim(this.textContent),!/\S/.test(this.nodeValue)):void $(this).htmlClean()}).remove(),this},$(".grouped:empty").remove(),multipaged&&$("#canvas").boxer("destroy"),function(){var i,s,e;multipaged?(e=$canvas.find(".page:visible"),i=$canvaswrap.height(),s=$canvaswrap.width(),$canvaswrap.hasClass("mobile")&&!$canvaswrap.hasClass("tablet")||$canvaswrap.attr("data-template"),$canvaswrap.hasClass("mobile-landscape"),$canvaswrap.hasClass("tablet"),$canvas.find(".page").show().each(function(e){var t,a=$(this);a.attr("data-page-width")||a.attr({"data-page-width":s,"data-page-height":i}),"2"!==$canvaswrap.attr("data-template-version")&&(a.attr("data-orientation","false"),"browser-wrap"==a.attr("data-template")&&(t="browser"),"mobile tablet"==a.attr("data-template")&&(t="tablet"),"mobile"==a.attr("data-template")&&(t="mobile"),"mobile-landscape"==a.attr("data-template")&&(t="mobile",a.attr("data-orientation","landscape")),a.attr("data-template",t),a.removeClass("browser-wrap mobile mobile-landscape tablet")),a.css({height:"100%",width:"100%"})}).not(".active").hide(),"browser"!==(e="browser-wrap"===(e=e.data("template"))?"browser":e)&&($("#device-indicator").attr("data-device",e),$canvaswrap.removeClass("browser-wrap mobile mobile-landscape tablet").attr("data-template-version","2"))):600<$canvas.height()&&$(".container").css({"overflow-y":"auto"})}(),key("ctrl+s, command+s",function(e){previewMode||(e.preventDefault(),$("#save").click())}),previewMode&&$(".overlay").bind("click contextmenu",function(){($("body").hasClass("slide-left")||$("body").hasClass("slide-right")||$("body").hasClass("slide-down"))&&($("body").removeClass("slide-left , show-settings-colorpicker , slide-right , slide-down"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"),$("#top .settings.pressed").removeClass("pressed"),$("#top .export.pressed").removeClass("pressed"))}),$canvas.find(".multidrag").removeClass("multidrag");var $copyBtn=$("#copy-preview-link span"),clipboard=new Clipboard("#copy-preview-link"),d1=(clipboard.on("success",function(e){$copyBtn.addClass("icon-ok").delay(600).queue(function(){$(this).removeClass("icon-ok").clearQueue()}),e.clearSelection()}),clipboard.on("error",function(e){}),navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)&&$copyBtn.parent().remove(),$("#about-wrap").children().click(function(e){e.stopPropagation()}),$("#about-btn").click(function(e){e.preventDefault(),$("body").addClass("show-about"),wirepanel.hide()}),$.support.transition||($.fn.transition=$.fn.animate),$("#d1")),dw=$(".demowrap"),c=$("#cursor"),wp=$(".feux-wirepanel"),fc=$(".feux-canvas");function demoStart(){fc.addClass("no-cursor"),c.show().transition({x:"0",y:"0"},0).transition({x:"-130px",y:"-68px"},1600).transition({x:"-130px",y:"-60px",easing:"snap",delay:200},150,demo1)}function demo1(){c.hide(),d1.addClass("draw").removeClass("bg-grey demo-box").css({width:0,height:0}).transition({width:"0",height:"0"},0).show().find(".cursor").show().end().transition({width:"260px",height:"160px",delay:100},2500,demo2)}function demo2(){d1.find(".cursor").hide(),wp.css({top:"-45px",left:"0px"}).show().find(".draw-icons").show().end().find(".edit-icons").hide(),c.show().transition({x:"128px",y:"98px"},0,demo3)}function demo3(){c.transition({x:"-120px",y:"-95px",delay:"600"},1600,demo4)}function demo4(){d1.removeClass("draw").addClass("demo-box"),c.transition({x:"-120px",y:"-91px"},100).transition({x:"-120px",y:"-95px"},100,demo5)}function demo5(){wp.hide(),c.transition({x:"-42px",y:"-35px",delay:"400"},1e3).transition({x:"-42px",y:"-30px"},100).transition({x:"-42px",y:"-35px"},150).transition({x:"-42px",y:"-30px"},100).transition({x:"-42px",y:"-35px"},150,demo6)}function demo6(){wp.show().find(".draw-icons").hide().end().find(".edit-icons").show(),c.transition({x:"75px",y:"-95px"},1100).transition({x:"75px",y:"-90px"},100).transition({x:"75px",y:"-95px"},100,demo7)}function demo7(){d1.addClass("bg-grey"),window.setTimeout(demo8,800)}function demo8(){wp.hide(),fc.removeClass("no-cursor"),d1.hide(),dw.hide(),$("#feux-play").show()}$("#feux-play").bind("click",function(){$(this).hide(),dw.show(),localStorage.setItem("demo-watched",!0),demoStart()});var snappedIdH,snappedIdV,draggingInProgress=!1,zoomfactor=1,oldMath=0,selectedHovered=!1,mouseOrgClick=($canvas.on("mouseenter",".wire.selected, #selection-transformator",function(){selectedHovered=!0}),$canvas.on("mouseleave",".wire.selected, #selection-transformator",function(){selectedHovered=!1}),!1);function handleCanvasMousemove(e){if(!appSettings.snapOnDraw||selectedHovered&&!draggingInProgress||$canvas.data("groupActive")&&!draggingInProgress||$("body").is('[class*="slide-"]')||previewMode||app&&app.activepage.masterpageSelected||!appSettings.drawOnTop&&!draggingInProgress&&$(e.target).hasClass("wirejr"))return $guidesHV.hide(),removeMarkedElemBorder(),!1;var t=Math.round(Math.sqrt(Math.pow(10-e.clientY,2)+Math.pow(10-e.clientX,2)))+"px",t=(Math.abs(parseInt(t)-oldMath),oldMath=parseInt(t),{x:parseInt(e.pageX-$canvas.offset().left),y:parseInt(e.pageY-$canvas.offset().top)}),a=draggingInProgress?draggingInProgress:!1;appSettings.snapOnDraw&&wirepanel.is(":hidden")&&!e.altKey&&snapToGuides(t,e,a),e.altKey&&!quill&&hideGuidesAndMarkers(),draggingInProgress||showWireDim({x:(snap.v||t).x,y:(snap.h||t).y,w:0,h:0},!0)}function hideGuidesAndMarkers(){$guidesHV.removeClass("visible"),$canvas.data({guideH:!1,guideV:!1}),activepage.add("#canvas > .master-on").find("[data-snap-mark-h],[data-snap-mark-v]").removeAttr("data-snap-mark-h").removeAttr("data-snap-mark-v")}function snapToGuides(r,e,l){if(appSettings.snapToGuides&&appSettings.drawSnap){if($canvas.data("master-dragged")&&!$canvas.data("drawing-in-progress")&&!e.shiftKey&&!e.metaKey)return $guidesHV.hide(),$canvas.data({guideH:!1,guideV:!1}),!1;var d,c,p=wireDistV=1e3;if(l)$.each(l,function(a,i){var s,n,e=l.id,t=l.isIcon;if("top"==a||"bottom"==a||"heightcenter"==a)for(var o in guides)o==e||$("#"+o).hasClass("selected")||(g=guides[o].edges,s=Math.min(Math.abs(r.x-g.left),Math.abs(r.x-g.right)),guides.hasOwnProperty(o)&&$.each(guides[o].g,function(e,t){t.hasOwnProperty("x")||Math.abs(t.y-i)<6&&s<p&&(c=$.extend({},this),snappedIdH=o,p=s,c=$.extend(c,{snappedEdge:a,ddh:s}))}));if("left"==a||"right"==a||"widthcenter"==a)for(var o in guides)o==e||$("#"+o).hasClass("selected")||(g=guides[o].edges,n=Math.min(Math.abs(r.y-g.top),Math.abs(r.y-g.bottom)),guides.hasOwnProperty(o)&&$.each(guides[o].g,function(e,t){t.hasOwnProperty("y")||Math.abs(t.x-i)<6&&n<wireDistV&&(d=$.extend({},this),snappedIdV=o,wireDistV=n,d=$.extend(d,{snappedEdge:a,ddv:n}))}));t&&c&&d&&(d=d.ddv>c.ddh?!1:d).ddv<c.ddh&&(c=!1)});else for(var t in guides){var g=guides[t].edges,a=t,i=Math.min(Math.abs(r.y-g.top),Math.abs(r.y-g.bottom)),s=Math.min(Math.abs(r.x-g.left),Math.abs(r.x-g.right));guides.hasOwnProperty(t)&&$.each(guides[t].g,function(e,t){Math.abs(t.y-r.y)<6&&s<p&&(c=this,snappedIdH=a,p=s),Math.abs(t.x-r.x)<6&&i<wireDistV&&(d=this,snappedIdV=a,wireDistV=i)})}c?(snap.h=c,l||drawGuideH(e)):(snap.h=!1,$guideH.removeClass("visible").hide(),activepage.add("#canvas > .master-on").find("[data-snap-mark-h]").removeAttr("data-snap-mark-h"),$canvas.removeAttr("data-snap-mark")),d?(snap.v=d,l||drawGuideV(e)):(snap.v=!1,$guideV.removeClass("visible").hide(),activepage.add("#canvas > .master-on").find("[data-snap-mark-v]").removeAttr("data-snap-mark-v"))}}function markAadjacentElement(e,t){activepage.find("[data-snap-mark-"+e.type.slice(0,1)+"]").not(".selected,#selection-transformator").length||$("#"+t).attr("data-snap-mark-"+e.type.slice(0,1),e.pos);let a=activepage.find(".selected");1<a.length&&(a=$("#selection-transformator"));t=["top","heightcenter","bottom","left","widthcenter","right"].indexOf(e.snappedEdge);a.attr("data-snap-mark-"+e.type.slice(0,1),["n","c","s","w","c","e"][t])}function removeGuides(e){var i=$(e);if(!i.length)return!1;i.each(function(e,t){var a=$(t).attr("id");delete guides[a],i.is(".grouped")&&i.find(".groupmember").each(function(){delete guides[$(this).attr("id")]}),$(t).hasClass("area-indicator")&&delete guides[$(t).parent().attr("id")]})}function roundHalf(e){return parseFloat((Math.round(2*e)/2).toFixed(1))}function computeGuides(e){var c;(c=e&&"col"!==e?$(e):"col"===e?$canvas.find(".col"):activepage.find(" > .wire, > .w-group").not(".w-group-member").add(".master-on > .wire")).each(function(e,t){let a=t;if(!a.matches("#selection-transformator")){var t=$(a).attr("id"),i=($(a).hasClass("w-group")&&(i=$(a).attr("id"),a=document.querySelector("#"+t+" > .area-indicator"),t=i),$(a).position());if($(a).is(".col")&&$(a).is(":visible"))var s=c.outerWidth(),n=c.outerHeight(),o=($canvas.width(),[{type:"v",x:i.left+parseInt(c.css("marginLeft"),10)+1,pos:"w",parent:"col"},{type:"v",x:i.left+parseInt(c.css("marginLeft"),10)+1+s,pos:"e",parent:"col"}]),r={top:i.top,left:i.left+parseInt(c.css("marginLeft"),10)+1,bottom:i.top+n,right:i.left+parseInt(c.css("marginLeft"),10)+1+s};else if($(a).is("#canvas"))s=$(a).outerWidth()-1,r=(o=[{type:"h",y:0,pos:"n"},{type:"h",y:n=$(a).outerHeight()-1,pos:"s"},{type:"v",x:0,pos:"w"},{type:"v",x:s,pos:"e"},{type:"vm",x:Math.round((s+1)/2),pos:"c"}],t="canvas",{top:i.top,left:i.left,bottom:i.top+n,right:i.left+s});else{var l=$(a);if(!l.length)return;if(!isScrolledIntoView(l))return void removeGuides(l);sp={top:0,left:0};var d={top:0,left:0};if($(a).parent().hasClass("master-on")&&(d={top:parseInt(activepage.attr("data-m-pos-y-"+$(a).parent().attr("id")))||0,left:parseInt(activepage.attr("data-m-pos-x-"+$(a).parent().attr("id")))||0}),l.hasClass("groupmember"))return;var i={top:roundHalf(l.position().top+sp.top+d.top),left:roundHalf(l.position().left+sp.left+d.left)},s=roundHalf(l.outerWidth()-1),n=roundHalf(l.outerHeight()-1),o=[{type:"h",y:i.top,pos:"n"},{type:"v",x:i.left,pos:"w"},{type:"hm",y:Math.round(i.top+(n+1)/2)-(n%2==0?1:.5),pos:"c"},{type:"h",y:i.top+n,pos:"s"},{type:"v",x:i.left+s,pos:"e"},{type:"vm",x:Math.round(i.left+(s+1)/2)-(s%2==0?1:.5),pos:"c"}],r={top:i.top,left:i.left,bottom:i.top+n,right:i.left+s}}t&&(guides[t]={g:o,edges:r})}})}function feuxOverlayClicked(){return $container.add("body").removeClass("slide-left , show-settings-colorpicker , slide-right , slide-down , top-dd-active , show-device-skin-popup , show-links-panel ,  show-icon-picker , __before-insert, elem-lib-visible"),$("body").removeClass("__before-insert , mode--section-preview"),$("#arrange, #align").removeClass("pressed"),$("#arrange-icons, .align-icons").removeClass("visible"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"),$("#top .settings.pressed").removeClass("pressed"),$("#top .export.pressed").removeClass("pressed"),$("#sitemap-wrap").find("input[type=text]").remove(),hideWirelib(),hideMagicToolbar(),app.activepage.new&&blueSitemapInput(),!1}function isScrolledIntoView(e){var t,a,i,s,n,o,r;if($(e).length)return a=(t=$(window).scrollTop()+41)+$(window).height(),s=(i=$(e).offset().top)+$(e).height(),o=(n=$(window).scrollLeft())+$(window).width(),e=(r=$(e).offset().left)+$(e).width(),t<=s&&i<=a&&n<=e&&r<=o}function changePageSize(e,t,a){e&&(supercanvas.width(e+300),a||($canvaswrap.width(e),activepage.attr("data-page-width",e)),multipaged)&&$.observable(app[app.activepage.type][app.activepage.id]).setProperty("page-width",e),t&&(supercanvas.height(t+300),a||($canvaswrap.css("height",t+"px"),activepage.attr("data-page-height",t)),multipaged&&$.observable(app[app.activepage.type][app.activepage.id]).setProperty("page-height",t),$body.get(0).style.setProperty("--page-height",t+"px")),a||updateCanvasInput(e,t),predictor&&predictor.setScreenSize(e,t)}function hidePageFromPreview(e,a){var t;e instanceof jQuery||(e=$(e)),null==a&&(a=e.data("hidden")||!1),$("#"+e.attr("data-pageid")).add(e).attr("data-hidden",!a),e.is(".dd-parent")&&(t=a?"expand":"collapse",e.find("  button[data-action="+t+"]").click(),e.find("li").each(function(e,t){hidePageFromPreview(t,a)}))}function populateLoremText(){supercanvas.find(".text-lorem [data-lorem-count]").each(function(e,t){var a=$(t).data("lorem-count");($(t).find(".textme").length?$(t).find(".textme"):$(t).append("<div>").find("div").addClass("textme")).text(paragraphArr.slice(0,a+1).join(" "))})}$canvas.bind("mouseleave",function(){$guidesHV.hide()}),document.querySelector("#canvas").addEventListener("mousemove",function(e){(Math.abs(e.movementX)<=2&&Math.abs(e.movementY)<=2||snap.h||snap.v)&&handleCanvasMousemove(e)}),previewMode&&$canvas.unbind("mousemove"),previewMode||computeGuides("#canvas"),$("body > .overlay").bind("click contextmenu",function(e){}),$snaptoguides.bind("change",function(){appSettings.snapToGuides=this.checked,this.checked&&(appSettings.snapToGrid=!1,$snaptogrid.attr("checked",!1),$canvaswrap.attr({"data-grid-snap":"false"}),gridsize=0,appSettings.snapToGrid=!1),$guidesHV.hide(),saveSettings()}),$selectgridtype.change(function(){"graph"==$selectgridtype.val()?($("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$showgrid.attr("checked","checked"),$canvaswrap.attr("data-grid-type","graph"),appSettings.snapToCol=!1,appSettings.snapToGrid=!0,removeGuides(".col")):"dots"==$selectgridtype.val()?($("#grid-dot").show(),$("#gridcol, #grid-div").hide(),$showgrid.attr("checked","checked"),$canvaswrap.attr("data-grid-type","dots"),appSettings.snapToCol=!1,appSettings.snapToGrid=!0,removeGuides(".col")):($("#gridcol").show(),$("#grid-div , #grid-dot").hide(),$showgrid.attr("checked","checked"),$canvaswrap.attr("data-grid-type","col"),appSettings.snapToGrid=!1,appSettings.snapToCol=!0,computeGuides("col")),saveSettings()}),$drawsnap.bind("change",function(){appSettings.drawSnap=this.checked,$guidesHV.hide(),saveSettings()}),$transformsnap.bind("change",function(){appSettings.transformSnap=this.checked,$guidesHV.hide(),saveSettings()}),$container.scroll($.debounce(150,function(){previewMode||computeGuides(activepage.find(" > .wire, > .w-group").add("#canvas > .master-on > .wire, #canvas > .master-on > .w-group"))})).scroll(function(){previewMode||($("#wcc-toolbar-instance").length||"true"===$("#wcc-toolbar-instance").attr("data-hidden")?positionTextWirepanel():0===wirepanel[0].offsetTop&&"true"!==wirepanel.attr("data-hidden")||positionwirepanel(null,null,null,null,!0))}),$canvaswrap.bind("mouseleave",function(){$guidesHV.hide(),removeMarkedElemBorder()}),$("#sitemap-wrap").delegate(".hidepage","click",function(e){hidePageFromPreview($(this).parent())}),previewMode&&supercanvas.bind("click",function(){$container.add("body").removeClass("slide-right")}),jQuery.fn.getShowingText=function(){for(var e=$(this).width(),t=($("body").append('<div id="TestText" style="padding:0;border:0;height:auto;width:'+e+'px;position:absolute;display:none;"></div>'),$(this).innerHeight()),a=0,i=!1,s=$("#TestText"),n=(s.innerHeight(),"Lorem"),o=1;o<paragraphArr.length&&a<=t+5;o++)n+=" "+paragraphArr[o],s.text(n),a=s.innerHeight(),paragraphArr[o],o===paragraphArr.length&&(i=!0);return s.remove(),!1===i?(t+5<a&&--o,{text:paragraphArr.slice(0,o=o<=1?2:o).join(" "),count:o-1}):paragraphtext},jQuery.fn.selectText=function(){var e,t,a;$.browser.mozilla?(t=document,e=this[0],t.body.createTextRange?((a=document.body.createTextRange()).moveToElementText(e),a.select()):window.getSelection&&(t=window.getSelection(),(a=document.createRange()).selectNodeContents(e),t.removeAllRanges(),t.addRange(a))):document.execCommand("selectAll",!1,null)},$canvas.find("div.brandnew").remove();var w,app,preservedSel={};function setFontSizeSlider(e,t){quill&&(e=e||(quill.getSelection()?quill.getSelection().index:0),e=quill.getFormat(e),t=t||e.customfontsize||"normal",e.lh,fsi=["12px","14px","16px","normal","22px","28px","42px"].indexOf(t),$("#wcc-toolbar-instance #font-size-ui-slider").slider("value",fsi))}function setCurrentTextColor(e,t){quill&&!(1<activepage.find(".selected").length)&&(e=e||(quill.getSelection()?quill.getSelection().index:0),e=quill.getFormat(e),t=t||e.color||"h4")&&$("#wcc-toolbar-instance .ql-color-picker .ql-picker-options [data-value="+t+"]").siblings().removeClass("ql-selected-2").end().addClass("ql-selected-2")}function updateTextTo21(e){if(!e)return!1;var e=$(e),t=(e.parents(".wirejr").hasClass("text-arimo")||e.css("letter-spacing","0"),{}),a=("bold"!=e.css("fontWeight")&&700!=e.css("fontWeight")||(t.bold="true"),"18px"===e.parents(".wirejr").css("font-size")&&"18px"===e.css("font-size")||(t.size=(""!==e.css("font-size")?e:e.parents(".wirejr")).css("font-size"),""!==e[0].style.fontSize&&e.css({"letter-spacing":".18px"}),e.css({"line-height":1.2,"font-size":""}).parents(".wirejr").css({"font-size":""})),$.inArray(e.parents(".text").css("color"),["rgb(255, 255, 255)","rgb(221, 221, 221)","rgb(170, 170, 170)","rgb(119, 119, 119)","rgb(68, 68, 68)","rgb(17, 17, 17)","rgb(255, 99, 71)","rgb(78,133,244)"]));0<=a&&(t.color=["f","d","a","h7","h4","h1","t","b"][a]),"start"!==e.css("text-align")&&(t.align=e.css("text-align"),e.css("text-align","")),e.data("text-format",t).unwrap(".text"),e.addClass("ql-editor").removeAttr("contenteditable").parents(".wirejr").addClass("text-arimo").end().parents(".wire").addClass("text21")}function detectIE(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");return 0<t?parseInt(e.substring(t+5,e.indexOf(".",t)),10):0<e.indexOf("Trident/")?(t=e.indexOf("rv:"),parseInt(e.substring(t+3,e.indexOf(".",t)),10)):0<(t=e.indexOf("Edge/"))&&parseInt(e.substring(t+5,e.indexOf(".",t)),10)}function makeShareUrl(){if(previewMode)return!1;var e=Boolean(parseInt($("#all-pages").val())),t=(a=$("#shareurl").val()).indexOf("#"),a=a.substring(0,-1!=t?t:a.length);a+=e?"#"+activepage.attr("id"):"",$("#shareurl").val(a),$("a#sharelink").attr("href",a)}function getMaxZIndexElem(e){}function appendLockBtn(e){e.find("button.unlock_inner_btn").length||$("<button/>").addClass("unlock_inner_btn").attr("data-hint","Unlock ("+(navigator.userAgent.indexOf("Mac OS X")?"":"Ctrl + Shift + ")+"L)").appendTo(e)}function selectWire(e,t,i,s,a,n){if(!e||0==e.length)return!1;$(e).hasClass("selected")&&!$(e).hasClass("brandnew")||wirepanel.hide().attr("data-hidden",!0),quill&&blurRTE();var o=$(e).not(".w-group");if(selectedHovered=!0,$guidesHV.hide(),removeMarkedElemBorder(),1<o.length&&(i=!0),(o.hasClass("w-group-member")||o.hasClass("area-indicator"))&&!a&&!o.parents(".group-active").length){if((a=o.parentsUntil("#"+app.activepage.id).not(".w-group-member, .g-selected")).addClass("g-selected"),a.hasClass("locked")&&e.filter(".w-group-member").length==e.length)return render_edit_menu(),void positionwirepanel();if(o=e.add(a.find(".w-group-member").not(".w-group")).filter(function(){return 0==$(this).parents(".locked").length}),a.filter(".locked").removeClass("g-selected"),1==o.length)return void selectWire(o);i=o}if((o.hasClass("w-group-member")||o.hasClass("area-indicator"))&&o.parents(".w-group-member").length&&o.parents(".group-active").length&&!n&&(a=o.parentsUntil("#"+o.parents(".group-active").attr("id")).last().addClass("g-selected"),i=o=o.add(a.find(".w-group-member").not(".w-group"))),i=(t||s&&(s.shiftKey||s.ctrlKey||s.metaKey))&&(o=o.add(activepage.find(".selected, .w-group-member.g-selected, .section-selected").not(".w-group, .locked")),activepage.find(".locked.selected, .locked.g-selected").removeClass("selected, g-selected"),1<o.length)?o:i){let e=1<i.length?$(i):o;readColors(e=e.not(".area-indicator")),e.not(".w-group").addClass("selected").draggable("destroy").resizable("destroy").radiusable("destroy");let t;t=!e.first().parent().hasClass("has-section")||$canvas.data("groupActive")?getMultiElemArea(e):getMultiElemArea(e.first().siblings(".area-indicator"));let a;if(activepage.find("#selection-transformator").length?a=activepage.find("#selection-transformator"):makeDrag(a=$("<div/>").attr("id","selection-transformator").prependTo(activepage)),a.css({top:t.top,left:t.left,width:t.right-t.left,height:t.bottom-t.top}),s&&(3===s.which||"contextmenu"===s.type))return render_edit_menu(),!1;selectingInProgress||(e.filter(".hastext").length==e.length&&0==activepage.find(".g-selected.has-section").length?(editme(e.first(),!1,null,!1,!0),e.first().find("[contenteditable]").attr("contenteditable",!1),e.addClass("selected"),setCurrentTextColor(),getSelTextsFormat()):(render_edit_menu(),positionwirepanel(e)))}else{if(!selectingInProgress&&$canvas.data("groupActive")&&deselectAll(null,!0),o.hasClass("selected")?makeDrag(o):(showWireDim(o),makeDrag(o),o.addClass("selected").draggable("enable")),readColors(o),!(o.is(".hastext")||o.is(".btn")||o.find(".box").length||o.find(".roundbox").length||o.find(".combobox2").length||o.find(".elipse").length)||o.is(".edited-text")||activepage.find("#sel-text").length||o.is(".locked")||o.parents(".master-on").length||o.hasClass("grouped")||!(o.find(".box").length||o.find(".roundbox").length||o.find(".combobox2").length||o.find(".elipse").length)||o.find(".textme").length||o.addClass("btn empty-btn").find(".wirejr").append($("<div>").addClass("textme").css({width:o.width()-2*parseInt(o.find(".wirejr").css("borderLeftWidth")),height:o.height()-2*parseInt(o.find(".wirejr").css("borderLeftWidth"))})),s&&(3===s.which||"contextmenu"===s.type)||$(e).hasClass("locked")&&!$(e).hasClass("selected"))return render_edit_menu(),!1;selectingInProgress||(editme(o,s,null,!1,!0),quill&&o.hasClass("hastext")&&!o.hasClass("locked")?(o.find(".ql-editor[contenteditable]").attr("contenteditable",!1),quill.setSelection(0,0),o.addClass("selected")):$(e).hasClass("aa")||(render_edit_menu(),positionwirepanel(o)))}}function getMultiElemArea(e){let i=1e5,s=99990,n=-1,o=-1;return e.not(".w-group").each(function(){var e=$(this).offset(),t=$(this).width(),a=$(this).height();i=i<e.top-$canvaswrap.offset().top?i:e.top-$canvaswrap.offset().top,s=s<e.left-$canvaswrap.offset().left?s:e.left-$canvaswrap.offset().left,n=n>e.left-$canvaswrap.offset().left+t?n:e.left-$canvaswrap.offset().left+t,o=o>e.top-$canvaswrap.offset().top+a?o:e.top-$canvaswrap.offset().top+a}),{top:i,bottom:o,left:s,right:n}}function showWireDim(e,t){!1!==(e=e instanceof jQuery?{x:e.position().left,y:e.position().top,w:e.outerWidth(),h:e.outerHeight()}:e)&&void 0!==e.x&&($("#dimcoord").show(),$("#dimcoord").html("<span><b>X:</b> "+e.x+" px</span><span><b>Y:</b> "+e.y+" px</span><span><b>W:</b> "+e.w+" px</span><span><b>H:</b> "+e.h+" px</span>"))}function deselectAll(e,t){$("#selection-transformator").remove();var a=activepage.find(".selected");a.parents(".section-selected").length||activepage.find(".section-selected").removeClass("section-selected").resizable("destroy").draggable("destroy").find(".ui-sortable").sortable("destroy"),activepage.find(".g-selected").removeClass("g-selected"),!t&&activepage.find(".group-active").length&&(selectingInProgress=!1,(t=activepage.find(".group-active")).removeClass("group-active"),removeGuides(t.find(".wire, .w-group .area-indicator")),computeGuides(t),activepage.find(".group-active-prev").removeClass("group-active-prev"),$canvas.data("groupActive",!1)),a.removeClass("selected edited-text editingtext").resizable("destroy").draggable("destroy").radiusable("destroy").removeClass("ui-resizable-autohide").off(),blurRTE(),a.each(function(){$(this).hasClass("empty-btn")&&$(this).removeClass("btn empty-btn").find(".wirejr").empty().off()}),$canvas.data("master-dragged",!1),$canvas.find(".master-on.ui-draggable").length&&deselectMaster(),e||controlIconsHide(),wirepanel.attr("data-hidden",!0)}function selectElem(e,t,a){selectWire(e)}function controlIconsHide(){wirepanel.hide(),$(".control-icons").find(".pressed").removeClass("pressed").end().find(".visible").removeClass("visible").end().hide()}function controlIconsShow(){$("#lock,[data-action=group]").removeClass("pressed inactive");var e=activepage.find(".selected").length?activepage.find(".selected"):activepage.find(".g-selected");e.length?($(".control-icons").show(),e.parents(".w-group").length&&!e.filter(".selected").not(".w-group-member").length&&!$canvas.data("groupActive")&&e?($("[data-action=group]").hide(),$("[data-action=un-group-btn]").show()):($canvas.data("groupActive")&&e.length===activepage.find(".group-active .wire").length?$("[data-action=group]").hide():$("[data-action=group]").show(),$("[data-action=un-group-btn]").hide()),e.hasClass("locked")&&$("#lock").addClass("pressed")):controlIconsHide()}function applyTemplate(e,t){"browser-wrap"===e&&(e="browser"),$canvaswrap.removeClass("browser-wrap mobile tablet"),$("#device-skin-popup").find('span[data-device="'+e+'"]').addClass("selected-template").siblings().removeClass("selected-template"),"none"===e||"browser"===e?($("#device-skin-popup").addClass("no-device"),$canvaswrap.add(activepage).removeAttr("data-orientation")):$("#device-skin-popup").removeClass("no-device"),$("#device-indicator").attr({"data-device":e,"data-orientation":t||"false"}),activepage.add("#canvas-wrap").attr({"data-template":e,"data-orientation":t||"false"}),multipaged&&($.observable(app.pages[app.activepage.id]).setProperty({template:e}),"mobile"!==e)&&"tablet"!==e&&$.observable(app.pages[app.activepage.id]).setProperty({orientation:"false"})}function makeAADrag(e){e.is(":data(draggable)")||e.draggable({cancel:".annotbox , .closeannot",cursor:"move",start:function(){draggingInProgress=!0,$canvaswrap.addClass("dragging-in-progress")},stop:function(){draggingInProgress=!1,$canvaswrap.removeClass("dragging-in-progress")}}).resizable({handles:"n,e,s,w"})}function positionTextWirepanel(){return void positionwirepanel(null,!0)}function setVerticalAlignment(e,t){e.find(".textme").css("vertical-align",t),setVertAlignBtn(t)}function setVertAlignBtn(e){"baseline"==(e=e||"middle")&&(e="middle"),$("#wcc-toolbar-instance .ql-vertical-align .ql-picker-label svg").html($(".ql-vertical-align [data-value="+e+"] svg").html()),$("#wcc-toolbar-instance .ql-vertical-align .ql-picker-options .ql-selected").removeClass("ql-selected"),$("#wcc-toolbar-instance .ql-vertical-align [data-value="+e+"]").addClass("ql-selected")}function saveSettings(){localStorage.setItem("settings",JSON.stringify(appSettings))}function applySettings(){var e=JSON.parse(localStorage.getItem("settings"));if(!e)return!1;$.extend(appSettings,e),0==e.drawOnTop&&$("#draw-on-top").attr("checked",!1),!0===e.drawOnTop&&$("#draw-on-top").attr("checked","yes"),e.defaultStyle&&$.each(e.defaultStyle,function(e,t){"fill"===e&&setStyleColorInd(t,"right"),"stroke"===e&&setStyleColorInd(t,"left"),"width"===e&&setStyleWidthInd(t)}),$snaptoguides.attr("checked",e.snapToGuides)}function removeMarkedElemBorder(){activepage.add("#canvas > .master-on").find("[data-snap-mark-h] , [data-snap-mark-v]").removeAttr("data-snap-mark-h").removeAttr("data-snap-mark-v")}function setStyleWidthInd(e){$("#stroke-width-ind-wrap #stroke-width-ind").css("height",e)}function setStyleColorInd(e,t){t=$("#def-style").find(".style-select[data-pos="+t+"] > div");"transparent"==e?(t.css("backgroundColor",""),t.addClass("nocolor")):(t.css("backgroundColor",e),t.removeClass("nocolor"))}function makeScreenshot(a){window.devicePixelRatio,!window.chrome||window.chrome.webstore||window.chrome.runtime;html2canvas(document.querySelector("#canvas"),{backgroundColor:"#fff",onclone:function(e){$(e).find("#canvas").css({"box-shadow":"none"}).end().find("#grid-dot,#grid-div").remove().end(),$(e).find(".paragraph,.list").each(function(e,t){var a=2*parseInt($(t).find(".txtcont").css("lineHeight"))+"px",i=$(t).find(".txtcont span, .listcont span").css("backgroundColor");$(t).css({background:"",color:i,"background-size":"100%"+a+", 89% "+a}).addClass("paragraph-v2").removeClass("paragraph list").empty()}),$(e).find(".headtext span").css({display:"bloc",float:"left"})},scale:1,x:$("#canvas").offset().left,y:$("#canvas").offset().top,width:$("#canvas").width(),height:$("#canvas").width()/1.68}).then(function(e){var t=document.createElement("canvas"),t=(t.setAttribute("width",240*window.devicePixelRatio),t.setAttribute("height",143*window.devicePixelRatio),t.getContext("2d")),t=(t.imageSmoothingEnabled=!0,t.webkitImageSmoothingEnabled=!0,t.msImageSmoothingEnabled=!0,t.imageSmoothingQuality="high",t.drawImage(e,0,0,e.width,e.height,0,0,240*window.devicePixelRatio,143*window.devicePixelRatio),JSON.parse(localStorage.getItem("wcc-saved")));t[a].img=e.toDataURL(),localStorage.setItem("wcc-saved",JSON.stringify(t)),localStorage.setItem("imgCanvas",e.toDataURL())})}function scaleIt(e,t){var a=document.createElement("canvas"),i=a.getContext("2d"),s=e.width*t,t=e.height*t;return a.width=s,a.height=t,i.drawImage(e,0,0,s,t),a}function saveThumbAndData(e){var t;saved=JSON.parse(localStorage.getItem("wcc-saved")||"{}"),"order"!=e&&(saved.order||(saved.order=[]),saved[e]||(saved[e]={}),0<=(t=saved.order.indexOf(e))?saved.order.unshift(saved.order.splice(t,1)[0]):saved.order.unshift(e),$.extend(saved[e],{date:Date.now()}),localStorage.setItem("wcc-saved",JSON.stringify(saved)),makeScreenshot(e))}$("#all-pages").change(function(){makeShareUrl()}),$("#feux-font-size-slider").slider({min:0,max:2,value:1,slide:function(e,t){setFeuxFonsSize(t.value)}}),$canvas.delegate(".wire.locked","click",function(e){previewMode||$(e.target).parents(".wire").parent().hasClass("master-on")}),$canvas.delegate(".wire.grouped","click",function(e){previewMode||(showWireDim(e=$(e.target)),e.addClass("selected"),$("[data-action=group]").addClass("pressed"))}),$.fn.highestZIndex=function(){let i,s=0;return this.each(function(e,t){var a=Number.parseInt($(t).find(".wirejr").css("z-index"));(a=Number.isNaN(a)?0:a)>=(s=Math.max(s,a))&&(i=$(t),s=a)}),i},$.fn.reverse=[].reverse,$.fn.siblingsUnderMouse=function(n,e){e=e||"*";var o=$();return this.parent().find(e).each(function(){var e=$(this),t=(n.pageX-e.offset().left).toFixed(),a=(n.pageY-e.offset().top).toFixed(),i=e.width(),s=e.height();t<0||i<=t||a<0||s<=a||(o=o.add(e))}),o.not(".area-indicator").highestZIndex()},$canvas.on("mouseup",".wire.selected",function(e){(e.metaKey||e.shiftKey)&&$(this).hasClass("selected")&&(deselectAll(),controlIconsShow())}),-1!=navigator.userAgent.indexOf("Mac OS X")&&$("#top, .wcc-toolbar").find("[data-hint]").each(function(){$(this).attr("data-hint",$(this).attr("data-hint").replace("Ctrl","").replace("Shift",""))}),multipaged||(activepage=$("#canvas"),supercanvas.css({height:$(this).height()+250}),(w=parseInt($canvaswrap.width(),10)+250)<$(window).width()&&(w=$container[0].clientWidth),supercanvas.css({width:w+"px"}),supercanvas.css({height:$(this).height()+250}),app={activepage:{masterpageSelected:!1}}),$("#device-skin-popup [data-device]").on("click",function(e){var t=$(this).attr("data-device"),a="mobile"===t?["320","480"]:"tablet"===t?["728","1024"]:["1024","728"];$canvaswrap.center(),activepage.find(".wire").length||($canvaswrap.css({width:a[0]+"px",height:a[1]+"px"}).center(),activepage.attr({"data-page-width":a[0],"data-page-height":a[1]})),offset_c=$("#canvas").offset(),updateCanvasInput(),applyTemplate(t)}),$("#device-indicator").click(function(){sett.removeClass("pressed"),exportbtn.removeClass("pressed"),$("body").toggleClass("show-device-skin-popup").removeClass("slide-left slide-down top-dd-active show-settings-colorpicker")}),$("#rotate-btn").on("click",function(){var e;e=(!$canvaswrap.attr("data-orientation")||"false"===$canvaswrap.attr("data-orientation"))&&"landscape",$canvaswrap.add("#device-indicator").add(activepage).attr("data-orientation",e),"mobile"!==activepage.attr("data-template")||activepage.find(".wire").length||(e?($canvaswrap.css({width:"480px",height:"320px"}).center(),activepage.attr({"data-page-width":480,"data-page-height":320})):($canvaswrap.css({width:"320px",height:"480px"}).center(),activepage.attr({"data-page-width":320,"data-page-height":480}))),"tablet"!==activepage.attr("data-template")||activepage.find(".wire").length||(e?($canvaswrap.css({width:"1024px",height:"728px"}).center(),activepage.attr({"data-page-width":1024,"data-page-height":728})):($canvaswrap.css({width:"728px",height:"1024px"}).center(),activepage.attr({"data-page-width":728,"data-page-height":1024}))),multipaged&&$.observable(app.pages[app.activepage.id]).setProperty({orientation:e}),removeGuides("#canvas"),computeGuides("#canvas")}),$.widget("ui.radiusable",{_init:function(){if(!this.element.hasClass("grouped")&&(this.element.find(".box").length||this.element.find(".wcc-button").length||this.element.find(".roundbox").length||this.element.find(".combobox2").length)&&!this.element.find(".ui-border-radius-handle").length){this.element.addClass("wcc-radiusable");for(var c=parseInt(this.element.find(".wirejr").css("borderRadius"),10),e=0;e<=3;e++){this.element.append($("<div>").addClass("ui-border-radius-handle ui-border-radius-handle-"+e).data("pos",e)),this.positionHandles(c);var i=this;this.element.find(".ui-border-radius-handle").draggable({start:function(e,t){saveState(),$(this).parent().removeClass("selected").addClass("ui-radiusable-active"),draggingInProgress=!0},drag:function(e,t){var a=$(this).parent().find(".wirejr"),i=parseInt(a.css("borderLeftWidth"),10),s=a.width()<=a.height()?a.width()/2:a.height()/2,n=s;switch($(this).data("pos")){case 0:t.position.top=t.position.left,(t.position.top<0||t.position.left<0)&&(t.position.left=0,t.position.top=0),(t.position.top>s||t.position.left>s)&&(t.position.left=s,t.position.top=s);var o=t.position.top/n,r=parseInt((s+i)*o,10);a.css("borderRadius",r);break;case 1:t.position.top=a.width()-t.position.left,(t.position.top<0||t.position.left>a.width())&&(t.position.left=a.width(),t.position.top=0),(t.position.top>s||t.position.left<a.width()-s)&&(t.position.left=a.width()-s,t.position.top=s);o=t.position.top/n,r=parseInt((s+i)*o,10);a.css("borderRadius",r);break;case 2:var l=a.height(),d=a.width(),o=(t.position.top=l-(d-t.position.left),(t.position.top>l||t.position.left>d)&&(t.position.left=d,t.position.top=l),(t.position.top<l-s||t.position.left<d-s)&&(t.position.left=d-s,t.position.top=l-s),(l-t.position.top)/n),r=parseInt((s+i)*o,10);a.css("borderRadius",r);break;case 3:l=a.height(),d=a.width(),o=(t.position.top=l-t.position.left,(t.position.top>l||t.position.left<0)&&(t.position.left=0,t.position.top=l),t.position.left>s&&(t.position.left=s,t.position.top=s),t.position.left/n),r=parseInt((s+i)*o,10);a.css("borderRadius",r)}c=r},stop:function(e,t){i.positionHandles(c);var a=$(this).parent();a.addClass("selected").removeClass("ui-radiusable-active"),draggingInProgress=!1,stageElemForSaving(a,{action:"updated"},{getCss:["br"]})}})}}},positionHandles:function(e){e=e||this.element.find(".wirejr").css("borderTopLeftRadius"),e=parseInt(e,10);var a=this.element.width(),i=this.element.height(),t=a<=i?a/2:i/2,s=parseInt(e+12*(1-e/t),10);(t<s||s<=0)&&(s=t-1),this.element.find(".ui-border-radius-handle").each(function(e,t){switch($(this).data("pos")){case 0:$(this).css({top:s,left:s});break;case 1:$(this).css({top:s,left:a-s});break;case 2:$(this).css({top:i-s,left:a-s});break;case 3:$(this).css({top:i-s,left:s})}})},destroy:function(){this._destroy()},_destroy:function(){this.element.removeClass("wcc-radiusable").removeData("radiusable").find(".ui-border-radius-handle").remove()}}),$canvaswrap.on("mousedown",".ql-editor[contenteditable=true], .wcc-toolbar",function(e){e.stopPropagation()}),$("#save-overlay,#close-save-card").on("click",function(){$body.removeClass("show-save-modal")}),$canvas.find(".page > .grouped.wire").css("z-index",""),$("#def-style").on("click",".style-select.-c-p",function(){$body.addClass("show-settings-colorpicker");var e=$(this).data("def-style-attr"),t=$(this).data("pos"),e=appSettings.defaultStyle[e];$("#def-style").attr("data-cp-pos",t),$("#settings-colorpicker").find("[data-val]").removeClass("color-selected").end().find("[data-val="+e+"]").addClass("color-selected")}),$("#def-style").on("click",".style-select.-c-p-w",function(){$body.addClass("show-settings-colorpicker");appSettings.defaultStyle.width;$("#def-style").attr("data-cp-pos","center")}),$(".options").on("click",function(e){$(e.target).hasClass("style-select")||$body.removeClass("show-settings-colorpicker")}),$("#settings-colorpicker").on("click","div",function(){var e=$("#def-style").attr("data-cp-pos"),t=$(this).data("val");$(this).siblings(".color-selected").removeClass("color-selected").end().addClass("color-selected"),appSettings.defaultStyle["left"===e?"stroke":"fill"]=t,saveSettings(),setStyleColorInd(t,e),$body.removeClass("show-settings-colorpicker")}),$("#settings-str-width-picker").on("click","div",function(){var e=$(this).data("val");appSettings.defaultStyle.width=e,saveSettings(),setStyleWidthInd(e),$body.removeClass("show-settings-colorpicker")}),$("#draw-on-top").on("change",function(e,t){appSettings.drawOnTop=$(this).prop("checked"),saveSettings()});var scc=1;function renderIconPicker(){$("body").addClass("show-icon-picker");var e,t=activepage.find(".selected").length?activepage.find(".selected"):$canvas.find(".brandnew");t.length&&((t=232<t.position().left+t.width()/2+$canvas.offset().left?t.position().left+t.width()/2+$canvas.offset().left:232)+232>window.innerWidth&&(t=window.innerWidth-268),e=wirepanel.position().top+36+410>window.innerHeight?window.innerHeight-410:wirepanel.position().top+36+50,$("#icon-picker").css({top:e,left:t}),clearIconsSearch(),$("#icons-gallery-wrap").scrollTop(0))}function loadSvgIcons(a){switch(a){case"fa":var e=window.location.pathname.startsWith("/pro/")?"../../wcc-icons/font-awesome-icons.svg":"wcc-icons/font-awesome-icons.svg";break;case"md":e=WIREFRAME_URL+"wcc-icons/material-design-icons.svg"}var i=new XMLHttpRequest;i.open("GET",e,!0),i.send(),i.onload=function(e){var t=document.createElement("div");t.classList.add("svg-icons-sprite"),t.setAttribute("data-pack",a),t.innerHTML=i.responseText,$("body").append(t)}}function loadHtmlIcons(s,e){$("#icons-gallery-wrap .source-info").hide();var n=new XMLHttpRequest;switch(s){case"fa":var t=window.location.pathname.startsWith("/pro/")?"../../wcc-icons/font-awesome-icons.html":"wcc-icons/font-awesome-icons.html";break;case"md":t=WIREFRAME_URL+"/wcc-icons/material-design-icons.html"}n.open("GET",t,!0),n.send(),n.onload=function(e,t){var a=document.querySelector("#icons-gallery"),i=document.querySelector("#icon-picker"),a=(a.innerHTML=n.responseText,i.setAttribute("data-pack",s),$("#icons-gallery-wrap .source-info").show(),$("#icon-search").val().replace(/[^A-Za-z0-9]+/g,""));$("#icons-gallery div[title*="+a+"]").length&&($("#icons-gallery div").hide(),$("#icons-gallery div[title*="+a+"]").show())},$("#iconset").val(s)}function clearIconsSearch(){$("#search-x").hide(),$("#icons-gallery div").show(),$("#icon-search").val("").focus(),$("#icons-gallery-wrap .source-info").show(),$("#icons-gallery-wrap .no-res").hide()}0!==filename&&(loadSvgIcons("md"),loadSvgIcons("fa")),previewMode||0===filename||loadHtmlIcons(appSettings.iconPack),jQuery(document).ready(function(){$("#icon-search").bind("keyup",function(e){"Esc"!=e.key&&"Escape"!=e.key||$("#icon-search").blur();e=$(this).val().replace(/[^A-Za-z0-9]+/g,"");e.length<2?$("#icons-gallery div").show():($("#search-x").show(),$("#icons-gallery div").hide(),$("#icons-gallery div[title*="+e+"]").length?($("#icons-gallery div[title*="+e+"]").show(),$("#icons-gallery-wrap .source-info").show(),$("#icons-gallery-wrap .no-res").hide()):($("#icons-gallery-wrap .source-info").hide(),$("#icons-gallery-wrap .no-res").show()))}),$("#link-search").bind("keyup",function(e){"Esc"!=e.key&&"Escape"!=e.key||$("#link-search").blur()});let e=supercanvas.width();e<=$(window).width()&&(e=$container[0].clientWidth),supercanvas.css({width:e+"px"})}),$("#search-x").on("click",clearIconsSearch),$("#iconset").on("change",function(){var e=$(this).val();e!=$("#icon-picker").attr("data-pack")&&($("#icon-picker").attr("data-pack",e),$("#icons-gallery").empty(),$("#icons-gallery-wrap .source-info").show(),$("#icons-gallery-wrap .no-res").hide(),loadHtmlIcons(e),$(".svg-icons-sprite[data-pack="+e+"]").length||loadSvgIcons(e),appSettings.iconPack=e,saveSettings())}),$("#icons-gallery").on("click","div",function(){var e,t=$(this).find("use").attr("xlink:href").replace("#","");$("body").removeClass("show-icon-picker"),activepage.find(".selected").not(".locked").length?((e=activepage.find(".selected").not(".locked")).find("use").attr("xlink:href","#"+t),wirepanel.hide(),stageElemForSaving(e,{action:"updated"},{getIcon:!0,getCss:!1})):prepareWire("w-icon",t)}),$("#wp-icon-picker").click(renderIconPicker);let selectingInProgress=!1,excludedFromSelection=[],selection;function enterGroup(e){var t="#"+app.activepage.id;let a=e.first().parentsUntil(t).last(),i,s;deselectAll(null,!0),e.filter(".wire").length&&(i=e.filter(".wire"),(s=e.filter(".wire").parentsUntil("#"+activepage.find(".group-active").first().attr("id")).last()).length)&&$canvas.data("groupActive")&&(activepage.find(".group-active").removeClass("group-active").removeClass("g-selected").addClass("group-active-prev"),removeGuides(a),s.last().addClass("g-selected"),a=s),a.resizable("destroy").draggable("destroy"),a.addClass("group-active").removeClass("g-selected"),a.find(".selected").not(i).removeClass("selected"),activepage.find(".selected").removeClass("selected"),selectWire(i,null,null,void 0,!0,s.length&&activepage.find(".group-active-prev").length&&i.parent().hasClass("group-active")),computeGuides(a.find(" > .wire , > .w-group ")),removeGuides(a),$canvas.data("groupActive",!0)}function updateAreaIndForParentsOfSeleceted(){activepage.find(".selected").first().parents(".w-group").each(function(e,t){var a=getMultiElemArea($(t).find(".wire"));$(t).find(" > .area-indicator").css({top:a.top,left:a.left,width:a.right-a.left,height:a.bottom-a.top})})}function updateGroupAreaInd(e){e.add(e.parents(".w-group")).each(function(e,t){var a=getMultiElemArea($(t).find(".wire"));$(t).find(" > .area-indicator").css({top:a.top,left:a.left,width:a.right-a.left,height:a.bottom-a.top})})}function updateSelIndDim(){var e=getMultiElemArea(activepage.find(".selected, .g-selected.has-section > .area-indicator"));$("#selection-transformator").css({top:e.top,left:e.left,width:e.right-e.left,height:e.bottom-e.top})}function unblockBtnClicked(){var e=activepage.find(".w-group.g-selected").length;unlock(e?activepage.find(".w-group.g-selected"):activepage.find(".selected.locked"),e)}function updateGroup(e,t,a,i=0,c,p={top:0,left:0},g){if(e.hasClass("grouped")){var h=e.parent(),u=h.is(":visible");h.show().css("opacity",0),g||e.hasClass("copying");let s=a||{top:0,left:0},i=e.hasClass("groupmember");g=e.attr("data-link");let n=e.position(),o=e.find(" > div").position(),r=i?p:{top:0,left:0},l="auto"==e.css("zIndex")?0:parseInt(e.css("zIndex"),10),d=c||{top:0,left:0};l+=t||0;a=e.find(" > div"),p=(e.find(" > div").unwrap().removeAttr("style").attr({class:"w-group"+(i?" w-group-member":""),id:"g-"+(new Date).getTime()+(i?1:0),"data-link":g}),a.find(" > .selected").removeClass("selected").end().find(" > .grouped").each(function(e,t){var a={top:o.top+r.top,left:o.left+r.left},i={top:s.top+n.top,left:s.left+n.left};updateGroup($(t),l,i,a,d,a)}).end().find(" > .groupmember").not(".grouped, .w-group-member").removeClass("groupmember").addClass("w-group-member").each(function(e,t){var a="auto"==$(this).find(" > .wirejr").css("zIndex")?0:parseInt($(this).find(" > .wirejr").css("zIndex"),10);$(t).css({top:$(t).position().top+o.top+n.top+(i?+s.top+r.top:0)+d.top,left:$(t).position().left+o.left+n.left+(i?+s.left+r.left:0)+d.left}).find(" > .wire .wirejr").css("zIndex",a+l)}),getMultiElemArea(a.find(".wire").not(".grouped")));return a.prepend($("<div class=area-indicator>").css({top:p.top,left:p.left,width:p.right-p.left,height:p.bottom-p.top})),computeGuides(a.not(".w-group-member")),$toSelect=$toSelect.add(a.find(".wire").not(".grouped")),u&&h.show(),h[0].style.removeProperty("opacity"),a.find(".wire").map(function(){return this.id}).get()}}previewMode||(selection=Selection.create({class:"sel-area",selectables:[".page:not(.master-on) .wire:not(.groupmember):not(.locked), .w-group:not(.group-active) .area-indicator, .single-paged .wire:not(.groupmember):not(.locked), .aa"],startareas:[".supercanvas"],singleClick:!1,boundaries:[".container"],mode:"cover",startThreshold:0}).on("beforestart",function({oe:e}){if(this&&$canvas.data("groupActive")?this.options.selectables=[".group-active .w-group-member, .group-active .w-group-member .area-indicator"]:this.options.selectables=[".page:not(.master-on) .wire:not(.groupmember):not(.locked):not(.wcc-section-member), .w-group:not(.group-active) .area-indicator,.aa, .single-paged .wire:not(.groupmember):not(.locked), .wcc-section"],previewMode||draggingInProgress||resizingInProgress||selectingInProgress||e.target.matches("#selection-transformator")||e.target.matches(".ui-resizable-handle")||e.target.matches(".ql-editor")||e.target.matches(".brandnew.blank")||e.target.matches("#sel-text")||e.target.matches(".aa")||app.activepage.masterpageSelected||$(e.target).parents(".wire.ui-resizable").length||$(e.target).parents(".selected").length||$(e.target).parents(".selected").length&&$(e.target).parents(".group-active").length)return!1}).on("start",function({selected:e,oe:t}){if(selectingInProgress=!0,$canvas.addClass("selecting-in-progress"),!t.ctrlKey&&!t.metaKey&&!t.shiftKey){for(const a of e)a.classList.remove("selected");deselectAll(null,$canvas.data("groupActive")),selection.clearSelection()}}).on("move",({changed:{removed:e,added:t},selected:a})=>{let i=[];if(t.length||e.length){for(const o of a)excludedFromSelection.includes(o)||$(o).parents(".locked").length?excludedFromSelection.includes(o)||excludedFromSelection.push(o):(i.includes(o)||i.push(o),$(o).hasClass("w-group-member")&&0==$(o).parents(".group-active").length&&$(o).parentsUntil("#"+app.activepage.id).find(".w-group-member,.area-indicator").not(".w-group").not($(o)).each(function(e,t){i.includes(t)||i.push(t)}));t=1<i.length&&i;t||$("#selection-transformator").remove(),selectWire($(i),!1,t)}if(e.length){for(const r of e){var s=$(r);if(s.hasClass("w-group-member")){var n=s.parentsUntil("#"+app.activepage.id).find(".w-group-member");let a=!1;n.each(function(e,t){if(i.includes(t))return!(a=!0)}),a||n.add(s).removeClass("selected").draggable("destroy").resizable("destroy").radiusable("destroy")}else(s.hasClass("area-indicator")?s.parent().removeClass("g-selected").find(".selected").removeClass("selected"):(r.classList.remove("selected"),s)).draggable("destroy").resizable("destroy").radiusable("destroy")}1==i.length&&selectWire(i[0],!1,!1)}}).on("stop",function({oe:e}){selectingInProgress=!1,selectedHovered=!1,excludedFromSelection=[],selection.keepSelection(),$canvas.removeClass("selecting-in-progress");var t=activepage.find(".selected");if(1==t.length){if(t.hasClass("aa"))return!1;positionwirepanel(t),editme(t,e,null,!1,!0),t.hasClass("hastext")&&(t.find("[contenteditable]").attr("contenteditable",!1),t.addClass("selected"))}else t.filter(".wcc-section").length||(t.filter(".hastext").length==t.length?(editme(t.first(),e,null,!1,!0),t.first().find("[contenteditable]").attr("contenteditable",!1),t.addClass("selected"),getSelTextsFormat()):(render_edit_menu(),positionwirepanel(t)))})),$.ui.plugin.add("resizable","alsoResize",{utils:{west:function(e,t,a,i){return Math.round((e.left-t.left)*a+t.left+i.left)},east:function(e,t,a,i){return Math.round((e.left-t.left)*a+t.left)},south:function(e,t,a,i){return Math.round((e.top-t.top)*a+t.top)},north:function(e,t,a,i){return Math.round((e.top-t.top)*a+t.top+i.top)}},start:function(e,t){var a,i,s,n,o;activepage.find(".selected:not(.wcc-section-member)").length<=1||(i=(a=$(this).data("resizable")).options,s=a.originalSize,n=a.originalPosition,a.prevDim={width:t.size.width,height:t.size.height},o=function(e){$(e).each(function(){var e=$(this),t=e.data("temp-resizable-alsoresize"),t=(null!=t?e.data("resizable-alsoresize",{width:t.width,height:t.height,left:t.left,top:t.top}):e.data("resizable-alsoresize",{width:parseInt(e.width(),10),height:parseInt(e.height(),10),left:parseInt(e.css("left"),10),top:parseInt(e.css("top"),10)}),parseInt(e.css("top"),10)-n.top+parseInt(e.height(),10)==s.height),a=parseInt(e.css("left"),10)-n.left+parseInt(e.width(),10)==s.width,i=parseInt(e.css("top"),10)==n.top;e.data("alsoresize-coordfactor",{top:(parseInt(e.css("top"),10)-n.top)/s.height,bottom:(parseInt(e.css("top"),10)-n.top+parseInt(e.height(),10)-(t?0:1))/s.height,left:(parseInt(e.css("left"),10)-n.left)/s.width,right:(parseInt(e.css("left"),10)-n.left+parseInt(e.width(),10)-(a?0:1))/s.width,touchesTop:i,touchesBottom:t,touchesRight:a}),e.data("alsoresize-coordfactor").bottom,e.data("originalSize",{width:e.width(),height:e.height(),top:e.position().top,left:e.position().left}),t&&!i&&e.addClass("sel-btm-most"),e.data("element-type",{isText:e.has(".textnew").length,isIcon:e.find(".wirejr.w-icon").length,isVertLine:e.find(".line_vert").length,isHorLine:e.find(".line_hor").length})}),$canvas.data("groupActive")&&$(this).data("ui-resizable-area-ind",getMultiElemArea(activepage.find(".group-active > .area-indicator")))},"object"!=typeof i.alsoResize||i.alsoResize.parentNode?o(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],o(i.alsoResize)):$.each(i.alsoResize,function(e){o(e)}),removeGuides(i.alsoResize))},resize:function(e,f){if(!(activepage.find(".selected:not(.wcc-section-member)").length<=1)){var m=$(this).data("resizable"),t=m.options,v=m.originalSize,w=m.originalPosition,a=snap.h,i=snap.v;a&&(n=0,s=Math.round(a.y),"top"==a.snappedEdge&&(n=Math.round(a.y)-m.position.top,m.position.top=parseInt(Math.round(a.y)),m.size.height-=n),"bottom"==a.snappedEdge)&&(m.size.height=s-m.position.top+1),i&&("left"==i.snappedEdge&&(deltaW=Math.round(i.x)-m.position.left,m.position.left=Math.round(i.x),m.size.width-=deltaW),"right"==i.snappedEdge)&&(m.size.width=Math.round(i.x)-m.position.left+1),m.size.height,v.height,m.size.width,v.width,m.position.top,w.top,m.position.left,w.left;let h=0;var s,n=activepage.find(".selected.hastext").length;let u=n&&n<activepage.find(".selected").length;_alsoResize=function(e,t){$(e).each(function(){var e=$(this),t=e.data("alsoresize-coordfactor"),a=e.data("resizable-alsoresize"),i=e.data("element-type").isText,s=e.data("element-type").isIcon,n=m.handle.includes("s")||m.handle.includes("n");m.handle.includes("w")||m.handle.includes("e");"w"!=m.handle||n||(f.position.top=w.top);let o=Math.floor(m.position.left+m.size.width*t.left),r=Math.floor(m.position.top+m.size.height*t.top),l=t.right,d=t.bottom;i&&!t.touchesTop&&(c=(t.top+t.bottom)/2,(r=t.touchesBottom?Math.floor(f.position.top+(n?snap.h&&"bottom"==snap.snappedEdge?snap.h.y-f.position.top:f.size.height:v.height)-a.height):Math.floor(f.position.top+(n?f.size:v).height*c-a.height/2-1))<f.position.top)&&(r=f.position.top);var c,n=!i&&("w"==m.handle||"e"==m.handle)&&u;let p=e.data("element-type").isVertLine||e[0].hasAttribute("data-can-grow-hor")&&!$canvas.data("groupActive")?e.data("originalSize").width:Math.floor(m.size.width*l+m.position.left-o+(1==l?0:1)),g=e.data("element-type").isHorLine||e[0].hasAttribute("data-can-grow-hor")&&!$canvas.data("groupActive")||e[0].hasAttribute("preserve-h")||n?e.data("originalSize").height:Math.floor(m.size.height*d+m.position.top-r+(1==d?0:1));s&&("e"==m.handle||"w"==m.handle?(p=g,t.touchesRight&&(o=Math.floor(f.position.left+f.size.width-p))):"s"==m.handle||"n"==m.handle?(g=p,t.touchesBottom&&(r=Math.floor(f.position.top+f.size.height-g))):f.size.width>m.prevDim.width&&f.size.height>m.prevDim.height?(c=p<g?p:g,g=c,p=c,t.touchesRight&&(o=Math.floor(f.position.left+f.size.width-p)),t.touchesBottom&&(r=Math.floor(f.position.top+f.size.height-g))):(a=p<=g?p:g,g=a,p=a,g=10<a?a:10,p=11<a?a:11,t.touchesRight&&(o=Math.floor(f.position.left+f.size.width-p)),(r=t.touchesBottom?Math.floor(f.position.top+f.size.height-g):r)<f.position.top&&(r=f.position.top),o<f.position.left&&(o=f.position.left))),e.css({top:n?e.data("originalSize").top:r,left:o,width:p,height:g}),e.hasClass("btn")&&e.find(".textme").css({width:e.width(),height:e.height()}),i&&(s=e.find(".textme").height()-2,e.css("height",s),s>h)&&(h=s-2)})},"object"!=typeof t.alsoResize||t.alsoResize.nodeType?_alsoResize(t.alsoResize):$.each(t.alsoResize,function(e,t){_alsoResize(e,t)}),$canvas.data("groupActive")&&(a=$(window).data("ui-resizable-area-ind"),s=activepage.find(".group-active > .area-indicator"),i=f.size.height,n=f.size.width,f.position.top<a.top?s.css({top:f.position.top,height:a.bottom-f.position.top}):s.css({top:a.top,height:a.bottom-a.top}),f.position.left<a.left?s.css({left:f.position.left,width:a.right-f.position.left}):s.css({left:a.left,width:a.right-a.left}),f.position.left+n>a.right&&s.css({width:f.position.left+n-a.left}),f.position.top+i>a.bottom)&&s.css({height:f.position.top+i-a.top}),$canvas.data("groupActive")&&activepage.find(".group-active").not(".has-section").length&&activepage.find(".group-active, .group-active-prev").each(function(e,t){var a=getMultiElemArea($(t).find(".wire, .area-indicator"));$(t).find(" > .area-indicator").css({top:a.top,left:a.left,width:a.right-a.left,height:a.bottom-a.top})}),activepage.find(".selected .textnew, .w-icon").length&&(t=getMultiElemArea(activepage.find(".selected, .g-selected > .area-indicator")),$.extend(draggingInProgress,{bottom:"e"==m.handle||"w"==m.handle||m.handle.includes("s")?-1e3:t.bottom,top:m.handle.includes("n")?t.top:-1e3}),f.size.height=t.bottom-t.top,$(this).height(function(e,t){return f.size.height}),activepage.find(".g-selected.has-section > .area-indicator").css("height",f.size.height),$(this).resizable("option","minHeight",h),"w"==m.handle&&(f.position.top=w.top),snap.h&&"bottom"==snap.h.snappedEdge&&activepage.find(".selected.sel-btm-most").each(function(e,t){$(this).css("top",snap.h.y-$(this).height()+1)}),snap.h&&"top"==snap.h.snappedEdge&&(f.size.height=t.bottom-f.position.top,$(this).height(function(e,t){return f.size.height})),m.prevDim={width:f.size.width,height:f.size.height})}},stop:function(e,t){var a=$(this).data("resizable").options;function i(e){$(e).each(function(){$(this).removeData("temp-resizable-alsoresize"),$(this).removeData("alsoresize-coordfactor"),$(this).removeData("element-type")})}"object"!=typeof a.alsoResize||a.alsoResize.nodeType?i(a.alsoResize):$.each(a.alsoResize,function(e){i(e)}),activepage.find(".sel-btm-most").removeClass("sel-btm-most"),computeGuides($(a.alsoResize).not(".w-group-member").add(".g-selected.w-group")),removeGuides("#selection-transformator"),$(this).removeData("resizable-alsoresize")}}),$.ui.plugin.add("draggable","alsoDrag",{start:function(e){function t(e){$(e).each(function(){var e=$(this);e.data("ui-draggable-alsoDrag",{top:parseInt(e.css("top"),10),left:parseInt(e.css("left"),10)})}),$canvas.data("groupActive")&&$(this).data("ui-draggable-area-ind",getMultiElemArea(activepage.find(".group-active > .area-indicator")))}var a=$(this).data("draggable").options;let i=a.alsoDrag(e);"object"!=typeof i||i.parentNode?t(i):i.length?(i=i[0],t(a.alsoDrag)):$.each(i,function(e){t(e)}),removeGuides(i),$(this).draggable("option","alsoDragElem",i)},drag:function(e){function a(e,t){$(e).each(function(){var e,t=$(this),i=(void 0===$(this).data("ui-draggable-alsoDrag")?(e={top:parseInt(t.css("top"),10),left:parseInt(t.css("left"),10)},t.data("ui-draggable-alsoDrag",e)):e=$(this).data("ui-draggable-alsoDrag"),e),s={};$.each(["top","left"],function(e,t){var a=(i[t]||0)+(l[t]||0);s[t]=a}),t.css(s)})}var t=$(this).data("draggable"),i=t.options,s=(t.originalSize,t.originalPosition),n=snap.h,o=snap.v,r={top:0,left:0},n=("heightcenter"==n.snappedEdge&&(r.top=t.helperProportions.height/2-(t.helperProportions.height%2==0?0:.5)),"bottom"==n.snappedEdge&&(r.top=t.helperProportions.height-1),"widthcenter"==o.snappedEdge&&(r.left=t.helperProportions.width/2-(t.helperProportions.width%2==0?0:.5)),"right"==o.snappedEdge&&(r.left=t.helperProportions.width-1),{top:void 0!==n.y?n.y-r.top:t.position.top-(t.gridDelta?t.gridDelta.top:0),left:void 0!==o.x?o.x-r.left:t.position.left-(t.gridDelta?t.gridDelta.left:0)}),l={top:Math.round(n.top-s.top)||0,left:Math.round(n.left-s.left)||0};"object"!=typeof i.alsoDragElem||i.alsoDragElem.nodeType?a(i.alsoDragElem):$.each(i.alsoDragElem,function(e,t){a(e)}),$canvas.data("groupActive")&&!activepage.find(".group-active").not(".has-section").length&&(o=$(this).data("ui-draggable-area-ind"),r=activepage.find(".group-active > .area-indicator"),s=t.helperProportions.height,i=t.helperProportions.width,n.top<o.top?r.css({top:n.top,height:o.bottom-n.top}):r.css({top:o.top,height:o.bottom-o.top}),n.left<o.left?r.css({left:n.left,width:o.right-n.left}):r.css({left:o.left,width:o.right-o.left}),n.left+i>o.right&&r.css({width:n.left+i-o.left}),n.top+s>o.bottom)&&r.css({height:n.top+s-o.top}),$canvas.data("groupActive")&&activepage.find(".group-active").not(".has-section").length&&updateAreaIndForParentsOfSeleceted()},stop:function(e){var t=$(this).data("draggable").options;_removePosData=function(e){$(e).each(function(){$(this).removeData("ui-draggable-alsoDrag")})},"object"!=typeof t.alsoDragElem||t.alsoDragElem.parentNode?_removePosData(t.alsoDragElem):t.alsoDragElem.length?(t.alsoDragElem=t.alsoDragElem[0],_removePosData(t.alsoDragElem)):$.each(t.alsoDragElem,function(e){_removePosData(e)}),computeGuides($(t.alsoDragElem).not(".w-group-member,.area-indicator").add(".g-selected.w-group")),removeGuides("#selection-transformator"),$(this).removeData("draggable-alsoDrag")}}),$canvas.on("dblclick","#selection-transformator",function(e){let t=$(this).siblingsUnderMouse(e,".wire, .w-group .area-indicator");t.length&&!resizingInProgress?(t=t.filter(".w-group-member").length?t.filter(".w-group-member"):t).filter(".wire").hasClass("w-group-member")?enterGroup(t):(deselectAll(),selectWire(t.filter(".wire").first()),editme(t.filter(".wire").first(),e,null,!0)):editme($(".selected"),e)}),$canvas.on("click","#selection-transformator",function(e){var t,a;1<e.originalEvent.detail||((t=$(this).siblingsUnderMouse(e,".wire, .w-group .area-indicator"))?e.shiftKey||e.metaKey||e.ctrlKey?(t.filter(".w-group-member.selected").length&&t.filter(".w-group-member.selected").parents(".g-selected").find(".wire").removeClass("selected").end().removeClass("g-selected"),(t.filter(".area-indicator").length&&!t.filter(".wire").not(".w-group-member").length?t.first().parentsUntil("#"+app.activepage.id).last().toggleClass("g-selected").find(".wire"):t.filter(".wire").not(".w-group-member")).toggleClass("selected"),a=activepage.find(".selected"),deselectAll(),selectWire(a)):t.filter(".wire").length?1<e.originalEvent.detail||((a=$canvas.data("groupActive"))||deselectAll(),selectWire(t.filter(".wire"),null,null,void 0,a)):1<e.originalEvent.detail||deselectAll():deselectAll())}),$canvas.on("click",".wire.edited-text .ql-editor",function(e){e.stopPropagation()}),$canvas.on("dblclick",".wire.edited-text .ql-editor",function(e){e.stopPropagation()}),$canvas.on("click",".wire",function(e){if(!(1<e.originalEvent.detail)){if(appSettings.drawOnTop||draggingInProgress)return!1;e.ctrlKey||e.shiftKey||e.metaKey||deselectAll(null,$(e.target).parents(".group-active").length),selectWire(this,void 0,null,e,$canvas.data("groupActive"))}}),$("#unlock_inner_btn").on("click","button",function(e){unblockBtnClicked()}),$(".line_hor").not(".line_hor_ver_2").each(function(e,t){let a,i;multipaged&&(a=$(t).parents(".page"),i=a.is(":visible"),a.show().css("opacity",0)),$(t).parent().css({height:parseInt($(t).css("borderWidth"),10),top:$(t).parent().position().top+parseInt($(t).css("marginTop"),10)}),$(t).css("marginTop",0).addClass("line_hor_ver_2"),multipaged&&(i||a.hide(),a[0].style.removeProperty("opacity"))}),$(".line_vert").not(".line_vert_ver_2").each(function(e,t){let a,i;multipaged&&(a=$(t).parents(".page"),i=a.is(":visible"),a.show().css("opacity",0)),$(t).parent().css({width:parseInt($(t).css("borderWidth"),10),left:$(t).parent().position().left+parseInt($(t).css("marginLeft"),10)}),$(t).css("marginLeft",0).addClass("line_vert_ver_2"),multipaged&&(i||a.hide(),a[0].style.removeProperty("opacity"))});let $toSelect=$();function drawGuideH(e,t,a,i){var s=snap.h,n=snap.v;a&&(a-=$canvas.offset().left),i&&(i-=$canvas.offset().left);let o=$("#"+snappedIdH);var r=(o=o.hasClass("w-group")?o.find(" > .area-indicator"):o).width(),l=o.position().left,e={x:t?l+r<a&&t.x>a?a:i<l&&t.x<i?i:t.x:parseInt(e.pageX-$canvas.offset().left)};n&&(t&&(l+r<a&&t.x>a||i<l&&t.x<i)?e.x:e.x=n.x);let d=e.x<l?l-e.x:e.x>l+r?e.x-l-r:e.x<l+r/2?e.x-l:l+r-e.x;1==d&&(d=0),$guideH.addClass("visible").show().css({top:s.y+"px",left:e.x<l?e.x:e.x>l+r?l+r:e.x<l+r/2?l:e.x,width:d,display:0<d?"flex":"none"}).attr("data-dist",e.x<l?Math.round(l-(n||e).x):e.x>l+r?Math.round(e.x-(l+r)):Math.round(d)),"c"==s.pos?o.get(0).style.setProperty("--postop",s.y-o.position().top+"px"):o.get(0).style.removeProperty("--postop"),activepage.add("#canvas > .master-on").find("[data-snap-mark-h]").removeAttr("data-snap-mark-h"),markAadjacentElement(s,snappedIdH)}function drawGuideV(e,t,a,i){var s=snap.h,n=snap.v;a&&(a-=$canvas.offset().top),i&&(i-=$canvas.offset().top);let o=$("#"+snappedIdV);var r=(o=o.hasClass("w-group")?o.find(" > .area-indicator"):o).height(),l=o.position().top,e={y:t?l+r<a&&t.y>a?a:i<l&&t.y<i?i:t.y:parseInt(e.pageY-$canvas.offset().top)};s&&(t&&(l+r<a&&t.y>a||i<l&&t.y<i)&&e.y,e.y=s.y);let d=e.y<l?l-e.y:e.y>l+r?e.y-l-r:e.y<l+r/2?e.y-l:l+r-e.y;1==d&&(d=0),$guideV.addClass("visible").show().css({left:n.x+"px",top:e.y<l?e.y:e.y>l+r?l+r:e.y<l+r/2?l:e.y,height:d,display:0<d?"flex":"none"}).attr("data-dist",e.y<l?Math.round(l-(s||e).y):e.y>l+r?Math.round(e.y-(l+r)):Math.round(d)),"c"==n.pos?o.get(0).style.setProperty("--posleft",n.x-o.position().left+"px"):o.get(0).style.removeProperty("--posleft"),activepage.add("#canvas > .master-on").find("[data-snap-mark-v]").removeAttr("data-snap-mark-v"),markAadjacentElement(n,snappedIdV)}(multipaged?$(".page > .grouped"):$("#canvas > .grouped")).each(function(){updateGroup($(this))}),$(".ui-state-disabled").removeClass("ui-state-disabled").removeAttr("aria-disabled"),$canvas.on("click",".selected.btn .textme",function(e){e.stopPropagation();e=$(this);e.parents(".wire");quill?(blurRTE(),wirepanel.show(),positionwirepanel()):e.trigger("editThisText")});let snap={h:!1,v:!1};function uniqueArr(e){return Array.from(new Set(e))}function readColors(e){let s=[],n=[],o=["box","elipse","image","slider","slider2","progressbar2","combobox","combobox2","scrollh2","scrollv2","textinput2"];e.not(".w-group,.aa, .wcc-section").add(e.filter(".w-group").find(" > .wire")).each(function(e,t){for(var a=$(t).find(" > .wirejr"),i=a.attr("class").replace("wirejr ","").split(" "),e=0;e<=i.length;e++)if(0<=$.inArray(i[e],o)){s.push(a.css("background-color")),n.push(a.css("border-color"));break}(a.hasClass("paragraph")||a.hasClass("list")||a.hasClass("headline"))&&s.push(a.find(".txtcont span, .listcont li span, .headtext span").last().css("background-color")),a.hasClass("w-icon")&&s.push(a.css("color")),(a.hasClass("line_hor_ver_2")||a.hasClass("line_vert"))&&n.push(a.css("border-color"))}),app.selected={bgColor:uniqueArr(s),borColor:uniqueArr(n)}}function quillHandler(e,t){var a=quill.hasFocus(),i=0<=["color","align","customfontsize"].indexOf(t),s=a||quill.selection.savedRange.length?this.quill.selection.savedRange.index:0,n=quill.selection.savedRange.length?this.quill.selection.savedRange.length:this.quill.getLength(),o=!i&&this.quill.getFormat(s,n)[t];let r=!(0<this.quill.selection.savedRange.length)&&o===e?!o:e;i&&(r=r&&e),"customfontsize"==t&&this.quill.selection.savedRange&&0<this.quill.selection.savedRange.length?quill.format("customfontsize",e):a&&0==quill.selection.savedRange.length||"align"==t||"list"==t?this.quill.format(t,r,"api"):(this.quill.formatText(s,n,t,r,"api"),"wcclink"!=t&&"weblink"!=t||this.quill.formatText(s,n,"underline",r,"api"))}function quillRemoveHandler(e){$("#wcc-toolbar-instance").removeClass("wcc-more-options").find(".ql-picker.ql-expanded").removeClass("ql-expanded");var t=quill.hasFocus(),a=t?this.quill.selection.lastRange.index:0,i=t?this.quill.selection.lastRange.length:this.quill.getLength()-1;t||activepage.find(".edited-text").siblings(".selected.hastext").each(function(e,a){let t=$(a).find(".textme").children();for(;t.length;){if("br"==t[0].nodeName.toLowerCase())break;t=t.children()}$.each($(a).find(".textme")[0].childNodes,function(e,t){3==t.nodeType&&$(t).wrap("<p/>")});$.each(["strong","em","u","span"],function(e,t){$(a).find(".textme "+t).each(function(e,t){$(t).replaceWith(t.childNodes)})})}),this.quill.removeFormat(a,i),$("#wcc-toolbar-instance").find(".ql-selected-2").removeClass("ql-selected-2"),setFontSizeSlider(1)}function updateActiveGroupOutline(e,t){var a,i,s;e?$canvas.data("groupActive")&&(e=e,a=activepage.find(".group-active > .area-indicator"),i=t.size.height,s=t.size.width,t.position.top<e.top?a.css({top:t.position.top,height:e.bottom-t.position.top}):a.css({top:e.top,height:e.bottom-e.top}),t.position.left<e.left?a.css({left:t.position.left,width:e.right-t.position.left}):a.css({left:e.left,width:e.right-e.left}),t.position.left+s>e.right&&a.css({width:t.position.left+s-e.left}),t.position.top+i>e.bottom)&&a.css({height:t.position.top+i-e.top}):updateAreaIndForParentsOfSeleceted()}function removeClassByPrefix(e,t){t=new RegExp("\\b"+t+"(.*)?\\b","g");return e.className=e.className.replace(t,""),e}function applyFormatToQuillSiblings(r,l,e){quill.restoring&&quill.restoring[0].id.length<=1||(e?$(e):activepage.find(".selected.hastext").not(".edited-text")).each(function(e,s){$(s).find(".wirejr").removeAttr("data-lorem-count");var t={bold:"strong",italic:"em",underline:"u"};let a=$(s).children();for(var n=[];a.length;){var i=a[0].nodeName.toLowerCase();if("br"==i)break;n.push(i),a=a.children()}if("list"==r&&null!==l){if("ordered"===l&&$(s).find(".textme ul").length)return void $(s).find(".textme ul").replaceWith("<ol>"+$(this).find("ul").html()+"<ol/>");if("bullet"===l&&$(s).find(".textme ol").length)return void $(s).find(".textme ol").replaceWith("<ul>"+$(this).find("ol").html()+"<ul/>");$.each($(s).find(".textme")[0].childNodes,function(e,t){3==t.nodeType&&$(t).wrap("<p/>"),"LI"==t.nodeName&&t.replaceWith(t.childNodes)}),$(s).find(".textme").children().not("ol,ul").wrap("<li/>").parent().wrapAll("ordered"===l?"<ol/>":"<ul/>"),$(s).find(".textme").find("p").length&&$(s).find(".textme").find("p").each(function(e,t){$(t).replaceWith(t.childNodes)}),$(s).not("[data-can-grow-hor]").css({height:$(s).find(".textme").height(),width:$(s).find(".textme").width()})}if(null!==l&&t[r]){let i=t[r];0<=n.indexOf("span")&&!$(s).find("span[data-weblink], span[data-link").length&&$(s).find("span").each(function(e,t){let a=$(t).attr("class");$(t).replaceWith(function(e,t){return $("<"+i+"/>").html(t).addClass(a)})}),$.each($(s).find(".textme")[0].childNodes,function(e,t){3==t.nodeType?$(t).wrap("<p/>").parent().contents().wrap("<"+i+"/>"):$.each(t.childNodes,function(e,t){t.nodeName!==i.toUpperCase()&&$(t).wrap("<"+i+"/>")})})}if(null!==l&&!t[r]){if("align"==r){var o="ql-"+r+"-"+l;let e=$(s).find(".textme > p");(e=e.length?e:$(s).find(".textme").contents().wrap("<p/>").parent()).each(function(e,t){$(t).is("[class*=ql-"+r+"]")&&removeClassByPrefix(t,"ql-"+r)}),e.addClass(o)}if("color"==r||"ttu"==r||"smallcaps"==r){let a="smallcaps"==r?"sc":r,i="ql-"+a+"-"+l;$.each($(s).find(".textme")[0].childNodes,function(e,t){3==t.nodeType?$(t).wrap("<span/>"):$.each(t.childNodes,function(e,t){3==t.nodeType&&$(t).wrap("<span/>"),"LI"==t.nodeName&&$.each(t.childNodes,function(e,t){3==t.nodeType&&$(t).wrap("<span/>")})})}),$.each(["strong","em","u","span"],function(e,t){$(s).find(".textme "+t).each(function(e,t){$(t).is("[class*=ql-"+a+"]")&&removeClassByPrefix(t,"ql-"+a),$(t).addClass(i)})})}if("lh"==r){let e=$(s).find(".textme > p");(e=e.length?e:$(s).find(".textme").contents().wrap("<p/>").parent()).css("line-height",l)}if("weblink"==r||"wcclink"==r){let e=$(s).find(".textme > span");e.length||(e=$(s).find(".textme").contents().wrap("<span/>").parent());o="weblink"==r?"data-weblink":"data-link";e.addClass("weblink"==r?"wcc-weblink":"").attr(o,l)}}if("customfontsize"==r){let e=$(s).find(".textme > p");(e=e.length?e:$(s).find(".textme").contents().wrap("<p/>").parent())[0].style.fontSize=l}if(null===l||0==l)if("weblink"!=r&&"wcclink"!=r||$(s).find(".wcc-weblink, [data-link]").replaceWith(function(e,t){return $("<p/>").html(t)}),t[r]||"list"===r){o=t.hasOwnProperty(r)?t[r]:"ul li,ol li",t=$(s).find(".textme").find(o);t.length&&(t.each(function(e,t){unwrapQuillTags(e,t)}),"list"==r)&&$(s).find(".textme ul , .textme ol").each(function(e,t){$(t).replaceWith(t.childNodes)})}else{let a="smallcaps"==r?"sc":r;$(s).find("[class*=ql-"+a+"]").each(function(e,t){removeClassByPrefix(t,"ql-"+a)})}$(s).not("[data-can-grow-hor]").css({height:$(s).find(".textme").height(),width:$(s).find(".textme").width()})})}function getMatchesInArrOfObj(e,t){let i=[];return!(!e||!t)&&(e.forEach(a=>{t.forEach(t=>{Object.keys(a).every(e=>t[e]===a[e])&&!i.find(e=>e===a)&&i.push(a)})}),i)}function findCommonValues(e,t){if(!e||!t)return!1;var a,i={};for(a in e)e[a]&&e[a]===t[a]?i[a]=e[a]:"object"==typeof e[a]&&null!==e[a]&&(i[a]=findCommonValues(e[a],t[a]));return i}function readTextFormat(s,n=[]){if(s){let t={strong:{bold:!0},em:{italic:!0},u:{underline:!0},ul:{list:"bullet"},ol:{list:"ordered"}};const r=new RegExp("(?<=-)(.*)(?=-)"),l=new RegExp("([^-]+$)");s.tagName.toLowerCase()in t&&n.push(t[s.tagName.toLowerCase()]);let e=Array.from(s.children).map(function(e){return!!e.tagName&&t[e.tagName.toLowerCase()]});e=e.filter(e=>e);var i,o=[...new Set(e)];let a=!1;return $.each(s.childNodes,function(e,t){3==t.nodeType&&""==s.style.fontSize&&(a=!0)}),(1<o.length||s.children.length&&3===s.children[0].nodeType)&&s.children.length&&"P"!==s.children[0].tagName&&"SPAN"!==s.children[0].tagName||a||(n.push(...o),""!==s.style.fontSize&&n.push({customfontsize:s.style.fontSize}),s.classList.length&&(o=r.exec(s.classList[0]),i=l.exec(s.classList[0]),null!==o)&&null!==i&&n.push({[o[0]]:i[0]}),readTextFormat(s.children[0],n),s.children.length&&s.children[0].classList.length&&$.each(s.children[0].classList,function(e,t){let a,i;t.includes("wcc")?(a="wcc-link"===t?"wcclink":"weblink",i=$(s.children[0]).attr("data-"+t.slice(4)),n.push({[a]:i})):(a=r.exec(s.children[0].classList[0]),i=l.exec(s.children[0].classList[0]),null!==a&&null!==i&&n.push({[a[0]]:i[0]}))})),Object.assign({},...n)}}function getSelTextsFormat(){var e=activepage.find(".selected.hastext:not(.editingtext) .textme > *");if(0!=e.length){let a=[quill.getFormat()],i=(e.each(function(e,t){t=readTextFormat(t);a.push(t)}),[quill.getFormat()]);$.each(a,function(e,t){0===e&&(i=t),0<e&&(i=findCommonValues(i,t))}),$("#wcc-toolbar-instance").find(".ql-active").removeClass("ql-active"),$.each(Object.keys(i),function(e,t){let a=$("#wcc-toolbar-instance").find(".ql-"+t);a.find(".ql-picker-label").length&&(a=a.find(".ql-picker-label")),(a="list"===t?$("#wcc-toolbar-instance").find(".ql-"+t+"[value="+i[t]+"]"):a).addClass("ql-active"),"customfontsize"==t&&setFontSizeSlider(null,i[t])});e="color"in i?i.color:"h4";e&&($("#wcc-toolbar-instance .ql-color-picker .ql-picker-options [data-value="+e+"]").siblings().removeClass("ql-selected-2, ql-selected").end().addClass("ql-selected-2"),$("#wcc-toolbar-instance .ql-color-picker .ql-picker-label").attr("data-value",e))}}function unwrapQuillTags(e,t){$(t).is("li")&&$(t).replaceWith(function(e,t){return $("<p/>").html(t)});var a=$(t).is("[class^=ql-]");$(t).replaceWith(a?$("<span/>").addClass($(t).attr("class")).append(t.childNodes):t.childNodes)}function linkToPage(e){activepage.find(".selected").attr("data-link",e),deselectAll()}function isValidHttpUrl(e){let t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol}function isDomain(e){e=e.split(".");return 2<=e[e.length-1].length&&2<=e.length}function explodeSection(e){var t=document.querySelector(".preview-section-container");t&&(c=t.querySelector(".wcc-section"))&&(s=parseInt(window.getComputedStyle(t).top)||0,p=parseInt(window.getComputedStyle(t).left)||0,i=t.offsetWidth,t=t.offsetHeight,c.style.width=i+"px",c.style.height=t+"px",$(c).unwrap(),c.style.position="relative",c.style.top=s+"px",c.style.left=p+"px");let a=document.getElementById(e);var i=$("#"+e),t=window.getComputedStyle(a),s=(parseFloat(t.marginTop),parseFloat(t.marginLeft),i.find(".wire"));let n=Array.from(a.querySelectorAll(".wire")),o=[],r=Math.max(...Array.from(activepage.find(".wire .wirejr")).map(e=>parseInt(getComputedStyle(e).zIndex)||0)),l=(n.forEach(function(e,t){e.parentElement.classList.contains("full-width-container")||e.parentElement.offsetLeft;var a=e.getBoundingClientRect(),a={id:"w"+Math.random().toString(36).substr(2,9),top:Math.round(a.top+$container[0].scrollTop-$canvaswrap[0].offsetTop-$container[0].offsetTop)+"px",left:Math.round(a.left+$container[0].scrollLeft-$canvaswrap[0].offsetLeft-$container[0].offsetLeft)+"px",width:Math.ceil(e.getBoundingClientRect().width)+"px",height:Math.ceil(e.getBoundingClientRect().height)+"px",marginTop:"",marginLeft:"",marginRight:"",minHeight:"",minWidth:"",position:"absolute"};o.push(a)}),o.forEach(function(e,t){Object.assign(n[t].style,e),n[t].classList.remove("wcc-section-member"),n[t].id=e.id,n[t].querySelector(".wirejr").style.zIndex=r+t+1}),s.filter("[data-can-grow-hor]").removeAttr("data-can-grow-hor").end().filter(".pos-a").removeClass("pos-a"),i.replaceWith(s),computeGuides(s),0),d=0;s.each(function(){var e=$(this),t=e.position().top+e.outerHeight(),e=e.position().left+e.outerWidth();l=Math.max(l,t),d=Math.max(d,e)});var c=$("#"+app.activepage.id),p=c.height(),e=c.width(),c=(l>p&&(t=i.attr("data-section-name").startsWith("Footer")?50:450,changePageSize(null,l+t)),d>e&&changePageSize(d+50,null),s.map(function(){return $(this).attr("id")}).get());return c.length&&saveState("",c,null,null,null,!0),s}$(".wcc-toolbar, .wirepanel").on("click","[data-tooltip-type]",function(e){var t=wirepanel.is(":visible")?wirepanel:$(".wcc-toolbar");t.attr("data-tooltip-show")==$(e.target).attr("data-tooltip-type")?t.removeAttr("data-tooltip-show"):t.attr("data-tooltip-show",$(e.target).attr("data-tooltip-type"))}),$(".wp-more").on("click contextmenu",function(e){e.stopPropagation(),e.preventDefault(),($("#selection-transformator").length?$("#selection-transformator"):activepage.find(".selected, .editingtext, .g-selected.locked")).contextMenu({x:$(this).offset().left-6,y:$(this).offset().top+48}),wirepanel.add("#wcc-toolbar-instance").removeAttr("data-tooltip-show"),$("body").removeClass("show-links-panel")}),$(".linkmark").click(function(e){e.stopPropagation(),$("[data-action=make-link]").click()}),key("ctrl+b,command+b, ctrl+u,command+u, ctrl+i,command+i",function(e){var t;quill&&!quill.hasFocus()&&(e={b:"bold",u:"underline",i:"italic"}[e.key],t=!quill.getFormat()[e],quill.formatText(quill.getSelection().index,quill.getLength(),e,t,"api"))}),$("#page-del-toast-close").on("click",function(){$("#page-del-toast").hide()}),$("#page-del-toast button").on("click",function(e){e.preventDefault(),pageDelUndoTimout&&clearTimeout(pageDelUndoTimout),$(".temp-hidden").show(),$("#page-del-toast").hide()});let autoSaveTimeout=!1;function stageElemForSaving(){}function stagePageForSaving(){}const selectSection=(e,{makeDraggable:t,destroy:a}={})=>{e.addClass("section-selected"),t&&makeDrag(e),a&&e.draggable("destroy").resizable("destroy")},innerDimensions=($("[data-is-placeholder]").on("click",function(e){$sel=activepage.find(".selected"),"true"==$(this).attr("data-is-placeholder")?$sel.each(function(e,t){$(t).attr("data-placeholder",!0).addClass("image-v2").find(".wirejr").css("background","").end().find("svg").remove()}):$sel.each(function(e,t){var a,i,t=$(t);t.removeAttr("data-placeholder").removeClass("image-v2"),t.find("svg").length||(a=t.find(".wirejr").css("borderColor"),i=t.find(".wirejr").css("borderWidth"),t.find(".wirejr").css({"stroke-width":i,stroke:a}).append(`
                    <svg class="cross-v2" version="1.1" width="10" height="10"  viewBox="0 0 10 10" preserveAspectRatio="none"><line x1="0" y1="10" x2="10" y2="0" class="line1 v2"  vector-effect="non-scaling-stroke" stroke-linecap="butt"></line><line x1="0" y1="0" x2="10" y2="10" class="line2 v2"   vector-effect="non-scaling-stroke" stroke-linecap="butt"></line></svg>
                    `))})}),e=>{var t=getComputedStyle(e),a=e.clientWidth,e=e.clientHeight,i=parseFloat(t.paddingTop);return{height:e-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),width:a-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),paddingTop:i}});let bottommostPos=0;function setBottomMostPos(e,t){let a=0;e&&e.each(function(e,t){a=$(t).position().top+$(t).height()});e=bottommostPos;a<e||(bottommostPos=a,$body.get(0).style.setProperty("--bottom-most-pos",a+"px"),$body.get(0).style.setProperty("--canvas-pos",$canvaswrap.position().top+"px"))}function clearLibSearch(){$("#elem-search-x, #library-wrapper .elem-no-res").hide(),$("#elements-library [data-tag], #elements-library .category-head, #elements-library details").show(),$("#elemSearchValue").val("").focus(),$(".lib-searching").removeClass("lib-searching"),$("#section-lib details").removeAttr("open"),$("#elements-library").removeClass("details-open")}function bindLibEvents(){$("#elemSearchValue").bind("keyup",function(e){var t;"Esc"!=e.key&&"Escape"!=e.key||$("#elemSearchValue").blur(),$(this).val().replace(/[^A-Za-z0-9]+/g,"").length<2?($("#library-wrapper .elem-no-res").hide(),$("#elements-library [data-tag], #elements-library .category-head").show(),$("#section-lib").removeClass("lib-searching")):($("#elem-search-x").show(),$("#elements-library details").hide(),$("#section-lib").addClass("lib-searching"),t=$("#elemSearchValue").val(),$("#elements-library [data-tag]").each(function(){$(this).attr("data-tag").split(", ").some(e=>e.startsWith(t))?$(this).show():$(this).hide()}),$("#elements-library [data-tag]:visible").length?$("#library-wrapper .elem-no-res,  #elements-library .category-head").hide():($(" #elements-library .category-head").hide(),$("#library-wrapper .elem-no-res").show(),$("#section-lib").removeClass("lib-searching")))}),$(".elem-search-clear").click(function(){clearLibSearch()}),$("#elements-library summary").on("click",function(e){$("#elements-library").css("paddingBottom",0),$(e.currentTarget).parent().siblings().removeAttr("open"),e.currentTarget.parentNode.open||($("#wirelib-elements-library").css("paddingBottom",$(e.currentTarget.parentNode).next()[0].scrollHeight),document.getElementById("elements-library").scrollTo({top:e.currentTarget.parentNode.offsetTop-12,behavior:"instant"}))}),$("#elements-library details").on("toggle",function(e){e.target.open&&$("#wirelib-elements-library").css("paddingBottom",0)})}function positionSecBtn(){let t=0;$(".wire",activepage).each(function(){var e=($this=$(this)).outerHeight()+$this.position().top;e>t&&(t=e)}),$body.get(0).style.setProperty("--bottom-most-pos",t+"px"),$body.get(0).style.setProperty("--canvas-pos",$canvaswrap.position().top+"px"),bottommostPos=t}function hideWirelib(){}function positionWireLib(e,t,a){let i=document.getElementById("container");for(;i&&i.scrollHeight<=i.clientHeight;)i=i.parentElement;i&&i.scrollLeft,i&&i.scrollTop,e[0].getBoundingClientRect();var s=e.height(),n=e.width(),o=(e.position(),supercanvas.offset());$canvaswrap.position();let r,l=((r=(r=e.offset().left+n/2-o.left)+t/2>-o.left+window.innerWidth?window.innerWidth-o.left-20-t/2:r)-t/2<0-o.left&&(r=20-o.left+t/2),e.offset().top-o.top-48-16);l<42-o.top+8&&(l+=s+48+32),$("#magic-toolbar").css({left:r+"px",top:l+"px",display:"grid"})}function populatePredictions(e,t){let a=$("#predicted-buttons");a.find("button").not("#expand-magic-toolbar").hide(),e.sections.forEach((e,t)=>{e=a.find("[section-name="+e.name+"]");e.length&&(e.show(),a.append(e))}),e.elements.forEach((e,t)=>{e=a.find("[element-name="+e.name+"]");e.length&&(e.show(),a.append(e))});var i,s,n,e=document.querySelector("#magic-toolbar");e&&(e.style.display="grid",s=(560-(i=a.outerWidth()+40+16))/2,$("#widget-list").scrollTop(0),$("#widget-list .list-active").removeClass("list-active"),$("#widget-list  button").removeAttr("tabindex"),(n=document.querySelector('#search-wrapper input[type="text"]'))&&(n.value=""),e.style.clipPath=`inset(0px ${s}px 312px ${s}px round 12px)`,e.style.display="grid",$body.addClass("magic-toolbar-open"),$("#predicted-buttons").stop().scrollLeft(0),updatePredictionsScrollState(),positionWireLib($(".brandnew"),i))}function bindMagicToolbarEvents(){var e=document.getElementById("widget-list");const o=document.getElementById("widget-image-container"),r=document.getElementById("widget-text-container"),l=document.getElementById("widget-name-container"),a=document.getElementById("widget-list");var t=document.getElementById("widget-preview");t.addEventListener("wheel",function(e){e.preventDefault(),a.scrollTop+=e.deltaY}),t.addEventListener("touchmove",e=>{e.preventDefault()},{passive:!1});let i=0;function s(e){var e=e.target,t=e.getAttribute("data-image"),a=e.getAttribute("data-name"),i=e.getAttribute("data-text"),s=e.getAttribute("data-srcset"),n=e.classList.contains("is-section"),e=e.querySelector(".widget-preview"),e=e?e.cloneNode(!0):null;a=a,i=i,s=s,n=n,e=e,(t=t)&&(c(),e?o.appendChild(e):((e=document.createElement("img")).src=t,e.srcset=s||"",e.alt="Selected Image",o.appendChild(e)),n?o.classList.add("section-preview-img"):o.classList.remove("section-preview-img"),l.innerHTML=`<b>${a}</b>`,l.style.display="block",r.textContent=i)}t.addEventListener("touchstart",e=>{i=e.touches[0].clientY}),t.addEventListener("touchmove",e=>{var e=e.touches[0].clientY,t=i-e;a.scrollTop+=t,i=e}),document.getElementById("all-elements-and-sections").addEventListener("wheel",e=>{e.stopPropagation()}),$("#expand-magic-toolbar, #selected-section-category-arrow-down").click(function(){var e=document.querySelector("#magic-toolbar"),t=(e.style.clipPath="",e.classList.toggle("expanded"),("selected-section-category-arrow-down"===event.target.id||event.target.closest("#selected-section-category-arrow-down"))&&(t=document.getElementById("widget-list"),a=document.getElementById("sections-list"),t)&&a&&t.scrollTo({top:a.offsetTop-32,behavior:"instant"}),e.getBoundingClientRect()),a=window.innerWidth,i=window.innerHeight;let s=0,n=0;t.left<0&&(s=20-t.left),t.right>a&&(s=a-t.right-20),t.top<0&&(n=20-t.top),t.bottom+32>i&&(n=i-t.bottom-40),e.style.transform=`translate(-50%, 0) translate(${s}px, ${n}px)`,$container[0].addEventListener("wheel",preventScroll,{passive:!1})});let n;function d(){c()}function c(){o.innerHTML="",r.textContent="",l.textContent="",l.style.display="none"}e.addEventListener("mouseenter",s,!0),e.addEventListener("mouseleave",d,!0),e.addEventListener("focusin",s),e.addEventListener("focusout",d),$("#widget-list").on("click",".expand-list-toggle",function(e){var e=e.target,t=e.getAttribute("data-ref");t=$("#"+t);t.length&&(e.blur(),e=$("#widget-list"),n=e.scrollTop(),e.scrollTop(0),t.addClass("list-active"),$("#widget-list #back-button").show(),$("#widget-list ul button").each((e,t)=>{$(t).parents(".list-active").length||$(t).attr("tabindex",-1)}))});document.querySelectorAll(".expand-list-toggle");$("#widget-list #back-button").on("click",function(){$("#widget-list .list-active").removeClass("list-active"),$("#widget-list  button").removeAttr("tabindex"),$("#widget-list").scrollTop(n)});const p=document.getElementById("predicted-widgets"),g=document.getElementById("predicted-buttons");t=document.getElementById("scrollLeftButton"),e=document.getElementById("scrollRightButton");function h(e){var t=Array.from(g.querySelectorAll('button:not([style*="display: none"])')),a=g.getBoundingClientRect();let i;if("left"===e){for(let e=t.length-1;0<=e;e--)if(t[e].getBoundingClientRect().left<a.left){i=t[e];break}!i&&0<t.length&&(i=t[0])}else{for(let e=0;e<t.length;e++)if(t[e].getBoundingClientRect().right>a.right){i=t[e];break}!i&&0<t.length&&(i=t[t.length-1])}i&&("left"===e?(e=i.offsetLeft+i.offsetWidth-g.clientWidth+60,g.scrollTo({left:e,behavior:"smooth"})):(e=i.offsetLeft-g.offsetLeft-60,g.scrollTo({left:e,behavior:"smooth"}))),updatePredictionsScrollState()}updatePredictionsScrollState=function(){var e=0<g.scrollLeft,t=g.scrollLeft<g.scrollWidth-g.clientWidth;p.classList.toggle("can-scroll-left",e),p.classList.toggle("can-scroll-right",t)},t.addEventListener("click",()=>h("left")),e.addEventListener("click",()=>h("right")),document.addEventListener("keydown",e=>{var t=document.getElementById("magic-toolbar"),a=document.getElementById("scrollLeftButton"),i=document.getElementById("scrollRightButton");"none"===t.style.display||t.classList.contains("expanded")||null===a.offsetParent&&null===i.offsetParent||("ArrowLeft"===e.key?(h("left"),e.preventDefault()):"ArrowRight"===e.key&&(h("right"),e.preventDefault()))}),g.addEventListener("scroll",$.debounce(100,updatePredictionsScrollState)),updatePredictionsScrollState();const u=document.getElementById("swidget-earch-field"),f=document.getElementById("all-elements-and-sections"),m=document.getElementById("clear-widget-search-button");function v(){u.value="",b(),m.style.display="none"}function w(){var e=f.querySelectorAll(".widget-title");let a=!1;e.forEach(e=>{let t=e.nextElementSibling;for(;t&&!t.classList.contains("widget-title");){if(t.querySelectorAll('[style*="display: none"]').length<t.children.length){a=!0;break}t=t.nextElementSibling}e.style.display="none"}),a&&e.forEach(e=>{let t=e.nextElementSibling;for(;t&&!t.classList.contains("widget-title");){if(t.querySelectorAll('[style*="display: none"]').length<t.children.length){e.style.display="";break}t=t.nextElementSibling}})}function b(){f.querySelectorAll("button[data-tag], li[data-tag]").forEach(e=>{e.style.display=""}),w()}u.addEventListener("input",function(){const t=this.value.toLowerCase().trim();t.length<3?(b(),m.style.display=0<t.length?"flex":"none"):(f.querySelectorAll("button[data-tag], li[data-tag]").forEach(e=>{(e.dataset.tag||"").toLowerCase().includes(t)?e.style.display="":e.style.display="none"}),w(),m.style.display="flex")}),m.addEventListener("click",v),document.addEventListener("keydown",function(e){"Escape"===e.key&&document.activeElement===u&&v()})}$body.get(0).style.setProperty("--page-width",activepage.width()+"px"),$body.get(0).style.setProperty("--page-height",activepage.height()+"px"),$("#show-elem-lib").on("click",function(){$body.toggleClass("elem-lib-visible"),$("#elements-library")[0].scrollTop=0,clearLibSearch()}),$("#section-btn").on("click",function(){$body.toggleClass("elem-lib-visible"),$body.toggleClass("mode--section-preview"),document.getElementById("section-lib").scrollIntoView(),clearLibSearch()}),$("#wirelib-section-btn").on("click",function(){document.getElementById("section-lib").scrollIntoView(),clearLibSearch()});let updatePredictionsScrollState;function preventScroll(e){document.getElementById("all-elements-and-sections").contains(e.target)||e.preventDefault()}function hideMagicToolbar(){$container[0].removeEventListener("wheel",preventScroll);var e,t=document.getElementById("magic-toolbar"),t=(t&&(t.style.display="none",t.classList.remove("expanded"),t.style.clipPath="",t.style.transform="translate(-50%, 0)",$("#predicted-widgets").removeAttr("class")),document.getElementById("selected-section-category-toolbar")),t=(t&&t.classList.remove("visible"),document.body.classList.remove("magic-toolbar-open"),document.querySelector(".preview-section-container"));t&&(e=$(t).find(".wcc-section").attr("data-section-name"),predictor.addExistingSection(e.split("-").filter(e=>!["s",/^\d+$/.test(e)].includes(e)).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join("-"),parseInt($(t).position().top)),explodeSection($(".preview-section-container .wcc-section").attr("id")))}